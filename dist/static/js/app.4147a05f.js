(function(){"use strict";var e={14809:function(e,t,s){s.r(t),s.d(t,{default:function(){return c}});s(18111),s(61701);var a=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"permission",rawName:"v-permission",value:"roleManagement:view",expression:"'roleManagement:view'"}],staticClass:"role-management-container"},[t("h1",{staticClass:"page-title"},[e._v("角色管理")]),t("div",{staticClass:"action-bar"},[t("div",{staticClass:"search-area"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchKeyword,expression:"searchKeyword"}],staticClass:"search-input",attrs:{type:"text",placeholder:"请输入角色名称搜索"},domProps:{value:e.searchKeyword},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchRoles.apply(null,arguments)},input:function(t){t.target.composing||(e.searchKeyword=t.target.value)}}}),t("select",{directives:[{name:"model",rawName:"v-model",value:e.filterType,expression:"filterType"}],staticClass:"filter-select",on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.filterType=t.target.multiple?s:s[0]}}},[t("option",{attrs:{value:""}},[e._v("全部类型")]),t("option",{attrs:{value:"admin"}},[e._v("管理类")]),t("option",{attrs:{value:"operation"}},[e._v("操作类")]),t("option",{attrs:{value:"view"}},[e._v("查看类")])]),t("button",{staticClass:"search-btn",on:{click:e.searchRoles}},[e._v("查询角色")]),t("button",{staticClass:"reset-btn",on:{click:e.resetSearch}},[e._v("重置")])]),t("button",{directives:[{name:"permission",rawName:"v-permission",value:"roleManagement:add",expression:"'roleManagement:add'"}],staticClass:"create-btn",on:{click:e.openCreateModal}},[e._v(" 创建角色 ")])]),t("div",{staticClass:"role-list"},[t("table",{staticClass:"role-table"},[e._m(0),t("tbody",[e._l(e.filteredRoles,(function(s,a){return t("tr",{key:s.id},[t("td",[e._v(e._s(a+1))]),t("td",[e._v(e._s(s.name))]),t("td",[t("span",{staticClass:"role-type-tag",class:s.type},[e._v(" "+e._s(e.getTypeText(s.type))+" ")])]),t("td",{staticClass:"description-cell"},[e._v(e._s(s.description))]),t("td",[e._v(e._s(e.formatDate(s.createdAt)))]),t("td",{staticClass:"actions-cell"},[t("button",{directives:[{name:"permission",rawName:"v-permission",value:"roleManagement:edit",expression:"'roleManagement:edit'"}],staticClass:"edit-btn",on:{click:function(t){return e.openEditModal(s)}}},[e._v(" 修改 ")]),t("button",{directives:[{name:"permission",rawName:"v-permission",value:"roleManagement:delete",expression:"'roleManagement:delete'"}],staticClass:"delete-btn",on:{click:function(t){return e.confirmDelete(s)}}},[e._v(" 删除 ")])])])})),0===e.filteredRoles.length?t("tr",[t("td",{staticClass:"empty-data",attrs:{colspan:"6"}},[e._v("暂无角色数据")])]):e._e()],2)])]),e.totalPages>1?t("div",{staticClass:"pagination-area"},[t("button",{staticClass:"pagination-btn",attrs:{disabled:1===e.currentPage},on:{click:function(t){return e.changePage(e.currentPage-1)}}},[e._v(" 上一页 ")]),t("span",{staticClass:"pagination-info"},[e._v(e._s(e.currentPage)+" / "+e._s(e.totalPages))]),t("button",{staticClass:"pagination-btn",attrs:{disabled:e.currentPage===e.totalPages},on:{click:function(t){return e.changePage(e.currentPage+1)}}},[e._v(" 下一页 ")])]):e._e(),e.showModal?t("div",{staticClass:"modal-backdrop",on:{click:e.closeModal}}):e._e(),e.showModal?t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-header"},[t("h3",[e._v(e._s(e.isEditing?"修改角色":"创建角色"))]),t("button",{staticClass:"modal-close",on:{click:e.closeModal}},[e._v("×")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"form-section"},[t("h4",[e._v("基本信息")]),t("div",{staticClass:"form-group"},[t("label",[e._v("角色名称")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.roleForm.name,expression:"roleForm.name"}],attrs:{type:"text",placeholder:"请输入角色名称"},domProps:{value:e.roleForm.name},on:{input:function(t){t.target.composing||e.$set(e.roleForm,"name",t.target.value)}}}),e.formErrors.name?t("p",{staticClass:"error-text"},[e._v(e._s(e.formErrors.name))]):e._e()]),t("div",{staticClass:"form-group"},[t("label",[e._v("角色类型")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.roleForm.type,expression:"roleForm.type"}],on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.roleForm,"type",t.target.multiple?s:s[0])}}},[t("option",{attrs:{value:"admin"}},[e._v("管理类")]),t("option",{attrs:{value:"operation"}},[e._v("操作类")]),t("option",{attrs:{value:"view"}},[e._v("查看类")])]),e.formErrors.type?t("p",{staticClass:"error-text"},[e._v(e._s(e.formErrors.type))]):e._e()]),t("div",{staticClass:"form-group"},[t("label",[e._v("权限描述")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.roleForm.description,expression:"roleForm.description"}],attrs:{placeholder:"请描述角色权限",rows:"4"},domProps:{value:e.roleForm.description},on:{input:function(t){t.target.composing||e.$set(e.roleForm,"description",t.target.value)}}}),e.formErrors.description?t("p",{staticClass:"error-text"},[e._v(e._s(e.formErrors.description))]):e._e()])]),t("div",{staticClass:"form-section"},[t("h4",[e._v("功能权限配置")]),t("div",{staticClass:"permissions-grid"},e._l(e.availableModules,(function(s){return t("div",{key:s.id,staticClass:"module-permissions"},[t("div",{staticClass:"module-header"},[t("label",[t("input",{attrs:{type:"checkbox"},domProps:{checked:e.isModuleSelected(s.id)},on:{change:function(t){return e.toggleModule(s.id)}}}),e._v(" "+e._s(s.name)+" ")])]),t("div",{staticClass:"permission-actions"},e._l(s.actions,(function(a){return t("label",{key:a.id},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.roleForm.permissions[s.id][a.id],expression:"roleForm.permissions[module.id][action.id]"}],attrs:{type:"checkbox",disabled:!e.isModuleSelected(s.id)},domProps:{checked:Array.isArray(e.roleForm.permissions[s.id][a.id])?e._i(e.roleForm.permissions[s.id][a.id],null)>-1:e.roleForm.permissions[s.id][a.id]},on:{change:function(t){var r=e.roleForm.permissions[s.id][a.id],i=t.target,o=!!i.checked;if(Array.isArray(r)){var l=null,n=e._i(r,l);i.checked?n<0&&e.$set(e.roleForm.permissions[s.id],a.id,r.concat([l])):n>-1&&e.$set(e.roleForm.permissions[s.id],a.id,r.slice(0,n).concat(r.slice(n+1)))}else e.$set(e.roleForm.permissions[s.id],a.id,o)}}}),e._v(" "+e._s(a.name)+" ")])})),0)])})),0)])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"cancel-btn",on:{click:e.closeModal}},[e._v("取消")]),t("button",{staticClass:"save-btn",on:{click:e.saveRole}},[e._v("保存")])])]):e._e(),e.showDeleteConfirm?t("div",{staticClass:"modal-backdrop",on:{click:e.cancelDelete}}):e._e(),e.showDeleteConfirm?t("div",{staticClass:"modal delete-modal"},[t("div",{staticClass:"modal-header"},[t("h3",[e._v("确认删除")]),t("button",{staticClass:"modal-close",on:{click:e.cancelDelete}},[e._v("×")])]),t("div",{staticClass:"modal-body"},[t("p",{staticClass:"confirm-text"},[e._v(" 确定要删除角色 "),t("span",{staticClass:"highlight"},[e._v(e._s(e.pendingDeleteRole?.name))]),e._v(" 吗？ 此操作无法撤销。 ")])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"cancel-btn",on:{click:e.cancelDelete}},[e._v("取消")]),t("button",{staticClass:"delete-confirm-btn",on:{click:e.deleteRole}},[e._v("确认删除")])])]):e._e()])},r=[function(){var e=this,t=e._self._c;return t("thead",[t("tr",[t("th",{attrs:{width:"5%"}},[e._v("序号")]),t("th",{attrs:{width:"15%"}},[e._v("角色名称")]),t("th",{attrs:{width:"15%"}},[e._v("角色类型")]),t("th",{attrs:{width:"30%"}},[e._v("权限描述")]),t("th",{attrs:{width:"15%"}},[e._v("创建时间")]),t("th",{attrs:{width:"20%"}},[e._v("操作")])])])}],i=(s(44114),s(22489),s(7588),s(13579),s(95353)),o={name:"RoleManagement",data(){return{searchKeyword:"",filterType:"",currentPage:1,pageSize:10,showModal:!1,isEditing:!1,roleForm:{id:null,name:"",type:"admin",description:"",permissions:{}},formErrors:{name:"",type:"",description:""},showDeleteConfirm:!1,pendingDeleteRole:null,availableModules:[{id:"roleManagement",name:"角色管理",actions:[{id:"view",name:"查看"},{id:"add",name:"新增"},{id:"edit",name:"编辑"},{id:"delete",name:"删除"}]},{id:"userManagement",name:"用户管理",actions:[{id:"view",name:"查看"},{id:"add",name:"新增"},{id:"edit",name:"编辑"},{id:"delete",name:"删除"}]},{id:"classManagement",name:"班级管理",actions:[{id:"view",name:"查看"},{id:"add",name:"新增"},{id:"edit",name:"编辑"},{id:"delete",name:"删除"}]},{id:"groupManagement",name:"编组管理",actions:[{id:"view",name:"查看"},{id:"add",name:"新增"},{id:"edit",name:"编辑"},{id:"delete",name:"删除"}]},{id:"materialsManagement",name:"教学资料",actions:[{id:"view",name:"查看"},{id:"preview",name:"预览"},{id:"upload",name:"上传"},{id:"edit",name:"编辑"},{id:"delete",name:"删除"}]},{id:"scoreQuery",name:"成绩查询",actions:[{id:"view",name:"查看"},{id:"review",name:"点评"}]},{id:"statisticsAnalysis",name:"统计分析",actions:[{id:"view",name:"查看"},{id:"scoreDistribution",name:"成绩分布"}]},{id:"profile",name:"个人中心",actions:[{id:"view",name:"查看"}]}],roles:[{id:1,name:"系统管理员",type:"admin",description:"拥有系统所有功能的最高权限",permissions:{roleManagement:{view:!0,add:!0,edit:!0,delete:!0},userManagement:{view:!0,add:!0,edit:!0,delete:!0},classManagement:{view:!0,add:!0,edit:!0,delete:!0},groupManagement:{view:!0,add:!0,edit:!0,delete:!0},materialsManagement:{view:!0,preview:!0,upload:!0,edit:!0,delete:!0},scoreQuery:{view:!0,review:!0},statisticsAnalysis:{view:!0,scoreDistribution:!0}},dataScopes:{userManagement:"admin",classManagement:"admin",groupManagement:"admin",scoreQuery:"admin",statisticsAnalysis:"admin"}},{id:2,name:"教师",type:"teacher",description:"可管理班级、编组、查看所带班级学员成绩并点评",permissions:{roleManagement:{view:!1,add:!1,edit:!1,delete:!1},userManagement:{view:!0,add:!0,edit:!0,delete:!0},classManagement:{view:!0,add:!0,edit:!0,delete:!0},groupManagement:{view:!0,add:!0,edit:!0,delete:!0},materialsManagement:{view:!0,preview:!0,upload:!0,edit:!0,delete:!0},scoreQuery:{view:!0,review:!0},statisticsAnalysis:{view:!0,scoreDistribution:!0}},dataScopes:{userManagement:"teacher",classManagement:"teacher",groupManagement:"teacher",scoreQuery:"teacher",statisticsAnalysis:"teacher"}},{id:3,name:"学员",type:"student",description:"可查看多媒体教学资料、参与训练、查看个人成绩",permissions:{roleManagement:{view:!1,add:!1,edit:!1,delete:!1},userManagement:{view:!1,add:!1,edit:!1,delete:!1},classManagement:{view:!1,add:!1,edit:!1,delete:!1},groupManagement:{view:!1,add:!1,edit:!1,delete:!1},materialsManagement:{view:!0,preview:!0,upload:!1,edit:!1,delete:!1},scoreQuery:{view:!0,review:!1},statisticsAnalysis:{view:!0,scoreDistribution:!1}},dataScopes:{scoreQuery:"student",statisticsAnalysis:"student"}}]}},computed:{...(0,i.L8)({hasPermission:"permission/hasPermission"}),filteredRoles(){let e=[...this.roles];if(this.searchKeyword){const t=this.searchKeyword.toLowerCase();e=e.filter((e=>e.name.toLowerCase().includes(t)||e.description.toLowerCase().includes(t)))}this.filterType&&(e=e.filter((e=>e.type===this.filterType)));const t=(this.currentPage-1)*this.pageSize,s=t+this.pageSize;return e.slice(t,s)},totalPages(){let e=[...this.roles];if(this.searchKeyword){const t=this.searchKeyword.toLowerCase();e=e.filter((e=>e.name.toLowerCase().includes(t)||e.description.toLowerCase().includes(t)))}return this.filterType&&(e=e.filter((e=>e.type===this.filterType))),Math.ceil(e.length/this.pageSize)||1}},created(){console.log("RoleManagement组件创建");const e=this.hasPermission("roleManagement","view");if(console.log("角色管理查看权限:",e),!e)return console.log("无权限访问角色管理页面"),void this.$router.push("/analysis")},mounted(){console.log("RoleManagement组件挂载")},errorCaptured(e,t,s){return console.error("组件错误:",e),console.log("错误组件:",t),console.log("错误信息:",s),!1},methods:{searchRoles(){this.currentPage=1},resetSearch(){this.searchKeyword="",this.filterType="",this.currentPage=1},changePage(e){e>=1&&e<=this.totalPages&&(this.currentPage=e)},initRoleForm(){this.roleForm={id:null,name:"",type:"admin",description:"",permissions:{}},this.availableModules.forEach((e=>{this.roleForm.permissions[e.id]={},e.actions.forEach((t=>{this.roleForm.permissions[e.id][t.id]=!1}))}))},isModuleSelected(e){const t=this.roleForm.permissions[e]||{};return Object.values(t).some((e=>!0===e))},toggleModule(e){const t=this.isModuleSelected(e),s=this.roleForm.permissions[e];Object.keys(s).forEach((e=>{s[e]=!t}))},openCreateModal(){this.isEditing=!1,this.initRoleForm(),this.resetFormErrors(),this.showModal=!0},openEditModal(e){this.isEditing=!0,this.initRoleForm(),this.roleForm={id:e.id,name:e.name,type:e.type,description:e.description,permissions:{}},this.availableModules.forEach((t=>{this.roleForm.permissions[t.id]={},t.actions.forEach((s=>{this.roleForm.permissions[t.id][s.id]=e.permissions?.[t.id]?.[s.id]||!1}))})),this.resetFormErrors(),this.showModal=!0},closeModal(){this.showModal=!1},saveRole(){if(!this.validateForm())return;const e={...this.roleForm,permissions:this.formatPermissions()};if(this.isEditing){const t=this.roles.findIndex((t=>t.id===e.id));-1!==t&&this.roles.splice(t,1,e)}else e.id=Math.max(...this.roles.map((e=>e.id)),0)+1,e.createdAt=new Date,this.roles.push(e);this.closeModal()},formatPermissions(){const e={};return Object.entries(this.roleForm.permissions).forEach((([t,s])=>{e[t]={...s}})),e},validateForm(){this.resetFormErrors();let e=!0;return this.roleForm.name.trim()||(this.formErrors.name="角色名称不能为空",e=!1),this.roleForm.type||(this.formErrors.type="请选择角色类型",e=!1),this.roleForm.description.trim()||(this.formErrors.description="权限描述不能为空",e=!1),e},resetFormErrors(){this.formErrors={name:"",type:"",description:""}},confirmDelete(e){this.pendingDeleteRole=e,this.showDeleteConfirm=!0},cancelDelete(){this.pendingDeleteRole=null,this.showDeleteConfirm=!1},deleteRole(){if(this.pendingDeleteRole){const e=this.roles.findIndex((e=>e.id===this.pendingDeleteRole.id));-1!==e&&this.roles.splice(e,1)}this.cancelDelete(),0===this.filteredRoles.length&&this.currentPage>1&&this.currentPage--},formatDate(e){return new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"})},getTypeText(e){const t={admin:"管理类",operation:"操作类",view:"查看类"};return t[e]||"未知"},goBack(){this.$router.push("/dashboard")}}},l=o,n=s(81656),d=(0,n.A)(l,a,r,!1,null,"5c30f4be",null),c=d.exports},79414:function(e,t,s){var a=s(85471),r=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},i=[],o={name:"App"},l=o,n=s(81656),d=(0,n.A)(l,r,i,!1,null,null,null),c=d.exports,u=s(40173),m=s(95353);const p={async login({username:e,password:t}){await new Promise((e=>setTimeout(e,500)));let s=null,a=null;if("admin"===e&&"123456"===t)s={id:1,username:"admin",name:"系统管理员",role:"admin",avatar:""},a="admin_token";else if(e.startsWith("teacher")&&"123456"===t)s={id:2,username:e,name:"教师"+e.substring(7),role:"teacher",avatar:""},a="teacher_token";else{if(!e.startsWith("student")||"123456"!==t)throw new Error("用户名或密码错误");s={id:3,username:e,name:"学员"+e.substring(7),role:"student",avatar:""},a="student_token"}return{data:{token:a,userInfo:s}}},async getUserInfo(){await new Promise((e=>setTimeout(e,300)));const e=localStorage.getItem("token"),t=e?.split("_")[0];if(!e||!t)throw new Error("未登录或登录已过期");let s={id:1,username:"unknown",name:"未知用户",role:t,avatar:""};switch(t){case"admin":s={id:1,username:"admin",name:"系统管理员",role:"admin",avatar:""};break;case"teacher":s={id:2,username:"teacher1",name:"教师1",role:"teacher",avatar:""};break;case"student":s={id:3,username:"student1",name:"学员1",role:"student",avatar:""};break}return{data:s}},async logout(){return await new Promise((e=>setTimeout(e,300))),{data:{success:!0}}}};var v=p;const h={token:localStorage.getItem("token")||"",userInfo:JSON.parse(localStorage.getItem("userInfo")||"{}"),isAuthenticated:"true"===localStorage.getItem("isAuthenticated")},f={isAuthenticated:e=>e.isAuthenticated,userInfo:e=>e.userInfo,getUserInfo:e=>e.userInfo,token:e=>e.token,getUserInfo:e=>e.userInfo},g={SET_TOKEN(e,t){e.token=t,localStorage.setItem("token",t)},SET_USER_INFO(e,t){e.userInfo=t,localStorage.setItem("userInfo",JSON.stringify(t))},SET_AUTHENTICATED(e,t){e.isAuthenticated=t,localStorage.setItem("isAuthenticated",t)},CLEAR_USER_STATE(e){e.token="",e.userInfo={},e.isAuthenticated=!1,localStorage.removeItem("token"),localStorage.removeItem("userInfo"),localStorage.removeItem("isAuthenticated"),localStorage.removeItem("userRole")}},_={async loginUser({commit:e},t){try{const s=await v.login(t),{token:a,userInfo:r}=s.data;return e("SET_TOKEN",a),e("SET_USER_INFO",r),e("SET_AUTHENTICATED",!0),s}catch(s){throw e("CLEAR_USER_STATE"),s}},async logoutUser({commit:e}){try{await v.logout()}finally{e("CLEAR_USER_STATE"),localStorage.removeItem("token"),localStorage.removeItem("userInfo"),localStorage.removeItem("isAuthenticated"),localStorage.removeItem("userRole"),localStorage.removeItem("rememberedUser")}}};var C={namespaced:!0,state:h,getters:f,mutations:g,actions:_};const w={userRole:localStorage.getItem("userRole")||"",userId:"",permissionRules:{admin:{userManagement:{view:!0,add:!0,edit:!0,delete:!0,dataScope:"all"},roleManagement:{view:!0,add:!0,edit:!0,delete:!0},classManagement:{view:!0,add:!0,edit:!0,delete:!0,dataScope:"all"},groupManagement:{view:!0,add:!0,edit:!0,delete:!0,dataScope:"all"},courseManagement:{view:!0,add:!0,edit:!0,delete:!0,dataScope:"all"},materialsManagement:{view:!0,add:!0,edit:!0,delete:!0,upload:!0,title:"教学资料"},guidedTeaching:{view:!0,add:!0,edit:!0,delete:!0,dataScope:"all"},freeTraining:{view:!0,add:!0,edit:!0,delete:!0,dataScope:"all"},scoreQuery:{view:!0,review:!0,dataScope:"all"},teacherReview:{view:!0,add:!0,edit:!0,delete:!0},statisticsAnalysis:{view:!0,scoreDistribution:!0,dataScope:"all"}},teacher:{userManagement:{view:!0,add:!1,edit:!1,delete:!1,dataScope:"class"},classManagement:{view:!0,add:!0,edit:!0,delete:!1,dataScope:"own"},groupManagement:{view:!0,add:!0,edit:!0,delete:!1,dataScope:"own"},courseManagement:{view:!0,add:!0,edit:!0,delete:!0,dataScope:"own"},materialsManagement:{view:!0,add:!0,edit:!0,delete:!0,upload:!0,title:"教学资料"},guidedTeaching:{view:!0,add:!0,edit:!0,delete:!0,dataScope:"own"},freeTraining:{view:!0,add:!0,edit:!0,delete:!0,dataScope:"own"},scoreQuery:{view:!0,review:!0,dataScope:"class"},teacherReview:{view:!0,add:!0,edit:!0,delete:!0},statisticsAnalysis:{view:!0,scoreDistribution:!0,dataScope:"class"}},student:{userManagement:{view:!0,add:!1,edit:!1,delete:!1,dataScope:"self"},materialsManagement:{view:!0,add:!1,edit:!1,delete:!1,upload:!1,title:"多媒体教学"},guidedTeaching:{view:!0,add:!1,edit:!1,delete:!1,simulate:!0,dataScope:"assigned"},freeTraining:{view:!0,add:!1,edit:!1,delete:!1,simulate:!0,dataScope:"assigned"},scoreQuery:{view:!0,review:!1,dataScope:"self"},statisticsAnalysis:{view:!0,scoreDistribution:!1,dataScope:"self"}}}},b={getPermissionRules:e=>(t=e.userRole)=>(console.log("获取权限规则:",{role:t,stateRole:e.userRole}),e.permissionRules[t]||{}),hasPermission:(e,t)=>(s,a)=>{console.log("检查权限:",{module:s,action:a,userRole:e.userRole,rules:t.getPermissionRules(e.userRole)});const r=t.getPermissionRules(e.userRole),i=r[s]&&r[s][a];return console.log("权限检查结果:",i),i},getDataScope:(e,t)=>s=>{const a=t.getPermissionRules(e.userRole);return a[s]?a[s].dataScope:"none"},getModuleTitle:(e,t)=>s=>{const a=t.getPermissionRules(e.userRole);return a[s]?a[s].title:""}},y={SET_USER_ROLE(e,t){console.log("设置用户角色:",t),e.userRole=t,localStorage.setItem("userRole",t)},SET_USER_ID(e,t){e.userId=t}},M={initializePermissions({commit:e},{role:t,userId:s}){if(console.log("初始化权限:",{role:t,userId:s}),!t)throw console.error("初始化权限失败: 角色不能为空"),new Error("角色不能为空");e("SET_USER_ROLE",t),e("SET_USER_ID",s)}};var k={namespaced:!0,state:w,getters:b,mutations:y,actions:M};a["default"].use(m.Ay);var I=new m.Ay.Store({modules:{user:C,permission:k},getters:{getUserInfo:(e,t)=>t["user/getUserInfo"]}}),x=function(){var e=this,t=e._self._c;return t("el-container",{staticClass:"layout-container"},[t("el-aside",{attrs:{width:e.isCollapse?"64px":"220px"}},[t("div",{staticClass:"sidebar"},[t("div",{staticClass:"logo"},[t("i",{staticClass:"el-icon-s-platform"}),t("span",{directives:[{name:"show",rawName:"v-show",value:!e.isCollapse,expression:"!isCollapse"}]},[e._v("军事仿真训练系统")])]),t("el-menu",{staticClass:"sidebar-menu",attrs:{"default-active":e.$route.path,collapse:e.isCollapse,router:"","background-color":"#001529","text-color":"#fff","active-text-color":"#1890ff"}},[e.hasRole("admin")?t("el-submenu",{attrs:{index:"1"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-setting"}),t("span",[e._v("系统管理")])]),t("el-menu-item",{attrs:{index:"/roles"}},[t("i",{staticClass:"el-icon-s-tools"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("角色管理")])]),t("el-menu-item",{attrs:{index:"/users"}},[t("i",{staticClass:"el-icon-user"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("用户管理")])])],2):e._e(),e.hasRole(["admin","teacher"])?t("el-submenu",{attrs:{index:"2"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-s-custom"}),t("span",[e._v("班组管理")])]),t("el-menu-item",{attrs:{index:"/classes"}},[t("i",{staticClass:"el-icon-school"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("班级管理")])]),t("el-menu-item",{attrs:{index:"/groups"}},[t("i",{staticClass:"el-icon-s-operation"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("编组管理")])])],2):e._e(),t("el-submenu",{attrs:{index:"3"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-document"}),t("span",[e._v("资料管理")])]),t("el-menu-item",{attrs:{index:"/materials"}},[t("i",{staticClass:"el-icon-folder"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("教学资料")])])],2),e.hasRole(["admin","teacher"])?t("el-submenu",{attrs:{index:"4"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-reading"}),t("span",[e._v("课程管理")])]),t("el-menu-item",{attrs:{index:"/course-management"}},[t("i",{staticClass:"el-icon-notebook-2"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("教学课程")])])],2):e._e(),t("el-submenu",{attrs:{index:"5"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-video-camera"}),t("span",[e._v("演练管理")])]),t("el-menu-item",{attrs:{index:"/guided-teaching"}},[t("i",{staticClass:"el-icon-reading"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("引导教学")])]),t("el-menu-item",{attrs:{index:"/free-training"}},[t("i",{staticClass:"el-icon-video-play"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("自由训练")])])],2),t("el-submenu",{attrs:{index:"6"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-s-data"}),t("span",[e._v("考核评估")])]),t("el-menu-item",{attrs:{index:"/score-query"}},[t("i",{staticClass:"el-icon-data-line"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("成绩查询")])]),e.hasRole(["admin","teacher"])?t("el-menu-item",{attrs:{index:"/teacher-review"}},[t("i",{staticClass:"el-icon-edit-outline"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("教师点评")])]):e._e()],2),t("el-submenu",{attrs:{index:"7"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-data-analysis"}),t("span",[e._v("数据统计与分析")])]),t("el-menu-item",{attrs:{index:"/analysis"}},[t("i",{staticClass:"el-icon-pie-chart"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("统计分析")])])],2)],1)],1)]),t("el-container",[t("el-header",{attrs:{height:"60px"}},[t("div",{staticClass:"header-left"},[t("i",{class:["el-icon-s-fold","trigger",e.isCollapse?"is-active":""],on:{click:e.toggleSidebar}}),t("Breadcrumb")],1),t("div",{staticClass:"header-right"},[t("el-dropdown",{attrs:{trigger:"click"},on:{command:e.handleCommand}},[t("div",{staticClass:"user-profile"},[t("el-avatar",{attrs:{size:32,icon:"el-icon-user"}}),t("span",{staticClass:"user-name"},[e._v(e._s(e.userInfo.name||"用户"))]),t("i",{staticClass:"el-icon-caret-bottom el-icon--right"})],1),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"profile"}},[t("i",{staticClass:"el-icon-user"}),e._v(" 个人中心 ")]),t("el-dropdown-item",{attrs:{divided:"",command:"logout"}},[t("i",{staticClass:"el-icon-switch-button"}),e._v(" 退出登录 ")])],1)],1)],1)]),t("el-main",[t("router-view")],1)],1)],1)},P=[],S=(s(44114),function(){var e=this,t=e._self._c;return t("el-breadcrumb",{staticClass:"app-breadcrumb",attrs:{separator:"/"}},[t("transition-group",{attrs:{name:"breadcrumb"}},e._l(e.levelList,(function(s,a){return t("el-breadcrumb-item",{key:s.key},[a===e.levelList.length-1?t("span",{staticClass:"no-redirect"},[e._v(e._s(s.meta.title))]):t("a",{on:{click:function(t){return t.preventDefault(),e.handleLink(s)}}},[e._v(e._s(s.meta.title))])])})),1)],1)}),N=[],A=(s(18111),s(22489),s(61701),s(13579),{name:"Breadcrumb",data(){return{levelList:[]}},watch:{$route:{handler(e){this.getBreadcrumb()},immediate:!0}},methods:{getBreadcrumb(){let e=this.$route.matched.filter((e=>e.meta&&e.meta.title));const t=e[0];this.isHome(t)||e.some((e=>this.isHome(e)))||(e=[{path:"/analysis",meta:{title:"首页"}}].concat(e)),this.levelList=e.map(((e,t)=>({...e,key:`${e.path}-${t}`})))},isHome(e){return e&&"/analysis"===e.path},handleLink(e){const{path:t}=e;this.$router.push(t)}}}),F=A,D=(0,n.A)(F,S,N,!1,null,"c1dd9e0a",null),T=D.exports,R={name:"Layout",components:{Breadcrumb:T},data(){return{isCollapse:!1}},computed:{...(0,m.aH)({userInfo:e=>e.user.userInfo}),isStudent(){return"student"===this.userInfo.role}},methods:{hasRole(e){return!!this.userInfo.role&&(Array.isArray(e)?e.includes(this.userInfo.role):this.userInfo.role===e)},toggleSidebar(){this.isCollapse=!this.isCollapse},async handleCommand(e){switch(e){case"profile":this.$router.push("/profile");break;case"logout":try{await this.$store.dispatch("user/logoutUser"),await this.$store.dispatch("permission/initializePermissions",{role:"",userId:""}),this.$router.push("/login")}catch(t){console.error("退出登录失败:",t),this.$message.error("退出登录失败，请重试")}break}}}},E=R,U=(0,n.A)(E,x,P,!1,null,"75eeed62",null),$=U.exports,L=function(){var e=this,t=e._self._c;return t("div",{staticClass:"login-container"},[t("div",{staticClass:"login-box"},[t("h2",[e._v("军方仿真训练管理系统")]),t("div",{staticClass:"login-form"},[t("div",{staticClass:"form-item"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],attrs:{type:"text",placeholder:"用户名"},domProps:{value:e.username},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleLogin.apply(null,arguments)},input:function(t){t.target.composing||(e.username=t.target.value)}}})]),t("div",{staticClass:"form-item"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],attrs:{type:"password",placeholder:"密码"},domProps:{value:e.password},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleLogin.apply(null,arguments)},input:function(t){t.target.composing||(e.password=t.target.value)}}})]),t("div",{staticClass:"form-options"},[t("label",{staticClass:"remember-password"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.rememberPassword,expression:"rememberPassword"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.rememberPassword)?e._i(e.rememberPassword,null)>-1:e.rememberPassword},on:{change:function(t){var s=e.rememberPassword,a=t.target,r=!!a.checked;if(Array.isArray(s)){var i=null,o=e._i(s,i);a.checked?o<0&&(e.rememberPassword=s.concat([i])):o>-1&&(e.rememberPassword=s.slice(0,o).concat(s.slice(o+1)))}else e.rememberPassword=r}}}),e._v(" 记住密码 ")]),t("a",{staticClass:"forget-password",on:{click:e.showForgetPasswordTip}},[e._v("忘记密码？")])]),t("button",{staticClass:"login-button",on:{click:e.handleLogin}},[e._v("登录")])])])])},G=[],q=(s(64979),{name:"LoginPage",data(){return{username:"",password:"",rememberPassword:!1}},methods:{...(0,m.i0)({loginUser:"user/loginUser",initializePermissions:"permission/initializePermissions"}),async handleLogin(){if(this.username&&this.password)try{const e=await this.loginUser({username:this.username,password:this.password});await this.initializePermissions({role:e.data.userInfo.role,userId:e.data.userInfo.id}),this.rememberPassword?(localStorage.setItem("savedUsername",this.username),localStorage.setItem("savedPassword",btoa(this.password))):(localStorage.removeItem("savedUsername"),localStorage.removeItem("savedPassword")),localStorage.setItem("isAuthenticated","true"),localStorage.setItem("userRole",e.data.userInfo.role),this.$router.push("/analysis")}catch(e){console.error("登录错误:",e),this.$message.error("登录失败，请稍后重试")}else this.$message.error("请输入用户名和密码")},showForgetPasswordTip(){this.$message.info("请联系管理员获取账号密码")}},created(){if(localStorage.getItem("isAuthenticated")){const e=localStorage.getItem("userRole")||"student";this.$store.dispatch("permission/initializePermissions",{role:e,userId:this.$store.state.user.userInfo?.userId}),this.$router.push("/analysis")}else{const e=localStorage.getItem("savedUsername"),t=localStorage.getItem("savedPassword");e&&t&&(this.username=e,this.password=atob(t),this.rememberPassword=!0)}}}),K=q,z=(0,n.A)(K,L,G,!1,null,"db7d61c4",null),O=z.exports,V=(s(14809),function(){var e=this,t=e._self._c;return t("div",{staticClass:"user-management-container"},[t("div",{staticClass:"page-header"},[t("h1",{staticClass:"page-title"},[e._v("用户管理")]),t("div",{staticClass:"header-actions"},[e.isAdmin?t("button",{staticClass:"add-user-btn",on:{click:e.openAddUserModal}},[t("i",{staticClass:"el-icon-plus"}),e._v(" 新增用户 ")]):e._e()])]),t("div",{staticClass:"search-panel"},[t("div",{staticClass:"search-form"},[t("div",{staticClass:"form-item"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchKeyword,expression:"searchKeyword"}],staticClass:"search-input",attrs:{type:"text",placeholder:"请输入用户名/姓名搜索"},domProps:{value:e.searchKeyword},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchUsers.apply(null,arguments)},input:function(t){t.target.composing||(e.searchKeyword=t.target.value)}}})]),t("div",{staticClass:"form-item"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.filterRole,expression:"filterRole"}],staticClass:"filter-select",on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.filterRole=t.target.multiple?s:s[0]}}},[t("option",{attrs:{value:""}},[e._v("全部角色")]),e._l(e.roles,(function(s){return t("option",{key:s.id,domProps:{value:s.id}},[e._v(" "+e._s(s.name)+" ")])}))],2)]),t("div",{staticClass:"form-item"},[t("button",{staticClass:"search-btn",on:{click:e.searchUsers}},[e._v("查询")]),t("button",{staticClass:"reset-btn",on:{click:e.resetSearch}},[e._v("重置")])])])]),t("div",{staticClass:"table-panel"},[t("table",{staticClass:"data-table"},[e._m(0),t("tbody",[e._l(e.filteredUsers,(function(s,a){return t("tr",{key:s.id},[t("td",{staticClass:"text-center"},[e._v(e._s((e.currentPage-1)*e.pageSize+a+1))]),t("td",[e._v(e._s(s.username))]),t("td",[e._v(e._s(s.fullName))]),t("td",[t("span",{staticClass:"role-badge",class:e.getRoleType(s.roleId)},[e._v(" "+e._s(e.getRoleName(s.roleId))+" ")])]),t("td",[e._v(e._s(s.department))]),t("td",[e._v(e._s(e.formatDate(s.lastLogin)))]),t("td",{staticClass:"action-column"},[e.isAdmin?[e.canEditUserRole(s)?t("button",{staticClass:"action-btn edit-btn",on:{click:function(t){return e.openEditRoleModal(s)}}},[e._v(" 修改角色 ")]):e._e(),t("button",{staticClass:"action-btn password-btn",on:{click:function(t){return e.openModifyPasswordModal(s)}}},[e._v(" 修改密码 ")]),e.canDeleteUser(s)?t("button",{staticClass:"action-btn delete-btn",on:{click:function(t){return e.confirmDeleteUser(s)}}},[e._v(" 删除 ")]):e._e()]:e._e()],2)])})),0===e.filteredUsers.length?t("tr",[t("td",{staticClass:"empty-data",attrs:{colspan:"7"}},[e._v("暂无用户数据")])]):e._e()],2)])]),e.totalPages>1?t("div",{staticClass:"pagination"},[t("button",{staticClass:"page-btn",attrs:{disabled:1===e.currentPage},on:{click:function(t){return e.changePage(e.currentPage-1)}}},[e._v(" 上一页 ")]),t("span",{staticClass:"page-info"},[e._v("第 "+e._s(e.currentPage)+" / "+e._s(e.totalPages)+" 页")]),t("button",{staticClass:"page-btn",attrs:{disabled:e.currentPage===e.totalPages},on:{click:function(t){return e.changePage(e.currentPage+1)}}},[e._v(" 下一页 ")])]):e._e(),t("el-dialog",{staticClass:"custom-dialog",attrs:{title:"新增用户",visible:e.showAddUserModal,width:"500px","close-on-click-modal":!1},on:{"update:visible":function(t){e.showAddUserModal=t}}},[t("div",{staticClass:"dialog-body"},[t("div",{staticClass:"form-group"},[t("label",{staticClass:"required"},[e._v("用户名")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.newUserForm.username,expression:"newUserForm.username"}],staticClass:"form-input",attrs:{type:"text",placeholder:"请输入用户名"},domProps:{value:e.newUserForm.username},on:{input:function(t){t.target.composing||e.$set(e.newUserForm,"username",t.target.value)}}}),e.newUserForm.errors.username?t("div",{staticClass:"error-text"},[e._v(e._s(e.newUserForm.errors.username))]):e._e()]),t("div",{staticClass:"form-group"},[t("label",{staticClass:"required"},[e._v("姓名")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.newUserForm.fullName,expression:"newUserForm.fullName"}],staticClass:"form-input",attrs:{type:"text",placeholder:"请输入姓名"},domProps:{value:e.newUserForm.fullName},on:{input:function(t){t.target.composing||e.$set(e.newUserForm,"fullName",t.target.value)}}}),e.newUserForm.errors.fullName?t("div",{staticClass:"error-text"},[e._v(e._s(e.newUserForm.errors.fullName))]):e._e()]),t("div",{staticClass:"form-group"},[t("label",{staticClass:"required"},[e._v("角色")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.newUserForm.roleId,expression:"newUserForm.roleId"}],staticClass:"form-input",on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.newUserForm,"roleId",t.target.multiple?s:s[0])}}},[t("option",{attrs:{value:""}},[e._v("请选择角色")]),e._l(e.roles,(function(s){return t("option",{key:s.id,domProps:{value:s.id}},[e._v(" "+e._s(s.name)+" ")])}))],2),e.newUserForm.errors.roleId?t("div",{staticClass:"error-text"},[e._v(e._s(e.newUserForm.errors.roleId))]):e._e()]),t("div",{staticClass:"form-group"},[t("label",{staticClass:"required"},[e._v("部门/班级")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.newUserForm.department,expression:"newUserForm.department"}],staticClass:"form-input",attrs:{type:"text",placeholder:"请输入部门或班级"},domProps:{value:e.newUserForm.department},on:{input:function(t){t.target.composing||e.$set(e.newUserForm,"department",t.target.value)}}}),e.newUserForm.errors.department?t("div",{staticClass:"error-text"},[e._v(e._s(e.newUserForm.errors.department))]):e._e()]),t("div",{staticClass:"form-group"},[t("label",{staticClass:"required"},[e._v("密码")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.newUserForm.password,expression:"newUserForm.password"}],staticClass:"form-input",attrs:{type:"password",placeholder:"请输入密码"},domProps:{value:e.newUserForm.password},on:{input:function(t){t.target.composing||e.$set(e.newUserForm,"password",t.target.value)}}}),e.newUserForm.errors.password?t("div",{staticClass:"error-text"},[e._v(e._s(e.newUserForm.errors.password))]):e._e(),t("div",{staticClass:"hint-text"},[e._v("密码长度至少8位，必须包含字母和数字")])]),t("div",{staticClass:"form-group"},[t("label",{staticClass:"required"},[e._v("确认密码")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.newUserForm.confirmPassword,expression:"newUserForm.confirmPassword"}],staticClass:"form-input",attrs:{type:"password",placeholder:"请再次输入密码"},domProps:{value:e.newUserForm.confirmPassword},on:{input:function(t){t.target.composing||e.$set(e.newUserForm,"confirmPassword",t.target.value)}}}),e.newUserForm.errors.confirmPassword?t("div",{staticClass:"error-text"},[e._v(e._s(e.newUserForm.errors.confirmPassword))]):e._e()])]),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("button",{staticClass:"btn cancel-btn",on:{click:e.closeAddUserModal}},[e._v("取 消")]),t("button",{staticClass:"btn confirm-btn",attrs:{disabled:!e.isNewUserFormValid},on:{click:e.addUser}},[e._v(" 确 定 ")])])]),t("el-dialog",{staticClass:"custom-dialog",attrs:{title:"修改用户密码",visible:e.showModifyPasswordModal,width:"500px","close-on-click-modal":!1},on:{"update:visible":function(t){e.showModifyPasswordModal=t}}},[t("div",{staticClass:"dialog-body"},[t("div",{staticClass:"user-info"},[e._v(" 正在修改用户 "),t("span",{staticClass:"highlight"},[e._v(e._s(e.selectedUser.username))]),e._v(" ("+e._s(e.selectedUser.fullName)+") 的密码 ")]),t("div",{staticClass:"form-group"},[t("label",{staticClass:"required"},[e._v("新密码")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.modifyPasswordForm.newPassword,expression:"modifyPasswordForm.newPassword"}],staticClass:"form-input",attrs:{type:"password",placeholder:"请输入新密码"},domProps:{value:e.modifyPasswordForm.newPassword},on:{input:function(t){t.target.composing||e.$set(e.modifyPasswordForm,"newPassword",t.target.value)}}}),e.modifyPasswordForm.errors.newPassword?t("div",{staticClass:"error-text"},[e._v(e._s(e.modifyPasswordForm.errors.newPassword))]):e._e(),t("div",{staticClass:"hint-text"},[e._v("密码长度至少8位，必须包含字母和数字")])]),t("div",{staticClass:"form-group"},[t("label",{staticClass:"required"},[e._v("确认新密码")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.modifyPasswordForm.confirmPassword,expression:"modifyPasswordForm.confirmPassword"}],staticClass:"form-input",attrs:{type:"password",placeholder:"请再次输入新密码"},domProps:{value:e.modifyPasswordForm.confirmPassword},on:{input:function(t){t.target.composing||e.$set(e.modifyPasswordForm,"confirmPassword",t.target.value)}}}),e.modifyPasswordForm.errors.confirmPassword?t("div",{staticClass:"error-text"},[e._v(e._s(e.modifyPasswordForm.errors.confirmPassword))]):e._e()])]),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("button",{staticClass:"btn cancel-btn",on:{click:e.closeModifyPasswordModal}},[e._v("取 消")]),t("button",{staticClass:"btn confirm-btn",attrs:{disabled:!e.isModifyPasswordFormValid},on:{click:e.modifyPassword}},[e._v(" 确 定 ")])])]),t("el-dialog",{staticClass:"custom-dialog",attrs:{title:"删除用户",visible:e.showDeleteConfirmModal,width:"400px","close-on-click-modal":!1},on:{"update:visible":function(t){e.showDeleteConfirmModal=t}}},[t("div",{staticClass:"dialog-body"},[t("div",{staticClass:"confirm-message"},[e._v(" 确定要删除用户 "),t("span",{staticClass:"highlight danger"},[e._v(e._s(e.selectedUser.username))]),e._v(" ("+e._s(e.selectedUser.fullName)+") 吗？ "),t("div",{staticClass:"warning-text"},[e._v("此操作不可恢复，请谨慎操作！")])])]),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("button",{staticClass:"btn cancel-btn",on:{click:e.closeDeleteConfirmModal}},[e._v("取 消")]),t("button",{staticClass:"btn delete-btn",on:{click:e.deleteUser}},[e._v("确定删除")])])])],1)}),Q=[function(){var e=this,t=e._self._c;return t("thead",[t("tr",[t("th",{attrs:{width:"60"}},[e._v("序号")]),t("th",{attrs:{width:"120"}},[e._v("用户名")]),t("th",{attrs:{width:"120"}},[e._v("姓名")]),t("th",{attrs:{width:"120"}},[e._v("角色")]),t("th",{attrs:{width:"150"}},[e._v("部门/班级")]),t("th",{attrs:{width:"180"}},[e._v("最后登录时间")]),t("th",{attrs:{width:"200"}},[e._v("操作")])])])}],B=(s(20116),{name:"UserManagement",data(){return{searchKeyword:"",filterRole:"",currentPage:1,pageSize:10,showEditRoleModal:!1,editingUser:{id:null,username:"",fullName:"",roleId:null},showResetPasswordModal:!1,resetPasswordUser:{id:null,username:"",fullName:""},resetPasswordForm:{newPassword:"",confirmPassword:"",error:""},roles:[{id:1,name:"系统管理员",type:"admin",description:"拥有系统全部功能的访问权限，可以进行系统配置、用户管理等操作"},{id:2,name:"导调员",type:"operation",description:"可以管理班级、编组、课程，查看学员成绩，进行评价"},{id:3,name:"学员",type:"view",description:"可以查看课程、进行训练，查看自己的成绩和评价"},{id:4,name:"训练监督",type:"operation",description:"可以查看所有班级的训练情况，进行监督和评价"},{id:5,name:"资料管理员",type:"operation",description:"负责上传、管理训练资料和多媒体教学内容"}],users:[{id:1,username:"admin",fullName:"张系统",roleId:1,department:"系统管理部",lastLogin:new Date("2023-05-14 10:25:33")},{id:2,username:"instructor_li",fullName:"李教官",roleId:2,department:"训练教导队",lastLogin:new Date("2023-05-14 09:15:22")},{id:3,username:"student_wang",fullName:"王学员",roleId:3,department:"新兵连一班",lastLogin:new Date("2023-05-13 16:42:11")},{id:4,username:"supervisor_zhao",fullName:"赵督导",roleId:4,department:"训练督导组",lastLogin:new Date("2023-05-13 14:30:40")},{id:5,username:"material_chen",fullName:"陈管理",roleId:5,department:"资料管理科",lastLogin:new Date("2023-05-12 11:20:18")},{id:6,username:"instructor_sun",fullName:"孙教官",roleId:2,department:"特战训练队",lastLogin:new Date("2023-05-12 09:05:47")},{id:7,username:"student_liu",fullName:"刘学员",roleId:3,department:"新兵连二班",lastLogin:new Date("2023-05-11 15:38:29")},{id:8,username:"student_yang",fullName:"杨学员",roleId:3,department:"新兵连一班",lastLogin:new Date("2023-05-11 14:22:05")},{id:9,username:"student_zhang",fullName:"张学员",roleId:3,department:"特种作战训练班",lastLogin:new Date("2023-05-10 16:30:45")},{id:10,username:"student_zhao",fullName:"赵学员",roleId:3,department:"特种作战训练班",lastLogin:new Date("2023-05-10 15:45:12")},{id:11,username:"student_qian",fullName:"钱学员",roleId:3,department:"特种作战训练班",lastLogin:new Date("2023-05-10 14:22:36")},{id:12,username:"student_sun",fullName:"孙学员",roleId:3,department:"特种作战训练班",lastLogin:new Date("2023-05-10 11:15:20")},{id:13,username:"student_li",fullName:"李学员",roleId:3,department:"特种作战训练班",lastLogin:new Date("2023-05-09 16:40:55")},{id:14,username:"student_zhou",fullName:"周学员",roleId:3,department:"特种作战训练班",lastLogin:new Date("2023-05-09 15:35:42")},{id:15,username:"student_wu",fullName:"吴学员",roleId:3,department:"特种作战训练班",lastLogin:new Date("2023-05-09 14:28:33")},{id:16,username:"student_zheng",fullName:"郑学员",roleId:3,department:"特种作战训练班",lastLogin:new Date("2023-05-09 11:05:19")},{id:17,username:"student_gao",fullName:"高学员",roleId:3,department:"新兵连一班",lastLogin:new Date("2023-05-08 16:22:15")},{id:18,username:"student_lin",fullName:"林学员",roleId:3,department:"新兵连一班",lastLogin:new Date("2023-05-08 15:10:25")},{id:19,username:"student_he",fullName:"何学员",roleId:3,department:"新兵连一班",lastLogin:new Date("2023-05-08 14:15:30")},{id:20,username:"student_ma",fullName:"马学员",roleId:3,department:"新兵连一班",lastLogin:new Date("2023-05-08 11:20:40")},{id:21,username:"student_luo",fullName:"罗学员",roleId:3,department:"新兵连一班",lastLogin:new Date("2023-05-07 16:35:22")},{id:22,username:"student_peng",fullName:"彭学员",roleId:3,department:"新兵连一班",lastLogin:new Date("2023-05-07 15:30:18")},{id:23,username:"student_chen",fullName:"陈学员",roleId:3,department:"新兵连一班",lastLogin:new Date("2023-05-07 14:25:10")},{id:24,username:"student_xie",fullName:"谢学员",roleId:3,department:"新兵连一班",lastLogin:new Date("2023-05-07 11:15:05")},{id:25,username:"student_hu",fullName:"胡学员",roleId:3,department:"新兵连二班",lastLogin:new Date("2023-05-06 16:45:30")},{id:26,username:"student_tian",fullName:"田学员",roleId:3,department:"新兵连二班",lastLogin:new Date("2023-05-06 15:40:25")},{id:27,username:"student_xu",fullName:"徐学员",roleId:3,department:"新兵连二班",lastLogin:new Date("2023-05-06 14:35:20")},{id:28,username:"student_deng",fullName:"邓学员",roleId:3,department:"新兵连二班",lastLogin:new Date("2023-05-06 11:30:15")},{id:29,username:"student_cao",fullName:"曹学员",roleId:3,department:"新兵连二班",lastLogin:new Date("2023-05-05 16:25:10")},{id:30,username:"student_feng",fullName:"冯学员",roleId:3,department:"新兵连二班",lastLogin:new Date("2023-05-05 15:20:05")},{id:31,username:"student_tang",fullName:"唐学员",roleId:3,department:"新兵连二班",lastLogin:new Date("2023-05-05 14:15:00")},{id:32,username:"student_pan",fullName:"潘学员",roleId:3,department:"新兵连二班",lastLogin:new Date("2023-05-05 11:10:55")},{id:33,username:"student_liang",fullName:"梁学员",roleId:3,department:"新兵连二班",lastLogin:new Date("2023-05-04 16:05:50")}],showAddUserModal:!1,newUserForm:{username:"",fullName:"",roleId:"",department:"",password:"",confirmPassword:"",errors:{username:"",fullName:"",roleId:"",department:"",password:"",confirmPassword:""}},showModifyPasswordModal:!1,modifyPasswordForm:{newPassword:"",confirmPassword:"",errors:{newPassword:"",confirmPassword:""}},showDeleteConfirmModal:!1,selectedUser:{id:null,username:"",fullName:""}}},computed:{...(0,m.L8)(["getUserInfo"]),currentUser(){return this.getUserInfo||{roleId:0,username:"unknown"}},isAdmin(){return"admin"===this.getUserInfo?.role},isResetPasswordFormValid(){return this.resetPasswordForm.newPassword&&this.resetPasswordForm.confirmPassword&&this.resetPasswordForm.newPassword===this.resetPasswordForm.confirmPassword&&this.validatePassword(this.resetPasswordForm.newPassword)},filteredUsers(){let e=[...this.users];if(this.searchKeyword){const t=this.searchKeyword.toLowerCase();e=e.filter((e=>e.username.toLowerCase().includes(t)||e.fullName.toLowerCase().includes(t)))}return this.filterRole&&(e=e.filter((e=>e.roleId===parseInt(this.filterRole)))),e},totalPages(){return Math.ceil(this.filteredUsers.length/this.pageSize)},isNewUserFormValid(){return this.newUserForm.username&&this.newUserForm.fullName&&this.newUserForm.roleId&&this.newUserForm.department&&this.newUserForm.password&&this.newUserForm.confirmPassword&&this.newUserForm.password===this.newUserForm.confirmPassword&&this.validatePassword(this.newUserForm.password)},isModifyPasswordFormValid(){return this.modifyPasswordForm.newPassword&&this.modifyPasswordForm.confirmPassword&&this.modifyPasswordForm.newPassword===this.modifyPasswordForm.confirmPassword&&this.validatePassword(this.modifyPasswordForm.newPassword)}},methods:{searchUsers(){this.currentPage=1},resetSearch(){this.searchKeyword="",this.filterRole="",this.currentPage=1},changePage(e){e>=1&&e<=this.totalPages&&(this.currentPage=e)},getRoleName(e){const t=this.roles.find((t=>t.id===e));return t?t.name:"未知角色"},getRoleType(e){const t=this.roles.find((t=>t.id===e));return t?t.type:"unknown"},formatDate(e){return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},canEditUserRole(e){return 1===this.currentUser.roleId&&this.currentUser.username!==e.username},canResetUserPassword(e){return this.isAdmin},openEditRoleModal(e){this.editingUser={...e},this.showEditRoleModal=!0},closeEditRoleModal(){this.showEditRoleModal=!1,this.editingUser={id:null,username:"",fullName:"",roleId:null}},getSelectedRoleDescription(){const e=this.roles.find((e=>e.id===this.editingUser.roleId));return e?e.description:""},saveUserRole(){const e=this.users.findIndex((e=>e.id===this.editingUser.id));-1!==e&&(this.users[e].roleId=this.editingUser.roleId,alert(`已成功将用户 ${this.editingUser.username} 的角色修改为 ${this.getRoleName(this.editingUser.roleId)}`),this.closeEditRoleModal())},openResetPasswordModal(e){this.resetPasswordUser={...e},this.resetPasswordForm={newPassword:"",confirmPassword:"",error:""},this.showResetPasswordModal=!0},closeResetPasswordModal(){this.showResetPasswordModal=!1,this.resetPasswordUser={id:null,username:"",fullName:""},this.resetPasswordForm={newPassword:"",confirmPassword:"",error:""}},validatePassword(e){const t=/\d/.test(e),s=/[a-zA-Z]/.test(e);return e.length>=8&&t&&s},async resetPassword(){if(this.validatePassword(this.resetPasswordForm.newPassword))if(this.resetPasswordForm.newPassword===this.resetPasswordForm.confirmPassword)try{await this.$api.resetUserPassword({userId:this.resetPasswordUser.id,newPassword:this.resetPasswordForm.newPassword}),this.$message.success(`已成功修改用户 ${this.resetPasswordUser.username} 的密码`),this.closeResetPasswordModal()}catch(e){console.error("修改密码失败:",e),this.$message.error("密码修改失败，请重试")}else this.resetPasswordForm.error="两次输入的密码不一致";else this.resetPasswordForm.error="密码必须至少8位，且包含字母和数字"},canModifyUserPassword(e){return this.isAdmin},canDeleteUser(e){return this.isAdmin&&this.currentUser.username!==e.username},openAddUserModal(){this.newUserForm={username:"",fullName:"",roleId:"",department:"",password:"",confirmPassword:"",errors:{username:"",fullName:"",roleId:"",department:"",password:"",confirmPassword:""}},this.showAddUserModal=!0},closeAddUserModal(){this.showAddUserModal=!1},async addUser(){if(this.validateNewUserForm())try{const e=await this.$api.createUser({username:this.newUserForm.username,fullName:this.newUserForm.fullName,roleId:this.newUserForm.roleId,department:this.newUserForm.department,password:this.newUserForm.password});this.users.push(e.data),this.$message.success("用户创建成功"),this.closeAddUserModal()}catch(e){console.error("创建用户失败:",e),this.$message.error("创建用户失败，请重试")}},validateNewUserForm(){let e=!0;return this.newUserForm.errors={username:"",fullName:"",roleId:"",department:"",password:"",confirmPassword:""},this.newUserForm.username||(this.newUserForm.errors.username="请输入用户名",e=!1),this.newUserForm.fullName||(this.newUserForm.errors.fullName="请输入姓名",e=!1),this.newUserForm.roleId||(this.newUserForm.errors.roleId="请选择角色",e=!1),this.newUserForm.department||(this.newUserForm.errors.department="请输入部门/班级",e=!1),this.newUserForm.password?this.validatePassword(this.newUserForm.password)||(this.newUserForm.errors.password="密码必须至少8位，且包含字母和数字",e=!1):(this.newUserForm.errors.password="请输入密码",e=!1),this.newUserForm.confirmPassword?this.newUserForm.password!==this.newUserForm.confirmPassword&&(this.newUserForm.errors.confirmPassword="两次输入的密码不一致",e=!1):(this.newUserForm.errors.confirmPassword="请再次输入密码",e=!1),e},openModifyPasswordModal(e){this.selectedUser={...e},this.modifyPasswordForm={newPassword:"",confirmPassword:"",errors:{newPassword:"",confirmPassword:""}},this.showModifyPasswordModal=!0},closeModifyPasswordModal(){this.showModifyPasswordModal=!1,this.selectedUser={id:null,username:"",fullName:""},this.modifyPasswordForm={newPassword:"",confirmPassword:"",errors:{newPassword:"",confirmPassword:""}}},async modifyPassword(){if(this.validateModifyPasswordForm())try{await this.$api.modifyUserPassword({userId:this.selectedUser.id,newPassword:this.modifyPasswordForm.newPassword}),this.$message.success(`已成功修改用户 ${this.selectedUser.username} 的密码`),this.closeModifyPasswordModal()}catch(e){console.error("修改密码失败:",e),this.$message.error("密码修改失败，请重试")}},validateModifyPasswordForm(){let e=!0;return this.modifyPasswordForm.errors={newPassword:"",confirmPassword:""},this.modifyPasswordForm.newPassword?this.validatePassword(this.modifyPasswordForm.newPassword)||(this.modifyPasswordForm.errors.newPassword="密码必须至少8位，且包含字母和数字",e=!1):(this.modifyPasswordForm.errors.newPassword="请输入新密码",e=!1),this.modifyPasswordForm.confirmPassword?this.modifyPasswordForm.newPassword!==this.modifyPasswordForm.confirmPassword&&(this.modifyPasswordForm.errors.confirmPassword="两次输入的密码不一致",e=!1):(this.modifyPasswordForm.errors.confirmPassword="请再次输入新密码",e=!1),e},confirmDeleteUser(e){this.selectedUser={...e},this.showDeleteConfirmModal=!0},closeDeleteConfirmModal(){this.showDeleteConfirmModal=!1,this.selectedUser={id:null,username:"",fullName:""}},async deleteUser(){try{await this.$api.deleteUser(this.selectedUser.id);const e=this.users.findIndex((e=>e.id===this.selectedUser.id));-1!==e&&this.users.splice(e,1),this.$message.success(`已成功删除用户 ${this.selectedUser.username}`),this.closeDeleteConfirmModal()}catch(e){console.error("删除用户失败:",e),this.$message.error("删除用户失败，请重试")}}}}),j=B,H=(0,n.A)(j,V,Q,!1,null,"0783107e",null),Y=H.exports,W=function(){var e=this,t=e._self._c;return t("div",{staticClass:"class-management-container"},[t("h1",{staticClass:"page-title"},[e._v("班级管理")]),t("div",{staticClass:"action-bar"},[t("div",{staticClass:"search-area"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchKeyword,expression:"searchKeyword"}],staticClass:"search-input",attrs:{type:"text",placeholder:"请输入班级名称/代号搜索"},domProps:{value:e.searchKeyword},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchClasses.apply(null,arguments)},input:function(t){t.target.composing||(e.searchKeyword=t.target.value)}}}),t("select",{directives:[{name:"model",rawName:"v-model",value:e.filterInstructorId,expression:"filterInstructorId"}],staticClass:"filter-select",on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.filterInstructorId=t.target.multiple?s:s[0]}}},[t("option",{attrs:{value:""}},[e._v("全部教员")]),e._l(e.instructors,(function(s){return t("option",{key:s.id,domProps:{value:s.id}},[e._v(" "+e._s(s.fullName)+" ")])}))],2),t("button",{staticClass:"search-btn",on:{click:e.searchClasses}},[e._v("查询")]),t("button",{staticClass:"reset-btn",on:{click:e.resetSearch}},[e._v("重置")])]),t("div",{staticClass:"action-btns"},[t("button",{staticClass:"create-btn",on:{click:e.openCreateModal}},[e._v("创建班级")])])]),t("div",{staticClass:"class-list"},[t("table",{staticClass:"class-table"},[e._m(0),t("tbody",[e._l(e.filteredClasses,(function(s,a){return t("tr",{key:s.id},[t("td",[e._v(e._s(a+1))]),t("td",[e._v(e._s(s.name))]),t("td",[e._v(e._s(s.code))]),t("td",[s.instructors.length>0?t("div",e._l(s.instructors,(function(a,r){return t("span",{key:a.id,staticClass:"instructor-tag"},[e._v(" "+e._s(a.fullName)+e._s(r<s.instructors.length-1?"，":"")+" ")])})),0):t("span",{staticClass:"empty-text"},[e._v("未分配")])]),t("td",[e._v(e._s(s.students.length)+" 人")]),t("td",[e._v(e._s(e.formatDate(s.createdAt)))]),t("td",{staticClass:"actions-cell"},[t("button",{staticClass:"view-btn",on:{click:function(t){return e.viewClassDetails(s)}}},[e._v("查看详情")]),t("button",{staticClass:"edit-btn",on:{click:function(t){return e.openEditModal(s)}}},[e._v("修改")]),t("button",{staticClass:"delete-btn",on:{click:function(t){return e.confirmDelete(s)}}},[e._v("删除")])])])})),0===e.filteredClasses.length?t("tr",[t("td",{staticClass:"empty-data",attrs:{colspan:"7"}},[e._v("暂无班级数据")])]):e._e()],2)])]),e.totalPages>1?t("div",{staticClass:"pagination-area"},[t("button",{staticClass:"pagination-btn",attrs:{disabled:1===e.currentPage},on:{click:function(t){return e.changePage(e.currentPage-1)}}},[e._v(" 上一页 ")]),t("span",{staticClass:"pagination-info"},[e._v(e._s(e.currentPage)+" / "+e._s(e.totalPages))]),t("button",{staticClass:"pagination-btn",attrs:{disabled:e.currentPage===e.totalPages},on:{click:function(t){return e.changePage(e.currentPage+1)}}},[e._v(" 下一页 ")])]):e._e(),e.showDetailModal?t("div",{staticClass:"modal-backdrop",on:{click:e.closeDetailModal}}):e._e(),e.showDetailModal?t("div",{staticClass:"modal detail-modal"},[t("div",{staticClass:"modal-header"},[t("h3",[e._v("班级详情："+e._s(e.detailClass.name)+" ("+e._s(e.detailClass.code)+")")]),t("button",{staticClass:"modal-close",on:{click:e.closeDetailModal}},[e._v("×")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"detail-section"},[t("div",{staticClass:"detail-item"},[t("div",{staticClass:"detail-label"},[e._v("班级名称")]),t("div",{staticClass:"detail-value"},[e._v(e._s(e.detailClass.name))])]),t("div",{staticClass:"detail-item"},[t("div",{staticClass:"detail-label"},[e._v("班级代号")]),t("div",{staticClass:"detail-value"},[e._v(e._s(e.detailClass.code))])]),t("div",{staticClass:"detail-item"},[t("div",{staticClass:"detail-label"},[e._v("创建时间")]),t("div",{staticClass:"detail-value"},[e._v(e._s(e.formatDate(e.detailClass.createdAt)))])]),t("div",{staticClass:"detail-item"},[t("div",{staticClass:"detail-label"},[e._v("班级描述")]),t("div",{staticClass:"detail-value description"},[e._v(e._s(e.detailClass.description))])])]),t("div",{staticClass:"detail-section"},[t("div",{staticClass:"section-header"},[t("h4",[e._v("教员管理")]),t("button",{staticClass:"add-btn",on:{click:e.openAddInstructorModal}},[e._v("添加教员")])]),e.detailClass.instructors.length>0?t("div",{staticClass:"member-list"},e._l(e.detailClass.instructors,(function(s){return t("div",{key:s.id,staticClass:"member-item"},[t("div",{staticClass:"member-info"},[t("div",{staticClass:"member-name"},[e._v(e._s(s.fullName))]),t("div",{staticClass:"member-username"},[e._v(e._s(s.username))])]),t("button",{staticClass:"remove-btn",on:{click:function(t){return e.confirmRemoveInstructor(s)}}},[e._v("移除")])])})),0):t("div",{staticClass:"empty-members"},[e._v("暂无教员，请添加教员")])]),t("div",{staticClass:"detail-section"},[t("div",{staticClass:"section-header"},[t("h4",[e._v("学员管理")]),t("button",{staticClass:"add-btn",on:{click:e.openAddStudentModal}},[e._v("添加学员")])]),e.detailClass.students.length>0?t("div",{staticClass:"member-list"},e._l(e.detailClass.students,(function(s){return t("div",{key:s.id,staticClass:"member-item"},[t("div",{staticClass:"member-info"},[t("div",{staticClass:"member-name"},[e._v(e._s(s.fullName))]),t("div",{staticClass:"member-username"},[e._v(e._s(s.username))])]),t("button",{staticClass:"remove-btn",on:{click:function(t){return e.confirmRemoveStudent(s)}}},[e._v("移除")])])})),0):t("div",{staticClass:"empty-members"},[e._v("暂无学员，请添加学员")])])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"close-btn",on:{click:e.closeDetailModal}},[e._v("关闭")])])]):e._e(),e.showEditModal?t("div",{staticClass:"modal-backdrop",on:{click:e.closeEditModal}}):e._e(),e.showEditModal?t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-header"},[t("h3",[e._v(e._s(e.isCreating?"创建班级":"修改班级"))]),t("button",{staticClass:"modal-close",on:{click:e.closeEditModal}},[e._v("×")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"form-group"},[t("label",[e._v("班级名称")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.classForm.name,expression:"classForm.name"}],attrs:{type:"text",placeholder:"请输入班级名称"},domProps:{value:e.classForm.name},on:{input:function(t){t.target.composing||e.$set(e.classForm,"name",t.target.value)}}}),e.formErrors.name?t("p",{staticClass:"error-text"},[e._v(e._s(e.formErrors.name))]):e._e()]),t("div",{staticClass:"form-group"},[t("label",[e._v("班级代号")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.classForm.code,expression:"classForm.code"}],attrs:{type:"text",placeholder:"请输入班级代号"},domProps:{value:e.classForm.code},on:{input:function(t){t.target.composing||e.$set(e.classForm,"code",t.target.value)}}}),e.formErrors.code?t("p",{staticClass:"error-text"},[e._v(e._s(e.formErrors.code))]):e._e()]),t("div",{staticClass:"form-group"},[t("label",[e._v("班级描述")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.classForm.description,expression:"classForm.description"}],attrs:{placeholder:"请输入班级描述",rows:"3"},domProps:{value:e.classForm.description},on:{input:function(t){t.target.composing||e.$set(e.classForm,"description",t.target.value)}}}),e.formErrors.description?t("p",{staticClass:"error-text"},[e._v(e._s(e.formErrors.description))]):e._e()])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"cancel-btn",on:{click:e.closeEditModal}},[e._v("取消")]),t("button",{staticClass:"save-btn",on:{click:e.saveClass}},[e._v("保存")])])]):e._e(),e.showAddInstructorModal?t("div",{staticClass:"modal-backdrop",on:{click:e.closeAddInstructorModal}}):e._e(),e.showAddInstructorModal?t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-header"},[t("h3",[e._v("添加教员")]),t("button",{staticClass:"modal-close",on:{click:e.closeAddInstructorModal}},[e._v("×")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"search-input-group"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.instructorSearchKeyword,expression:"instructorSearchKeyword"}],staticClass:"modal-search-input",attrs:{type:"text",placeholder:"请输入教员账号/姓名搜索"},domProps:{value:e.instructorSearchKeyword},on:{input:[function(t){t.target.composing||(e.instructorSearchKeyword=t.target.value)},e.searchAvailableInstructors]}})]),t("div",{staticClass:"user-select-list"},[e._l(e.filteredAvailableInstructors,(function(s){return t("div",{key:s.id,staticClass:"user-select-item",class:{selected:e.selectedInstructors.includes(s.id)},on:{click:function(t){return e.toggleInstructorSelection(s.id)}}},[t("div",{staticClass:"user-info"},[t("div",{staticClass:"user-name"},[e._v(e._s(s.fullName))]),t("div",{staticClass:"user-username"},[e._v(e._s(s.username))]),t("div",{staticClass:"user-department"},[e._v(e._s(s.department))])]),t("div",{staticClass:"checkbox"},[e.selectedInstructors.includes(s.id)?t("span",[e._v("✓")]):e._e()])])})),0===e.filteredAvailableInstructors.length?t("div",{staticClass:"empty-users"},[e._v(" 没有可添加的教员或没有符合搜索条件的教员 ")]):e._e()],2)]),t("div",{staticClass:"modal-footer"},[e.selectedInstructors.length>0?t("div",{staticClass:"selection-count"},[e._v(" 已选择 "+e._s(e.selectedInstructors.length)+" 名教员 ")]):e._e(),t("div",{staticClass:"buttons"},[t("button",{staticClass:"cancel-btn",on:{click:e.closeAddInstructorModal}},[e._v("取消")]),t("button",{staticClass:"save-btn",attrs:{disabled:0===e.selectedInstructors.length},on:{click:e.addInstructorsToClass}},[e._v(" 添加 ")])])])]):e._e(),e.showAddStudentModal?t("div",{staticClass:"modal-backdrop",on:{click:e.closeAddStudentModal}}):e._e(),e.showAddStudentModal?t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-header"},[t("h3",[e._v("添加学员")]),t("button",{staticClass:"modal-close",on:{click:e.closeAddStudentModal}},[e._v("×")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"search-input-group"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.studentSearchKeyword,expression:"studentSearchKeyword"}],staticClass:"modal-search-input",attrs:{type:"text",placeholder:"请输入学员账号/姓名搜索"},domProps:{value:e.studentSearchKeyword},on:{input:[function(t){t.target.composing||(e.studentSearchKeyword=t.target.value)},e.searchAvailableStudents]}})]),t("div",{staticClass:"user-select-list"},[e._l(e.filteredAvailableStudents,(function(s){return t("div",{key:s.id,staticClass:"user-select-item",class:{selected:e.selectedStudents.includes(s.id)},on:{click:function(t){return e.toggleStudentSelection(s.id)}}},[t("div",{staticClass:"user-info"},[t("div",{staticClass:"user-name"},[e._v(e._s(s.fullName))]),t("div",{staticClass:"user-username"},[e._v(e._s(s.username))]),t("div",{staticClass:"user-department"},[e._v(e._s(s.department))])]),t("div",{staticClass:"checkbox"},[e.selectedStudents.includes(s.id)?t("span",[e._v("✓")]):e._e()])])})),0===e.filteredAvailableStudents.length?t("div",{staticClass:"empty-users"},[e._v(" 没有可添加的学员或没有符合搜索条件的学员 ")]):e._e()],2)]),t("div",{staticClass:"modal-footer"},[e.selectedStudents.length>0?t("div",{staticClass:"selection-count"},[e._v(" 已选择 "+e._s(e.selectedStudents.length)+" 名学员 ")]):e._e(),t("div",{staticClass:"buttons"},[t("button",{staticClass:"cancel-btn",on:{click:e.closeAddStudentModal}},[e._v("取消")]),t("button",{staticClass:"save-btn",attrs:{disabled:0===e.selectedStudents.length},on:{click:e.addStudentsToClass}},[e._v(" 添加 ")])])])]):e._e(),e.showDeleteConfirm?t("div",{staticClass:"modal-backdrop",on:{click:e.cancelDelete}}):e._e(),e.showDeleteConfirm?t("div",{staticClass:"modal delete-modal"},[t("div",{staticClass:"modal-header"},[t("h3",[e._v("确认删除")]),t("button",{staticClass:"modal-close",on:{click:e.cancelDelete}},[e._v("×")])]),t("div",{staticClass:"modal-body"},[t("p",{staticClass:"confirm-text"},[e._v(" 确定要删除班级 "),t("span",{staticClass:"highlight"},[e._v(e._s(e.pendingDeleteClass?.name))]),e._v(" 吗？"),t("br"),e._v(" 此操作将同时移除该班级中的所有学员和教员关联，但不会删除用户账号。此操作无法撤销。 ")])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"cancel-btn",on:{click:e.cancelDelete}},[e._v("取消")]),t("button",{staticClass:"delete-confirm-btn",on:{click:e.deleteClass}},[e._v("确认删除")])])]):e._e(),e.showRemoveConfirm?t("div",{staticClass:"modal-backdrop",on:{click:e.cancelRemoveMember}}):e._e(),e.showRemoveConfirm?t("div",{staticClass:"modal remove-modal"},[t("div",{staticClass:"modal-header"},[t("h3",[e._v("确认移除"+e._s(e.isRemovingInstructor?"教员":"学员"))]),t("button",{staticClass:"modal-close",on:{click:e.cancelRemoveMember}},[e._v("×")])]),t("div",{staticClass:"modal-body"},[t("p",{staticClass:"confirm-text"},[e._v(" 确定要将"+e._s(e.isRemovingInstructor?"教员":"学员")+" "),t("span",{staticClass:"highlight"},[e._v(e._s(e.pendingRemoveMember?.fullName))]),e._v(" 从班级 "),t("span",{staticClass:"highlight"},[e._v(e._s(e.detailClass.name))]),e._v(" 中移除吗？ ")])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"cancel-btn",on:{click:e.cancelRemoveMember}},[e._v("取消")]),t("button",{staticClass:"delete-confirm-btn",on:{click:e.removeMember}},[e._v("确认移除")])])]):e._e()])},X=[function(){var e=this,t=e._self._c;return t("thead",[t("tr",[t("th",{attrs:{width:"5%"}},[e._v("序号")]),t("th",{attrs:{width:"15%"}},[e._v("班级名称")]),t("th",{attrs:{width:"10%"}},[e._v("班级代号")]),t("th",{attrs:{width:"15%"}},[e._v("教员")]),t("th",{attrs:{width:"15%"}},[e._v("学员数量")]),t("th",{attrs:{width:"15%"}},[e._v("创建时间")]),t("th",{attrs:{width:"25%"}},[e._v("操作")])])])}],J={name:"ClassManagement",data(){return{searchKeyword:"",filterInstructorId:"",currentPage:1,pageSize:5,showDetailModal:!1,detailClass:{id:null,name:"",code:"",description:"",createdAt:null,instructors:[],students:[]},showEditModal:!1,isCreating:!1,classForm:{id:null,name:"",code:"",description:"",instructors:[],students:[]},formErrors:{name:"",code:"",description:""},showAddInstructorModal:!1,instructorSearchKeyword:"",selectedInstructors:[],showAddStudentModal:!1,studentSearchKeyword:"",selectedStudents:[],showDeleteConfirm:!1,pendingDeleteClass:null,showRemoveConfirm:!1,pendingRemoveMember:null,isRemovingInstructor:!1,classes:[{id:1,name:"新兵连一班",code:"XBL-01",description:"新入伍士兵基础训练班级，主要进行军事基础、体能训练和队列训练。",createdAt:new Date("2023-01-10"),instructors:[{id:2,username:"instructor_li",fullName:"李教官",department:"训练教导队"}],students:[{id:3,username:"student_wang",fullName:"王学员",department:"新兵连一班"},{id:8,username:"student_yang",fullName:"杨学员",department:"新兵连一班"},{id:17,username:"student_gao",fullName:"高学员",department:"新兵连一班"},{id:18,username:"student_lin",fullName:"林学员",department:"新兵连一班"},{id:19,username:"student_he",fullName:"何学员",department:"新兵连一班"},{id:20,username:"student_ma",fullName:"马学员",department:"新兵连一班"},{id:21,username:"student_luo",fullName:"罗学员",department:"新兵连一班"},{id:22,username:"student_peng",fullName:"彭学员",department:"新兵连一班"},{id:23,username:"student_chen",fullName:"陈学员",department:"新兵连一班"},{id:24,username:"student_xie",fullName:"谢学员",department:"新兵连一班"}]},{id:2,name:"新兵连二班",code:"XBL-02",description:"新入伍士兵基础训练班级，主要进行军事理论、战术训练和武器使用。",createdAt:new Date("2023-01-12"),instructors:[{id:6,username:"instructor_sun",fullName:"孙教官",department:"特战训练队"}],students:[{id:7,username:"student_liu",fullName:"刘学员",department:"新兵连二班"},{id:25,username:"student_hu",fullName:"胡学员",department:"新兵连二班"},{id:26,username:"student_tian",fullName:"田学员",department:"新兵连二班"},{id:27,username:"student_xu",fullName:"徐学员",department:"新兵连二班"},{id:28,username:"student_deng",fullName:"邓学员",department:"新兵连二班"},{id:29,username:"student_cao",fullName:"曹学员",department:"新兵连二班"},{id:30,username:"student_feng",fullName:"冯学员",department:"新兵连二班"},{id:31,username:"student_tang",fullName:"唐学员",department:"新兵连二班"},{id:32,username:"student_pan",fullName:"潘学员",department:"新兵连二班"},{id:33,username:"student_liang",fullName:"梁学员",department:"新兵连二班"}]},{id:3,name:"特种作战训练班",code:"TSC-01",description:"特种作战人员进阶训练班级，着重培训特种作战技能和战术协同。",createdAt:new Date("2023-02-05"),instructors:[{id:6,username:"instructor_sun",fullName:"孙教官",department:"特战训练队"}],students:[{id:9,username:"student_zhang",fullName:"张学员",department:"特种作战训练班"},{id:10,username:"student_zhao",fullName:"赵学员",department:"特种作战训练班"},{id:11,username:"student_qian",fullName:"钱学员",department:"特种作战训练班"},{id:12,username:"student_sun",fullName:"孙学员",department:"特种作战训练班"},{id:13,username:"student_li",fullName:"李学员",department:"特种作战训练班"},{id:14,username:"student_zhou",fullName:"周学员",department:"特种作战训练班"},{id:15,username:"student_wu",fullName:"吴学员",department:"特种作战训练班"},{id:16,username:"student_zheng",fullName:"郑学员",department:"特种作战训练班"}]}],instructors:[{id:2,username:"instructor_li",fullName:"李教官",roleId:2,department:"训练教导队"},{id:6,username:"instructor_sun",fullName:"孙教官",roleId:2,department:"特战训练队"},{id:4,username:"supervisor_zhao",fullName:"赵督导",roleId:4,department:"训练督导组"}],students:[{id:3,username:"student_wang",fullName:"王学员",roleId:3,department:"新兵连一班"},{id:7,username:"student_liu",fullName:"刘学员",roleId:3,department:"新兵连二班"},{id:8,username:"student_yang",fullName:"杨学员",roleId:3,department:"新兵连一班"},{id:9,username:"student_zhang",fullName:"张学员",roleId:3,department:"特种作战训练班"},{id:10,username:"student_zhao",fullName:"赵学员",roleId:3,department:"特种作战训练班"},{id:11,username:"student_qian",fullName:"钱学员",roleId:3,department:"特种作战训练班"},{id:12,username:"student_sun",fullName:"孙学员",roleId:3,department:"特种作战训练班"},{id:13,username:"student_li",fullName:"李学员",roleId:3,department:"特种作战训练班"},{id:14,username:"student_zhou",fullName:"周学员",roleId:3,department:"特种作战训练班"},{id:15,username:"student_wu",fullName:"吴学员",roleId:3,department:"特种作战训练班"},{id:16,username:"student_zheng",fullName:"郑学员",roleId:3,department:"特种作战训练班"},{id:17,username:"student_gao",fullName:"高学员",roleId:3,department:"新兵连一班"},{id:18,username:"student_lin",fullName:"林学员",roleId:3,department:"新兵连一班"},{id:19,username:"student_he",fullName:"何学员",roleId:3,department:"新兵连一班"},{id:20,username:"student_ma",fullName:"马学员",roleId:3,department:"新兵连一班"},{id:21,username:"student_luo",fullName:"罗学员",roleId:3,department:"新兵连一班"},{id:22,username:"student_peng",fullName:"彭学员",roleId:3,department:"新兵连一班"},{id:23,username:"student_chen",fullName:"陈学员",roleId:3,department:"新兵连一班"},{id:24,username:"student_xie",fullName:"谢学员",roleId:3,department:"新兵连一班"},{id:25,username:"student_hu",fullName:"胡学员",roleId:3,department:"新兵连二班"},{id:26,username:"student_tian",fullName:"田学员",roleId:3,department:"新兵连二班"},{id:27,username:"student_xu",fullName:"徐学员",roleId:3,department:"新兵连二班"},{id:28,username:"student_deng",fullName:"邓学员",roleId:3,department:"新兵连二班"},{id:29,username:"student_cao",fullName:"曹学员",roleId:3,department:"新兵连二班"},{id:30,username:"student_feng",fullName:"冯学员",roleId:3,department:"新兵连二班"},{id:31,username:"student_tang",fullName:"唐学员",roleId:3,department:"新兵连二班"},{id:32,username:"student_pan",fullName:"潘学员",roleId:3,department:"新兵连二班"},{id:33,username:"student_liang",fullName:"梁学员",roleId:3,department:"新兵连二班"}]}},computed:{filteredClasses(){let e=[...this.classes];if(this.searchKeyword){const t=this.searchKeyword.toLowerCase();e=e.filter((e=>e.name.toLowerCase().includes(t)||e.code.toLowerCase().includes(t)))}if(this.filterInstructorId){const t=parseInt(this.filterInstructorId);e=e.filter((e=>e.instructors.some((e=>e.id===t))))}const t=(this.currentPage-1)*this.pageSize,s=t+this.pageSize;return e.slice(t,s)},totalPages(){let e=[...this.classes];if(this.searchKeyword){const t=this.searchKeyword.toLowerCase();e=e.filter((e=>e.name.toLowerCase().includes(t)||e.code.toLowerCase().includes(t)))}if(this.filterInstructorId){const t=parseInt(this.filterInstructorId);e=e.filter((e=>e.instructors.some((e=>e.id===t))))}return Math.ceil(e.length/this.pageSize)||1},filteredAvailableInstructors(){const e=this.detailClass.instructors.map((e=>e.id));let t=this.instructors.filter((t=>!e.includes(t.id)));if(this.instructorSearchKeyword){const e=this.instructorSearchKeyword.toLowerCase();t=t.filter((t=>t.username.toLowerCase().includes(e)||t.fullName.toLowerCase().includes(e)))}return t},filteredAvailableStudents(){const e=this.detailClass.students.map((e=>e.id));let t=this.students.filter((t=>!e.includes(t.id)));if(this.studentSearchKeyword){const e=this.studentSearchKeyword.toLowerCase();t=t.filter((t=>t.username.toLowerCase().includes(e)||t.fullName.toLowerCase().includes(e)))}return t}},methods:{searchClasses(){this.currentPage=1},resetSearch(){this.searchKeyword="",this.filterInstructorId="",this.currentPage=1},changePage(e){e>=1&&e<=this.totalPages&&(this.currentPage=e)},formatDate(e){return new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"})},viewClassDetails(e){this.detailClass=JSON.parse(JSON.stringify(e)),this.showDetailModal=!0},closeDetailModal(){this.showDetailModal=!1,this.detailClass={id:null,name:"",code:"",description:"",createdAt:null,instructors:[],students:[]}},openCreateModal(){this.isCreating=!0,this.classForm={id:null,name:"",code:"",description:"",instructors:[],students:[]},this.resetFormErrors(),this.showEditModal=!0},openEditModal(e){this.isCreating=!1,this.classForm={id:e.id,name:e.name,code:e.code,description:e.description,instructors:[...e.instructors],students:[...e.students]},this.resetFormErrors(),this.showEditModal=!0},closeEditModal(){this.showEditModal=!1,this.classForm={id:null,name:"",code:"",description:"",instructors:[],students:[]}},validateClassForm(){let e=!0;return this.resetFormErrors(),this.classForm.name.trim()||(this.formErrors.name="请输入班级名称",e=!1),this.classForm.code.trim()?this.isCreating&&this.classes.some((e=>e.code===this.classForm.code.trim()))&&(this.formErrors.code="班级代号已存在",e=!1):(this.formErrors.code="请输入班级代号",e=!1),e},resetFormErrors(){this.formErrors={name:"",code:"",description:""}},saveClass(){if(this.validateClassForm()){if(this.isCreating){const e=Math.max(...this.classes.map((e=>e.id)),0)+1,t={...this.classForm,id:e,createdAt:new Date};this.classes.push(t),alert(`班级 ${t.name} 创建成功！`)}else{const e=this.classes.findIndex((e=>e.id===this.classForm.id));if(-1!==e){const t={...this.classes[e],name:this.classForm.name,code:this.classForm.code,description:this.classForm.description};this.classes.splice(e,1,t),alert(`班级 ${t.name} 更新成功！`)}}this.closeEditModal()}},confirmDelete(e){this.pendingDeleteClass=e,this.showDeleteConfirm=!0},cancelDelete(){this.pendingDeleteClass=null,this.showDeleteConfirm=!1},deleteClass(){const e=this.classes.findIndex((e=>e.id===this.pendingDeleteClass.id));-1!==e&&(this.classes.splice(e,1),alert(`班级 ${this.pendingDeleteClass.name} 已删除！`)),this.cancelDelete(),0===this.filteredClasses.length&&this.currentPage>1&&this.currentPage--},openAddInstructorModal(){this.instructorSearchKeyword="",this.selectedInstructors=[],this.showAddInstructorModal=!0},closeAddInstructorModal(){this.showAddInstructorModal=!1,this.instructorSearchKeyword="",this.selectedInstructors=[]},searchAvailableInstructors(){},toggleInstructorSelection(e){const t=this.selectedInstructors.indexOf(e);-1===t?this.selectedInstructors.push(e):this.selectedInstructors.splice(t,1)},addInstructorsToClass(){if(0===this.selectedInstructors.length)return;const e=this.instructors.filter((e=>this.selectedInstructors.includes(e.id)));this.detailClass.instructors=[...this.detailClass.instructors,...e];const t=this.classes.findIndex((e=>e.id===this.detailClass.id));-1!==t&&(this.classes[t].instructors=[...this.detailClass.instructors]),alert(`已成功添加 ${e.length} 名教员到班级！`),this.closeAddInstructorModal()},openAddStudentModal(){this.studentSearchKeyword="",this.selectedStudents=[],this.showAddStudentModal=!0},closeAddStudentModal(){this.showAddStudentModal=!1,this.studentSearchKeyword="",this.selectedStudents=[]},searchAvailableStudents(){},toggleStudentSelection(e){const t=this.selectedStudents.indexOf(e);-1===t?this.selectedStudents.push(e):this.selectedStudents.splice(t,1)},addStudentsToClass(){if(0===this.selectedStudents.length)return;const e=this.students.filter((e=>this.selectedStudents.includes(e.id)));this.detailClass.students=[...this.detailClass.students,...e];const t=this.classes.findIndex((e=>e.id===this.detailClass.id));-1!==t&&(this.classes[t].students=[...this.detailClass.students]),alert(`已成功添加 ${e.length} 名学员到班级！`),this.closeAddStudentModal()},confirmRemoveInstructor(e){this.pendingRemoveMember=e,this.isRemovingInstructor=!0,this.showRemoveConfirm=!0},confirmRemoveStudent(e){this.pendingRemoveMember=e,this.isRemovingInstructor=!1,this.showRemoveConfirm=!0},cancelRemoveMember(){this.pendingRemoveMember=null,this.showRemoveConfirm=!1},removeMember(){const e=this.pendingRemoveMember.id;if(this.isRemovingInstructor){this.detailClass.instructors=this.detailClass.instructors.filter((t=>t.id!==e));const t=this.classes.findIndex((e=>e.id===this.detailClass.id));-1!==t&&(this.classes[t].instructors=[...this.detailClass.instructors]),alert(`已成功从班级中移除教员 ${this.pendingRemoveMember.fullName}！`)}else{this.detailClass.students=this.detailClass.students.filter((t=>t.id!==e));const t=this.classes.findIndex((e=>e.id===this.detailClass.id));-1!==t&&(this.classes[t].students=[...this.detailClass.students]),alert(`已成功从班级中移除学员 ${this.pendingRemoveMember.fullName}！`)}this.cancelRemoveMember()}}},Z=J,ee=(0,n.A)(Z,W,X,!1,null,"9820e700",null),te=ee.exports,se=function(){var e=this,t=e._self._c;return t("div",{staticClass:"group-management-container"},[t("h1",{staticClass:"page-title"},[e._v("编组管理")]),t("div",{staticClass:"selection-area"},[t("div",{staticClass:"class-selector"},[t("label",[e._v("选择班级：")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedClassId,expression:"selectedClassId"}],on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.selectedClassId=t.target.multiple?s:s[0]},e.loadClassStudents]}},[t("option",{attrs:{value:""}},[e._v("请选择班级")]),e._l(e.classList,(function(s){return t("option",{key:s.id,domProps:{value:s.id}},[e._v(" "+e._s(s.name)+" ("+e._s(s.code)+") ")])}))],2)])]),e.selectedClassId?t("div",{staticClass:"management-area"},[t("div",{staticClass:"students-section"},[t("div",{staticClass:"section-header"},[t("h3",[e._v("未分组学员 ("+e._s(e.availableStudents.length)+"人)")]),t("div",{staticClass:"student-actions"},[e.availableStudents.length>0?t("button",{staticClass:"select-all-btn",on:{click:e.selectAllStudents}},[e._v("全选")]):e._e(),e.availableStudents.length>0?t("button",{staticClass:"auto-group-btn",on:{click:function(t){e.showAutoGroupModal=!0}}},[e._v("自动分组")]):e._e(),t("button",{staticClass:"manual-group-btn",attrs:{disabled:0===e.selectedStudents.length},on:{click:e.startManualGrouping}},[e._v("手动分组")])])]),t("div",{staticClass:"student-list"},[e._l(e.availableStudents,(function(s){return t("div",{key:s.id,staticClass:"student-item"},[t("div",{staticClass:"student-card",class:{excluded:s.excluded,selected:e.selectedStudents.includes(s.id)},on:{click:function(t){return e.toggleStudentSelection(s.id)}}},[t("div",{staticClass:"student-checkbox"},[t("input",{attrs:{type:"checkbox"},domProps:{checked:e.selectedStudents.includes(s.id)},on:{click:function(e){e.stopPropagation()}}})]),t("div",{staticClass:"student-info"},[t("div",{staticClass:"student-name"},[e._v(e._s(s.fullName))]),t("div",{staticClass:"student-details"},[e._v(e._s(s.username))])]),t("div",{staticClass:"student-actions"},[t("button",{staticClass:"exclude-btn",on:{click:function(t){return t.stopPropagation(),e.toggleStudentExclusion(s.id)}}},[e._v(" "+e._s(s.excluded?"恢复参与":"设置不参与")+" ")])])])])})),0===e.availableStudents.length?t("div",{staticClass:"empty-message"},[e._v(" 当前班级没有未分组的学员或所有学员已被分组 ")]):e._e()],2)]),t("div",{staticClass:"groups-section"},[t("div",{staticClass:"section-header"},[t("h3",[e._v("分组情况 ("+e._s(e.groups.length)+"个小组)")]),e.groups.length>0?t("button",{staticClass:"reset-groups-btn",on:{click:e.confirmResetGroups}},[e._v("重置所有分组")]):e._e()]),t("div",{staticClass:"groups-container"},[e._l(e.groups,(function(s,a){return t("div",{key:a,staticClass:"group-card"},[t("div",{staticClass:"group-header"},[t("h4",[e._v(e._s(s.name||`小组 ${a+1}`))]),t("div",{staticClass:"group-actions"},[t("button",{staticClass:"edit-group-btn",on:{click:function(t){return e.editGroup(a)}}},[e._v("编辑")]),t("button",{staticClass:"delete-group-btn",on:{click:function(t){return e.confirmDeleteGroup(a)}}},[e._v("删除")])])]),s.remark?t("div",{staticClass:"group-info"},[t("p",{staticClass:"group-remark"},[e._v(e._s(s.remark))])]):e._e(),t("div",{staticClass:"group-members"},[e._l(s.members,(function(s){return t("div",{key:s.id,staticClass:"group-member"},[t("div",{staticClass:"member-info"},[s.isLeader?t("span",{staticClass:"leader-badge"},[e._v("组长")]):e._e(),t("span",{staticClass:"member-name"},[e._v(e._s(s.fullName))]),s.role?t("span",{staticClass:"member-role"},[e._v("("+e._s(s.role)+")")]):e._e()]),t("div",{staticClass:"member-actions"},[t("button",{staticClass:"leader-btn",on:{click:function(t){return e.toggleLeader(a,s.id)}}},[e._v(" "+e._s(s.isLeader?"取消组长":"设为组长")+" ")]),t("button",{staticClass:"role-btn",on:{click:function(t){return e.editMemberRole(a,s.id)}}},[e._v("角色")]),t("button",{staticClass:"move-btn",on:{click:function(t){return e.showMoveModal(a,s.id)}}},[e._v("移动")]),t("button",{staticClass:"remove-btn",on:{click:function(t){return e.removeMember(a,s.id)}}},[e._v("移除")])])])})),t("div",{staticClass:"add-member",on:{click:function(t){return e.showAddMemberModal(a)}}},[t("span",{staticClass:"add-icon"},[e._v("+")]),e._v(" 添加组员 ")]),0===s.members.length?t("div",{staticClass:"empty-group"},[e._v(" 暂无组员，请添加组员 ")]):e._e()],2)])})),0===e.groups.length?t("div",{staticClass:"empty-groups-message"},[e._v(" 尚未创建任何小组，请通过自动分组或手动分组创建小组 ")]):e._e()],2)])]):e._e(),e.showAutoGroupModal?t("div",{staticClass:"modal-backdrop",on:{click:function(t){e.showAutoGroupModal=!1}}}):e._e(),e.showAutoGroupModal?t("div",{staticClass:"modal auto-group-modal"},[t("div",{staticClass:"modal-header"},[t("h3",[e._v("自动分组")]),t("button",{staticClass:"modal-close",on:{click:function(t){e.showAutoGroupModal=!1}}},[e._v("×")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",[e._v("分组方式")]),t("div",{staticClass:"radio-group"},[t("label",{staticClass:"radio-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.autoGroupMode,expression:"autoGroupMode"}],attrs:{type:"radio",value:"groupCount"},domProps:{checked:e._q(e.autoGroupMode,"groupCount")},on:{change:function(t){e.autoGroupMode="groupCount"}}}),e._v(" 按小组数量 ")]),t("label",{staticClass:"radio-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.autoGroupMode,expression:"autoGroupMode"}],attrs:{type:"radio",value:"memberCount"},domProps:{checked:e._q(e.autoGroupMode,"memberCount")},on:{change:function(t){e.autoGroupMode="memberCount"}}}),e._v(" 按每组人数 ")])])])]),t("div",{staticClass:"form-row"},["groupCount"===e.autoGroupMode?t("div",{staticClass:"form-group"},[t("label",[e._v("小组数量")]),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.groupCount,expression:"groupCount",modifiers:{number:!0}}],attrs:{type:"number",min:"1",max:"10"},domProps:{value:e.groupCount},on:{input:function(t){t.target.composing||(e.groupCount=e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})]):e._e(),"memberCount"===e.autoGroupMode?t("div",{staticClass:"form-group"},[t("label",[e._v("每组人数")]),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.memberCount,expression:"memberCount",modifiers:{number:!0}}],attrs:{type:"number",min:"1",max:"20"},domProps:{value:e.memberCount},on:{input:function(t){t.target.composing||(e.memberCount=e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})]):e._e()]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group"},[t("label",{staticClass:"checkbox-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.excludeNonParticipants,expression:"excludeNonParticipants"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.excludeNonParticipants)?e._i(e.excludeNonParticipants,null)>-1:e.excludeNonParticipants},on:{change:function(t){var s=e.excludeNonParticipants,a=t.target,r=!!a.checked;if(Array.isArray(s)){var i=null,o=e._i(s,i);a.checked?o<0&&(e.excludeNonParticipants=s.concat([i])):o>-1&&(e.excludeNonParticipants=s.slice(0,o).concat(s.slice(o+1)))}else e.excludeNonParticipants=r}}}),e._v(" 排除已设置不参与的学员 ")])])])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"cancel-btn",on:{click:function(t){e.showAutoGroupModal=!1}}},[e._v("取消")]),t("button",{staticClass:"confirm-btn",on:{click:e.executeAutoGroup}},[e._v("开始自动分组")])])]):e._e(),e.showMoveStudentModal?t("div",{staticClass:"modal-backdrop",on:{click:function(t){e.showMoveStudentModal=!1}}}):e._e(),e.showMoveStudentModal?t("div",{staticClass:"modal move-student-modal"},[t("div",{staticClass:"modal-header"},[t("h3",[e._v("移动组员")]),t("button",{staticClass:"modal-close",on:{click:function(t){e.showMoveStudentModal=!1}}},[e._v("×")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"form-group"},[t("label",[e._v("选择目标小组")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.targetGroupIndex,expression:"targetGroupIndex"}],on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.targetGroupIndex=t.target.multiple?s:s[0]}}},[e._l(e.groups,(function(s,a){return t("option",{key:a,attrs:{disabled:a===e.currentGroupIndex},domProps:{value:a}},[e._v(" "+e._s(s.name||`小组 ${a+1}`)+" ")])})),t("option",{attrs:{value:"-1"}},[e._v("移出所有小组")])],2)])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"cancel-btn",on:{click:function(t){e.showMoveStudentModal=!1}}},[e._v("取消")]),t("button",{staticClass:"confirm-btn",on:{click:e.moveStudent}},[e._v("确认移动")])])]):e._e(),e.showEditGroupModal?t("div",{staticClass:"modal-backdrop",on:{click:function(t){e.showEditGroupModal=!1}}}):e._e(),e.showEditGroupModal?t("div",{staticClass:"modal edit-group-modal"},[t("div",{staticClass:"modal-header"},[t("h3",[e._v("编辑小组")]),t("button",{staticClass:"modal-close",on:{click:function(t){e.showEditGroupModal=!1}}},[e._v("×")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"form-group"},[t("label",[e._v("小组名称")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.editingGroup.name,expression:"editingGroup.name"}],attrs:{type:"text",placeholder:"请输入小组名称"},domProps:{value:e.editingGroup.name},on:{input:function(t){t.target.composing||e.$set(e.editingGroup,"name",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[e._v("小组备注")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.editingGroup.remark,expression:"editingGroup.remark"}],attrs:{placeholder:"请输入小组备注",rows:"3"},domProps:{value:e.editingGroup.remark},on:{input:function(t){t.target.composing||e.$set(e.editingGroup,"remark",t.target.value)}}})])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"cancel-btn",on:{click:function(t){e.showEditGroupModal=!1}}},[e._v("取消")]),t("button",{staticClass:"confirm-btn",on:{click:e.saveGroupEdit}},[e._v("保存")])])]):e._e(),e.showEditRoleModal?t("div",{staticClass:"modal-backdrop",on:{click:function(t){e.showEditRoleModal=!1}}}):e._e(),e.showEditRoleModal?t("div",{staticClass:"modal edit-role-modal"},[t("div",{staticClass:"modal-header"},[t("h3",[e._v("编辑组员角色")]),t("button",{staticClass:"modal-close",on:{click:function(t){e.showEditRoleModal=!1}}},[e._v("×")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"form-group"},[t("label",[e._v("组员姓名")]),t("input",{attrs:{type:"text",readonly:""},domProps:{value:e.editingMember.fullName}})]),t("div",{staticClass:"form-group"},[t("label",[e._v("角色名称")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.editingMember.role,expression:"editingMember.role"}],attrs:{type:"text",placeholder:"请输入角色名称，如：操作手、通讯员等"},domProps:{value:e.editingMember.role},on:{input:function(t){t.target.composing||e.$set(e.editingMember,"role",t.target.value)}}})])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"cancel-btn",on:{click:function(t){e.showEditRoleModal=!1}}},[e._v("取消")]),t("button",{staticClass:"confirm-btn",on:{click:e.saveMemberRole}},[e._v("保存")])])]):e._e(),e.showAddMemberModal?t("div",{staticClass:"modal-backdrop",on:{click:function(t){e.showAddMemberModal=!1}}}):e._e(),e.showAddMemberModal?t("div",{staticClass:"modal add-member-modal"},[t("div",{staticClass:"modal-header"},[t("h3",[e._v("添加组员")]),t("button",{staticClass:"modal-close",on:{click:function(t){e.showAddMemberModal=!1}}},[e._v("×")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"form-group"},[t("label",[e._v("可选学员")]),t("div",{staticClass:"student-select-list"},[e._l(e.availableStudents,(function(s){return t("div",{key:s.id,staticClass:"student-select-item",class:{selected:e.selectedStudentsToAdd.includes(s.id)},on:{click:function(t){return e.toggleStudentToAdd(s.id)}}},[t("div",{staticClass:"student-info"},[t("div",{staticClass:"student-name"},[e._v(e._s(s.fullName))]),t("div",{staticClass:"student-details"},[e._v(e._s(s.username))])]),t("div",{staticClass:"checkbox"},[t("input",{attrs:{type:"checkbox"},domProps:{checked:e.selectedStudentsToAdd.includes(s.id)},on:{click:function(e){e.stopPropagation()}}})])])})),0===e.availableStudents.length?t("div",{staticClass:"empty-message"},[e._v(" 没有可添加的学员 ")]):e._e()],2)])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"cancel-btn",on:{click:function(t){e.showAddMemberModal=!1}}},[e._v("取消")]),t("button",{staticClass:"confirm-btn",attrs:{disabled:0===e.selectedStudentsToAdd.length},on:{click:e.addMembersToGroup}},[e._v(" 添加选中学员 ("+e._s(e.selectedStudentsToAdd.length)+"人) ")])])]):e._e(),e.showDeleteGroupConfirm?t("div",{staticClass:"modal-backdrop",on:{click:e.cancelDeleteGroup}}):e._e(),e.showDeleteGroupConfirm?t("div",{staticClass:"modal delete-confirm-modal"},[t("div",{staticClass:"modal-header"},[t("h3",[e._v("确认删除小组")]),t("button",{staticClass:"modal-close",on:{click:e.cancelDeleteGroup}},[e._v("×")])]),t("div",{staticClass:"modal-body"},[t("p",{staticClass:"confirm-text"},[e._v(" 确定要删除【"+e._s(e.groups[e.pendingDeleteGroupIndex]?.name||`小组 ${e.pendingDeleteGroupIndex+1}`)+"】吗？ "),t("br"),t("span",{staticClass:"warning-text"},[e._v("删除后，该小组的所有组员将被移出小组并变为未分组状态。此操作不可撤销。")])])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"cancel-btn",on:{click:e.cancelDeleteGroup}},[e._v("取消")]),t("button",{staticClass:"delete-btn",on:{click:e.deleteGroup}},[e._v("确认删除")])])]):e._e(),e.showResetGroupsConfirm?t("div",{staticClass:"modal-backdrop",on:{click:e.cancelResetGroups}}):e._e(),e.showResetGroupsConfirm?t("div",{staticClass:"modal reset-confirm-modal"},[t("div",{staticClass:"modal-header"},[t("h3",[e._v("确认重置所有分组")]),t("button",{staticClass:"modal-close",on:{click:e.cancelResetGroups}},[e._v("×")])]),e._m(0),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"cancel-btn",on:{click:e.cancelResetGroups}},[e._v("取消")]),t("button",{staticClass:"delete-btn",on:{click:e.resetAllGroups}},[e._v("确认重置")])])]):e._e()])},ae=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal-body"},[t("p",{staticClass:"confirm-text"},[e._v(" 确定要重置所有分组吗？ "),t("br"),t("span",{staticClass:"warning-text"},[e._v("重置后，将删除所有小组，所有学员将变为未分组状态。此操作不可撤销。")])])])}],re=(s(7588),s(18237),{name:"GroupManagement",data(){return{selectedClassId:"",classList:[],students:[],groups:[],selectedStudents:[],showAutoGroupModal:!1,autoGroupMode:"groupCount",groupCount:4,memberCount:5,excludeNonParticipants:!0,showMoveStudentModal:!1,currentGroupIndex:-1,currentStudentId:null,targetGroupIndex:-1,showEditGroupModal:!1,editingGroupIndex:-1,editingGroup:{name:"",remark:""},showEditRoleModal:!1,editingMember:{id:null,fullName:"",role:""},showAddMemberModal:!1,selectedStudentsToAdd:[],showDeleteGroupConfirm:!1,pendingDeleteGroupIndex:-1,showResetGroupsConfirm:!1}},computed:{availableStudents(){if(!this.students.length)return[];const e=this.groups.reduce(((e,t)=>(t.members.forEach((t=>{e.push(t.id)})),e)),[]);return this.students.filter((t=>!e.includes(t.id)))}},created(){this.fetchClassList()},methods:{fetchClassList(){this.classList=[{id:1,name:"新兵连一班",code:"XBL-01"},{id:2,name:"新兵连二班",code:"XBL-02"},{id:3,name:"特种作战训练班",code:"TSC-01"}]},loadClassStudents(){if(!this.selectedClassId)return this.students=[],void(this.groups=[]);const e={1:[{id:3,username:"student_wang",fullName:"王学员",excluded:!1},{id:8,username:"student_yang",fullName:"杨学员",excluded:!1},{id:17,username:"student_gao",fullName:"高学员",excluded:!1},{id:18,username:"student_lin",fullName:"林学员",excluded:!1},{id:19,username:"student_he",fullName:"何学员",excluded:!1},{id:20,username:"student_ma",fullName:"马学员",excluded:!1},{id:21,username:"student_luo",fullName:"罗学员",excluded:!1},{id:22,username:"student_peng",fullName:"彭学员",excluded:!1},{id:23,username:"student_chen",fullName:"陈学员",excluded:!1},{id:24,username:"student_xie",fullName:"谢学员",excluded:!1}],2:[{id:7,username:"student_liu",fullName:"刘学员",excluded:!1},{id:25,username:"student_hu",fullName:"胡学员",excluded:!1},{id:26,username:"student_tian",fullName:"田学员",excluded:!1},{id:27,username:"student_xu",fullName:"徐学员",excluded:!1},{id:28,username:"student_deng",fullName:"邓学员",excluded:!1},{id:29,username:"student_cao",fullName:"曹学员",excluded:!1},{id:30,username:"student_feng",fullName:"冯学员",excluded:!1},{id:31,username:"student_tang",fullName:"唐学员",excluded:!1},{id:32,username:"student_pan",fullName:"潘学员",excluded:!1},{id:33,username:"student_liang",fullName:"梁学员",excluded:!1}],3:[{id:9,username:"student_zhang",fullName:"张学员",excluded:!1},{id:10,username:"student_zhao",fullName:"赵学员",excluded:!1},{id:11,username:"student_qian",fullName:"钱学员",excluded:!1},{id:12,username:"student_sun",fullName:"孙学员",excluded:!1},{id:13,username:"student_li",fullName:"李学员",excluded:!1},{id:14,username:"student_zhou",fullName:"周学员",excluded:!1},{id:15,username:"student_wu",fullName:"吴学员",excluded:!1},{id:16,username:"student_zheng",fullName:"郑学员",excluded:!1}]};this.students=e[this.selectedClassId]||[],this.selectedStudents=[],this.groups=[]},toggleStudentSelection(e){const t=this.selectedStudents.indexOf(e);-1===t?this.selectedStudents.push(e):this.selectedStudents.splice(t,1)},toggleStudentExclusion(e){const t=this.students.find((t=>t.id===e));if(t&&(t.excluded=!t.excluded,t.excluded)){const t=this.selectedStudents.indexOf(e);-1!==t&&this.selectedStudents.splice(t,1)}},startManualGrouping(){if(0===this.selectedStudents.length)return void alert("请先选择至少一名学生");const e={name:"",remark:"",members:[]};this.selectedStudents.forEach((t=>{const s=this.students.find((e=>e.id===t));s&&!s.excluded&&e.members.push({id:s.id,username:s.username,fullName:s.fullName,role:"",isLeader:!1})})),this.groups.push(e),this.selectedStudents=[]},executeAutoGroup(){const e=this.availableStudents.filter((e=>!this.excludeNonParticipants||!e.excluded));if(0===e.length)return void alert("没有可用于分组的学员");let t,s,a=e;if(this.selectedStudents.length>0&&(a=e.filter((e=>this.selectedStudents.includes(e.id))),0===a.length))return void alert("选中的学员中没有可分组的学员");a=this.shuffleArray([...a]),"groupCount"===this.autoGroupMode?(t=Math.min(this.groupCount,a.length),s=Math.ceil(a.length/t)):(s=Math.min(this.memberCount,a.length),t=Math.ceil(a.length/s));const r=[];for(let i=0;i<t;i++)r.push({name:`小组 ${i+1}`,remark:"",members:[]});a.forEach(((e,s)=>{const a=s%t;r[a].members.push({id:e.id,username:e.username,fullName:e.fullName,role:"",isLeader:!1})})),this.groups=[...this.groups,...r],this.selectedStudents=[],this.showAutoGroupModal=!1},shuffleArray(e){for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e},editGroup(e){this.editingGroupIndex=e,this.editingGroup={...this.groups[e]},this.showEditGroupModal=!0},saveGroupEdit(){this.editingGroupIndex>=0&&this.editingGroupIndex<this.groups.length&&(this.groups[this.editingGroupIndex].name=this.editingGroup.name,this.groups[this.editingGroupIndex].remark=this.editingGroup.remark),this.showEditGroupModal=!1},toggleLeader(e,t){const s=this.groups[e];if(!s)return;const a=s.members.find((e=>e.id===t));a&&(a.isLeader?a.isLeader=!1:(s.members.forEach((e=>{e.isLeader&&(e.isLeader=!1)})),a.isLeader=!0))},showMoveModal(e,t){this.currentGroupIndex=e,this.currentStudentId=t,this.targetGroupIndex=-1,this.showMoveStudentModal=!0},moveStudent(){if(this.currentGroupIndex<0||this.currentGroupIndex>=this.groups.length)return void(this.showMoveStudentModal=!1);const e=this.groups[this.currentGroupIndex],t=e.members.findIndex((e=>e.id===this.currentStudentId));if(t<0)return void(this.showMoveStudentModal=!1);const s=e.members.splice(t,1)[0];this.targetGroupIndex>=0&&this.targetGroupIndex<this.groups.length&&this.groups[this.targetGroupIndex].members.push(s),this.showMoveStudentModal=!1},removeMember(e,t){if(e<0||e>=this.groups.length)return;const s=this.groups[e],a=s.members.findIndex((e=>e.id===t));a>=0&&s.members.splice(a,1)},editMemberRole(e,t){this.editingGroupIndex=e;const s=this.groups[e].members.find((e=>e.id===t));s&&(this.editingMember={...s},this.showEditRoleModal=!0)},saveMemberRole(){if(!this.editingMember)return;const e=this.editingGroupIndex,t=this.groups[e].members.findIndex((e=>e.id===this.editingMember.id));-1!==t&&(this.groups[e].members[t].role=this.editingMember.role),this.showEditRoleModal=!1},showAddMemberModal(e){this.currentGroupIndex=e,this.selectedStudentsToAdd=[],this.showAddMemberModal=!0},toggleStudentToAdd(e){const t=this.selectedStudentsToAdd.indexOf(e);-1===t?this.selectedStudentsToAdd.push(e):this.selectedStudentsToAdd.splice(t,1)},addMembersToGroup(){if(this.currentGroupIndex<0||this.currentGroupIndex>=this.groups.length)return;const e=this.groups[this.currentGroupIndex];this.selectedStudentsToAdd.forEach((t=>{const s=this.availableStudents.find((e=>e.id===t));s&&!s.excluded&&e.members.push({id:s.id,username:s.username,fullName:s.fullName,role:"",isLeader:!1})})),this.selectedStudentsToAdd=[],this.showAddMemberModal=!1},selectAllStudents(){const e=this.availableStudents.filter((e=>!e.excluded)).map((e=>e.id));this.selectedStudents=e},confirmDeleteGroup(e){this.pendingDeleteGroupIndex=e,this.showDeleteGroupConfirm=!0},cancelDeleteGroup(){this.pendingDeleteGroupIndex=-1,this.showDeleteGroupConfirm=!1},deleteGroup(){this.pendingDeleteGroupIndex<0||this.pendingDeleteGroupIndex>=this.groups.length||this.groups.splice(this.pendingDeleteGroupIndex,1),this.cancelDeleteGroup()},confirmResetGroups(){this.showResetGroupsConfirm=!0},cancelResetGroups(){this.showResetGroupsConfirm=!1},resetAllGroups(){this.groups=[],this.showResetGroupsConfirm=!1}}}),ie=re,oe=(0,n.A)(ie,se,ae,!1,null,"6449ea4b",null),le=oe.exports,ne=function(){var e=this,t=e._self._c;return t("div",{staticClass:"course-management-container"},[t("div",{staticClass:"page-header"},[t("h1",{staticClass:"page-title"},[e._v("课程管理")]),t("div",{staticClass:"header-actions"},[t("button",{staticClass:"add-course-btn",on:{click:e.openAddCourseModal}},[t("i",{staticClass:"el-icon-plus"}),e._v(" 新增课程 ")])])]),t("div",{staticClass:"search-panel"},[t("div",{staticClass:"search-form"},[t("div",{staticClass:"form-item"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchKeyword,expression:"searchKeyword"}],staticClass:"search-input",attrs:{type:"text",placeholder:"请输入课程名称搜索"},domProps:{value:e.searchKeyword},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchCourses.apply(null,arguments)},input:function(t){t.target.composing||(e.searchKeyword=t.target.value)}}})]),t("div",{staticClass:"form-item"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.filterType,expression:"filterType"}],staticClass:"filter-select",on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.filterType=t.target.multiple?s:s[0]}}},[t("option",{attrs:{value:""}},[e._v("全部类型")]),t("option",{attrs:{value:"VR"}},[e._v("VR课程")]),t("option",{attrs:{value:"SIMULATION"}},[e._v("仿真课程")])])]),t("div",{staticClass:"form-item"},[t("button",{staticClass:"search-btn",on:{click:e.searchCourses}},[e._v("查询")]),t("button",{staticClass:"reset-btn",on:{click:e.resetSearch}},[e._v("重置")])])]),e.selectedCourses.length>0?t("div",{staticClass:"batch-actions"},[t("span",{staticClass:"selected-count"},[e._v("已选择 "+e._s(e.selectedCourses.length)+" 项")]),t("button",{staticClass:"delete-btn",on:{click:e.batchDelete}},[e._v("批量删除")])]):e._e()]),t("div",{staticClass:"table-panel"},[t("table",{staticClass:"data-table"},[t("thead",[t("tr",[t("th",{attrs:{width:"50"}},[t("input",{staticClass:"checkbox-input",attrs:{type:"checkbox"},domProps:{checked:e.isAllSelected},on:{change:e.toggleSelectAll}})]),t("th",{attrs:{width:"60"}},[e._v("序号")]),t("th",{attrs:{width:"200"}},[e._v("课程名称")]),t("th",{attrs:{width:"100"}},[e._v("课程类型")]),t("th",{attrs:{width:"100"}},[e._v("总分值")]),t("th",[e._v("课程说明")]),t("th",{attrs:{width:"180"}},[e._v("创建时间")]),t("th",{attrs:{width:"150"}},[e._v("操作")])])]),t("tbody",[e._l(e.filteredCourses,(function(s,a){return t("tr",{key:s.id},[t("td",[t("input",{directives:[{name:"model",rawName:"v-model",value:e.selectedCourses,expression:"selectedCourses"}],staticClass:"checkbox-input",attrs:{type:"checkbox"},domProps:{value:s.id,checked:Array.isArray(e.selectedCourses)?e._i(e.selectedCourses,s.id)>-1:e.selectedCourses},on:{change:function(t){var a=e.selectedCourses,r=t.target,i=!!r.checked;if(Array.isArray(a)){var o=s.id,l=e._i(a,o);r.checked?l<0&&(e.selectedCourses=a.concat([o])):l>-1&&(e.selectedCourses=a.slice(0,l).concat(a.slice(l+1)))}else e.selectedCourses=i}}})]),t("td",{staticClass:"text-center"},[e._v(e._s((e.currentPage-1)*e.pageSize+a+1))]),t("td",[e._v(e._s(s.name))]),t("td",[t("span",{staticClass:"type-badge",class:{vr:"VR"===s.type,simulation:"SIMULATION"===s.type}},[e._v(" "+e._s("VR"===s.type?"VR课程":"仿真课程")+" ")])]),t("td",{staticClass:"text-center"},[e._v(e._s(s.totalScore))]),t("td",{staticClass:"description-cell"},[e._v(e._s(s.description))]),t("td",[e._v(e._s(e.formatDate(s.createTime)))]),t("td",{staticClass:"action-column"},[t("button",{staticClass:"action-btn edit-btn",on:{click:function(t){return e.openEditCourseModal(s)}}},[e._v(" 编辑 ")]),t("button",{staticClass:"action-btn delete-btn",on:{click:function(t){return e.confirmDeleteCourse(s)}}},[e._v(" 删除 ")])])])})),0===e.filteredCourses.length?t("tr",[t("td",{staticClass:"empty-data",attrs:{colspan:"8"}},[e._v("暂无课程数据")])]):e._e()],2)])]),e.totalPages>1?t("div",{staticClass:"pagination"},[t("button",{staticClass:"page-btn",attrs:{disabled:1===e.currentPage},on:{click:function(t){return e.changePage(e.currentPage-1)}}},[e._v(" 上一页 ")]),t("span",{staticClass:"page-info"},[e._v("第 "+e._s(e.currentPage)+" / "+e._s(e.totalPages)+" 页")]),t("button",{staticClass:"page-btn",attrs:{disabled:e.currentPage===e.totalPages},on:{click:function(t){return e.changePage(e.currentPage+1)}}},[e._v(" 下一页 ")])]):e._e(),t("el-dialog",{staticClass:"custom-dialog",attrs:{title:e.isEdit?"编辑课程":"新增课程",visible:e.showCourseModal,width:"600px","close-on-click-modal":!1},on:{"update:visible":function(t){e.showCourseModal=t}}},[t("div",{staticClass:"dialog-body"},[t("div",{staticClass:"form-group"},[t("label",{staticClass:"required"},[e._v("课程名称")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.courseForm.name,expression:"courseForm.name"}],staticClass:"form-input",attrs:{type:"text",placeholder:"请输入课程名称"},domProps:{value:e.courseForm.name},on:{input:function(t){t.target.composing||e.$set(e.courseForm,"name",t.target.value)}}}),e.courseForm.errors.name?t("div",{staticClass:"error-text"},[e._v(e._s(e.courseForm.errors.name))]):e._e()]),t("div",{staticClass:"form-group"},[t("label",{staticClass:"required"},[e._v("课程类型")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.courseForm.type,expression:"courseForm.type"}],staticClass:"form-input",on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.courseForm,"type",t.target.multiple?s:s[0])},e.handleTypeChange]}},[t("option",{attrs:{value:""}},[e._v("请选择课程类型")]),t("option",{attrs:{value:"VR"}},[e._v("VR课程")]),t("option",{attrs:{value:"SIMULATION"}},[e._v("仿真课程")])]),e.courseForm.errors.type?t("div",{staticClass:"error-text"},[e._v(e._s(e.courseForm.errors.type))]):e._e()]),"SIMULATION"===e.courseForm.type?[t("div",{staticClass:"form-group"},[t("label",{staticClass:"required"},[e._v("仿真课程序号")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.courseForm.simulationId,expression:"courseForm.simulationId"}],staticClass:"form-input",on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.courseForm,"simulationId",t.target.multiple?s:s[0])}}},[t("option",{attrs:{value:""}},[e._v("请选择仿真课程序号")]),e._l(e.simulationList,(function(s){return t("option",{key:s.id,domProps:{value:s.id}},[e._v(" "+e._s(s.name)+" ")])}))],2),e.courseForm.errors.simulationId?t("div",{staticClass:"error-text"},[e._v(e._s(e.courseForm.errors.simulationId))]):e._e()]),t("div",{staticClass:"form-group"},[t("label",{staticClass:"required"},[e._v("仿真程序路径")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.courseForm.simulationPath,expression:"courseForm.simulationPath"}],staticClass:"form-input",attrs:{type:"text",placeholder:"请输入仿真程序路径"},domProps:{value:e.courseForm.simulationPath},on:{input:function(t){t.target.composing||e.$set(e.courseForm,"simulationPath",t.target.value)}}}),e.courseForm.errors.simulationPath?t("div",{staticClass:"error-text"},[e._v(e._s(e.courseForm.errors.simulationPath))]):e._e()])]:e._e(),t("div",{staticClass:"form-group"},[t("label",{staticClass:"required"},[e._v("总分值")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.courseForm.totalScore,expression:"courseForm.totalScore"}],staticClass:"form-input",attrs:{type:"number",placeholder:"请输入总分值",min:"0",max:"100"},domProps:{value:e.courseForm.totalScore},on:{input:function(t){t.target.composing||e.$set(e.courseForm,"totalScore",t.target.value)}}}),e.courseForm.errors.totalScore?t("div",{staticClass:"error-text"},[e._v(e._s(e.courseForm.errors.totalScore))]):e._e()]),t("div",{staticClass:"form-group"},[t("label",{staticClass:"required"},[e._v("课程说明")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.courseForm.description,expression:"courseForm.description"}],staticClass:"form-textarea",attrs:{placeholder:"请输入课程说明",rows:"4"},domProps:{value:e.courseForm.description},on:{input:function(t){t.target.composing||e.$set(e.courseForm,"description",t.target.value)}}}),e.courseForm.errors.description?t("div",{staticClass:"error-text"},[e._v(e._s(e.courseForm.errors.description))]):e._e()]),t("div",{staticClass:"form-group"},[t("label",{staticClass:"required"},[e._v("绑定教学资料")]),t("div",{staticClass:"material-select"},[t("el-select",{staticClass:"material-select-input",attrs:{multiple:"",filterable:"",placeholder:"请选择教学资料"},model:{value:e.courseForm.materialIds,callback:function(t){e.$set(e.courseForm,"materialIds",t)},expression:"courseForm.materialIds"}},e._l(e.materialsList,(function(s){return t("el-option",{key:s.id,attrs:{label:s.name,value:s.id}},[t("span",{staticClass:"material-option"},[t("i",{class:e.getMaterialIcon(s.type)}),e._v(" "+e._s(s.name)+" ")])])})),1)],1),e.courseForm.errors.materialIds?t("div",{staticClass:"error-text"},[e._v(e._s(e.courseForm.errors.materialIds))]):e._e()])],2),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("button",{staticClass:"btn cancel-btn",on:{click:e.closeCourseModal}},[e._v("取 消")]),t("button",{staticClass:"btn confirm-btn",attrs:{disabled:!e.isCourseFormValid},on:{click:e.saveCourse}},[e._v(" 确 定 ")])])]),t("el-dialog",{staticClass:"custom-dialog",attrs:{title:"删除课程",visible:e.showDeleteConfirmModal,width:"400px","close-on-click-modal":!1},on:{"update:visible":function(t){e.showDeleteConfirmModal=t}}},[t("div",{staticClass:"dialog-body"},[t("div",{staticClass:"confirm-message"},[e.selectedCourses.length>1?[e._v(" 确定要删除选中的 "),t("span",{staticClass:"highlight danger"},[e._v(e._s(e.selectedCourses.length))]),e._v(" 个课程吗？ ")]:e.selectedCourse?[e._v(" 确定要删除课程 "),t("span",{staticClass:"highlight danger"},[e._v(e._s(e.selectedCourse.name))]),e._v(" 吗？ ")]:[e._v(" 确定要删除选中的课程吗？ ")],t("div",{staticClass:"warning-text"},[e._v("此操作不可恢复，请谨慎操作！")])],2)]),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("button",{staticClass:"btn cancel-btn",on:{click:e.closeDeleteConfirmModal}},[e._v("取 消")]),t("button",{staticClass:"btn delete-btn",on:{click:e.deleteCourse}},[e._v("确定删除")])])])],1)},de=[],ce={name:"CourseManagement",data(){return{searchKeyword:"",filterType:"",currentPage:1,pageSize:10,selectedCourses:[],isEdit:!1,showCourseModal:!1,courseForm:{name:"",type:"",simulationId:"",simulationPath:"",totalScore:"",description:"",materialIds:[],errors:{name:"",type:"",simulationId:"",simulationPath:"",totalScore:"",description:"",materialIds:""}},showDeleteConfirmModal:!1,selectedCourse:null,courses:[{id:1,name:"战术训练VR课程",type:"VR",totalScore:100,description:"通过VR技术进行战术训练，提高战术意识和决策能力",createTime:new Date("2023-05-14 10:25:33")},{id:2,name:"装备操作仿真课程",type:"SIMULATION",totalScore:100,description:"使用仿真系统学习装备操作流程和要领",createTime:new Date("2023-05-13 15:30:22")}],simulationList:[],materialsList:[]}},computed:{filteredCourses(){let e=[...this.courses];if(this.searchKeyword){const t=this.searchKeyword.toLowerCase();e=e.filter((e=>e.name.toLowerCase().includes(t)))}return this.filterType&&(e=e.filter((e=>e.type===this.filterType))),e},totalPages(){return Math.ceil(this.filteredCourses.length/this.pageSize)},isAllSelected(){return this.filteredCourses.length>0&&this.selectedCourses.length===this.filteredCourses.length},isCourseFormValid(){return this.courseForm.name&&this.courseForm.type&&this.courseForm.totalScore&&this.courseForm.description}},methods:{searchCourses(){this.currentPage=1},resetSearch(){this.searchKeyword="",this.filterType="",this.currentPage=1,this.selectedCourses=[]},changePage(e){e>=1&&e<=this.totalPages&&(this.currentPage=e)},formatDate(e){return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},toggleSelectAll(e){e.target.checked?this.selectedCourses=this.filteredCourses.map((e=>e.id)):this.selectedCourses=[]},openAddCourseModal(){this.isEdit=!1,this.courseForm={name:"",type:"",simulationId:"",simulationPath:"",totalScore:"",description:"",materialIds:[],errors:{name:"",type:"",simulationId:"",simulationPath:"",totalScore:"",description:"",materialIds:""}},this.showCourseModal=!0},openEditCourseModal(e){this.isEdit=!0,this.courseForm={...e,errors:{name:"",type:"",simulationId:"",simulationPath:"",totalScore:"",description:"",materialIds:""}},this.showCourseModal=!0},closeCourseModal(){this.showCourseModal=!1},async saveCourse(){if(this.validateCourseForm())try{if(this.isEdit){await this.$api.updateCourse({id:this.courseForm.id,name:this.courseForm.name,type:this.courseForm.type,totalScore:this.courseForm.totalScore,description:this.courseForm.description,simulationId:this.courseForm.simulationId,simulationPath:this.courseForm.simulationPath,materialIds:this.courseForm.materialIds});const e=this.courses.findIndex((e=>e.id===this.courseForm.id));-1!==e&&(this.courses[e]={...this.courseForm}),this.$message.success("课程更新成功")}else{const e=await this.$api.createCourse({name:this.courseForm.name,type:this.courseForm.type,totalScore:this.courseForm.totalScore,description:this.courseForm.description,simulationId:this.courseForm.simulationId,simulationPath:this.courseForm.simulationPath,materialIds:this.courseForm.materialIds});this.courses.unshift({...e.data,createTime:new Date}),this.$message.success("课程创建成功")}this.closeCourseModal()}catch(e){console.error(this.isEdit?"更新课程失败:":"创建课程失败:",e),this.$message.error(this.isEdit?"更新课程失败，请重试":"创建课程失败，请重试")}},validateCourseForm(){let e=!0;return this.courseForm.errors={name:"",type:"",simulationId:"",simulationPath:"",totalScore:"",description:"",materialIds:""},this.courseForm.name||(this.courseForm.errors.name="请输入课程名称",e=!1),this.courseForm.type||(this.courseForm.errors.type="请选择课程类型",e=!1),"SIMULATION"===this.courseForm.type&&(this.courseForm.simulationId||(this.courseForm.errors.simulationId="请选择仿真课程序号",e=!1),this.courseForm.simulationPath||(this.courseForm.errors.simulationPath="请输入仿真程序路径",e=!1)),this.courseForm.totalScore?(this.courseForm.totalScore<0||this.courseForm.totalScore>100)&&(this.courseForm.errors.totalScore="总分值必须在0-100之间",e=!1):(this.courseForm.errors.totalScore="请输入总分值",e=!1),this.courseForm.description||(this.courseForm.errors.description="请输入课程说明",e=!1),this.courseForm.materialIds&&0!==this.courseForm.materialIds.length||(this.courseForm.errors.materialIds="请选择要绑定的教学资料",e=!1),e},async getSimulationList(){try{const e=await this.$api.getSimulationList();this.simulationList=e.data}catch(e){console.error("获取仿真课程列表失败:",e),this.$message.error("获取仿真课程列表失败")}},async getMaterialsList(){try{const e=await this.$api.getMaterialsList();this.materialsList=e.data}catch(e){console.error("获取教学资料列表失败:",e),this.$message.error("获取教学资料列表失败")}},handleTypeChange(){"VR"===this.courseForm.type&&(this.courseForm.simulationId="",this.courseForm.simulationPath="")},getMaterialIcon(e){const t={pdf:"el-icon-document",doc:"el-icon-document-word",video:"el-icon-video-camera",image:"el-icon-picture"};return t[e]||"el-icon-document"},confirmDeleteCourse(e){this.selectedCourse=e,this.selectedCourses=[e.id],this.showDeleteConfirmModal=!0},closeDeleteConfirmModal(){this.showDeleteConfirmModal=!1,this.selectedCourse=null,this.selectedCourses=[]},batchDelete(){0!==this.selectedCourses.length?(this.selectedCourse=null,this.showDeleteConfirmModal=!0):this.$message.warning("请先选择要删除的课程")},async deleteCourse(){try{await this.$api.deleteCourses(this.selectedCourses),this.courses=this.courses.filter((e=>!this.selectedCourses.includes(e.id))),this.$message.success(this.selectedCourses.length>1?`已成功删除 ${this.selectedCourses.length} 个课程`:"课程删除成功"),this.closeDeleteConfirmModal()}catch(e){console.error("删除课程失败:",e),this.$message.error("删除课程失败，请重试")}}},async created(){await Promise.all([this.getSimulationList(),this.getMaterialsList()])}},ue=ce,me=(0,n.A)(ue,ne,de,!1,null,"370ff18e",null),pe=me.exports,ve=function(){var e=this,t=e._self._c;return t("div",{staticClass:"training-materials-container"},[t("h1",{staticClass:"page-title"},[e._v("教学资料管理")]),t("div",{staticClass:"function-area"},[t("div",{staticClass:"search-area"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchKeyword,expression:"searchKeyword"}],attrs:{type:"text",placeholder:"输入文件名称搜索"},domProps:{value:e.searchKeyword},on:{input:[function(t){t.target.composing||(e.searchKeyword=t.target.value)},e.searchMaterials]}}),t("select",{directives:[{name:"model",rawName:"v-model",value:e.categoryFilter,expression:"categoryFilter"}],on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.categoryFilter=t.target.multiple?s:s[0]},e.filterMaterials]}},[t("option",{attrs:{value:""}},[e._v("所有分类")]),e._l(e.categories,(function(s){return t("option",{key:s.id,domProps:{value:s.id}},[e._v(" "+e._s(s.name)+" ")])}))],2),t("select",{directives:[{name:"model",rawName:"v-model",value:e.dateFilter,expression:"dateFilter"}],on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.dateFilter=t.target.multiple?s:s[0]},e.filterMaterials]}},[t("option",{attrs:{value:""}},[e._v("按上传日期")]),t("option",{attrs:{value:"newest"}},[e._v("最新上传")]),t("option",{attrs:{value:"oldest"}},[e._v("最早上传")])]),t("button",{staticClass:"upload-btn",on:{click:function(t){e.showUploadModal=!0}}},[e._v("上传资料")])])]),t("div",{staticClass:"materials-list"},[t("table",[t("thead",[t("tr",[t("th",[t("input",{directives:[{name:"model",rawName:"v-model",value:e.selectAll,expression:"selectAll"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.selectAll)?e._i(e.selectAll,null)>-1:e.selectAll},on:{change:[function(t){var s=e.selectAll,a=t.target,r=!!a.checked;if(Array.isArray(s)){var i=null,o=e._i(s,i);a.checked?o<0&&(e.selectAll=s.concat([i])):o>-1&&(e.selectAll=s.slice(0,o).concat(s.slice(o+1)))}else e.selectAll=r},e.toggleSelectAll]}})]),t("th",[e._v("文件名")]),t("th",[e._v("分类")]),t("th",[e._v("文件类型")]),t("th",[e._v("大小")]),t("th",[e._v("上传日期")]),t("th",[e._v("描述")]),t("th",[e._v("操作")])])]),t("tbody",[e._l(e.filteredMaterials,(function(s,a){return t("tr",{key:s.id},[t("td",[t("input",{directives:[{name:"model",rawName:"v-model",value:s.selected,expression:"material.selected"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(s.selected)?e._i(s.selected,null)>-1:s.selected},on:{change:function(t){var a=s.selected,r=t.target,i=!!r.checked;if(Array.isArray(a)){var o=null,l=e._i(a,o);r.checked?l<0&&e.$set(s,"selected",a.concat([o])):l>-1&&e.$set(s,"selected",a.slice(0,l).concat(a.slice(l+1)))}else e.$set(s,"selected",i)}}})]),t("td",[e._v(e._s(s.name))]),t("td",[e._v(e._s(e.getCategoryName(s.categoryId)))]),t("td",[e._v(e._s(s.fileType))]),t("td",[e._v(e._s(e.formatFileSize(s.size)))]),t("td",[e._v(e._s(e.formatDate(s.uploadDate)))]),t("td",[e._v(e._s(s.description))]),t("td",{staticClass:"actions"},[t("button",{on:{click:function(t){return e.previewMaterial(s)}}},[e._v("预览")]),t("button",{on:{click:function(t){return e.downloadMaterial(s)}}},[e._v("下载")]),t("button",{on:{click:function(t){return e.showEditModal(s)}}},[e._v("编辑")]),t("button",{on:{click:function(t){return e.confirmDeleteMaterial(s)}}},[e._v("删除")])])])})),0===e.filteredMaterials.length?t("tr",[t("td",{staticClass:"no-data",attrs:{colspan:"8"}},[e._v("暂无资料")])]):e._e()],2)]),e.anySelected?t("div",{staticClass:"batch-actions"},[t("button",{on:{click:e.confirmDeleteSelected}},[e._v("删除选中项")])]):e._e()]),e.showUploadModal?t("div",{staticClass:"modal-backdrop",on:{click:function(t){e.showUploadModal=!1}}}):e._e(),e.showUploadModal?t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-header"},[t("h3",[e._v("上传资料")]),t("button",{staticClass:"modal-close",on:{click:function(t){e.showUploadModal=!1}}},[e._v("×")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"form-group"},[t("label",[e._v("资料名称")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.newMaterial.name,expression:"newMaterial.name"}],attrs:{type:"text",placeholder:"请输入资料名称"},domProps:{value:e.newMaterial.name},on:{input:function(t){t.target.composing||e.$set(e.newMaterial,"name",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[e._v("资料分类")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.newMaterial.categoryId,expression:"newMaterial.categoryId"}],on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.newMaterial,"categoryId",t.target.multiple?s:s[0])}}},[t("option",{attrs:{value:""}},[e._v("请选择分类")]),e._l(e.categories,(function(s){return t("option",{key:s.id,domProps:{value:s.id}},[e._v(" "+e._s(s.name)+" ")])}))],2)]),t("div",{staticClass:"form-group"},[t("label",[e._v("资料描述")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.newMaterial.description,expression:"newMaterial.description"}],attrs:{rows:"3",placeholder:"请输入资料描述"},domProps:{value:e.newMaterial.description},on:{input:function(t){t.target.composing||e.$set(e.newMaterial,"description",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[e._v("上传文件")]),t("input",{attrs:{type:"file"},on:{change:e.handleFileUpload}}),e.uploadPreview?t("div",{staticClass:"upload-preview"},[t("p",[e._v("文件名: "+e._s(e.uploadPreview.name))]),t("p",[e._v("文件大小: "+e._s(e.formatFileSize(e.uploadPreview.size)))]),t("p",[e._v("文件类型: "+e._s(e.uploadPreview.type))])]):e._e()])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"cancel-btn",on:{click:function(t){e.showUploadModal=!1}}},[e._v("取消")]),t("button",{staticClass:"confirm-btn",attrs:{disabled:!e.canUpload},on:{click:e.uploadMaterial}},[e._v("上传")])])]):e._e(),e.showEditModal?t("div",{staticClass:"modal-backdrop",on:{click:e.cancelEdit}}):e._e(),e.showEditModal?t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-header"},[t("h3",[e._v("编辑资料")]),t("button",{staticClass:"modal-close",on:{click:e.cancelEdit}},[e._v("×")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"form-group"},[t("label",[e._v("资料名称")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.editingMaterial.name,expression:"editingMaterial.name"}],attrs:{type:"text",placeholder:"请输入资料名称"},domProps:{value:e.editingMaterial.name},on:{input:function(t){t.target.composing||e.$set(e.editingMaterial,"name",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[e._v("资料分类")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.editingMaterial.categoryId,expression:"editingMaterial.categoryId"}],on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.editingMaterial,"categoryId",t.target.multiple?s:s[0])}}},[t("option",{attrs:{value:""}},[e._v("请选择分类")]),e._l(e.categories,(function(s){return t("option",{key:s.id,domProps:{value:s.id}},[e._v(" "+e._s(s.name)+" ")])}))],2)]),t("div",{staticClass:"form-group"},[t("label",[e._v("资料描述")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.editingMaterial.description,expression:"editingMaterial.description"}],attrs:{rows:"3",placeholder:"请输入资料描述"},domProps:{value:e.editingMaterial.description},on:{input:function(t){t.target.composing||e.$set(e.editingMaterial,"description",t.target.value)}}})])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"cancel-btn",on:{click:e.cancelEdit}},[e._v("取消")]),t("button",{staticClass:"confirm-btn",on:{click:e.saveMaterialEdit}},[e._v("保存")])])]):e._e(),e.showPreviewModal?t("div",{staticClass:"modal-backdrop",on:{click:e.closePreview}}):e._e(),e.showPreviewModal?t("div",{staticClass:"modal preview-modal"},[t("div",{staticClass:"modal-header"},[t("h3",[e._v("资料预览: "+e._s(e.previewingMaterial.name))]),t("button",{staticClass:"modal-close",on:{click:e.closePreview}},[e._v("×")])]),t("div",{staticClass:"modal-body preview-content"},[e.isPreviewablePdf?t("iframe",{attrs:{src:e.previewingMaterial.url,width:"100%",height:"500px"}}):e.isPreviewableImage?t("img",{attrs:{src:e.previewingMaterial.url,alt:"预览图片"}}):e.isPreviewableVideo?t("video",{attrs:{controls:"",width:"100%"}},[t("source",{attrs:{src:e.previewingMaterial.url,type:e.previewingMaterial.fileType}}),e._v(" 您的浏览器不支持视频预览 ")]):e.isPreviewableAudio?t("audio",{attrs:{controls:"",width:"100%"}},[t("source",{attrs:{src:e.previewingMaterial.url,type:e.previewingMaterial.fileType}}),e._v(" 您的浏览器不支持音频预览 ")]):t("div",{staticClass:"no-preview"},[t("p",[e._v("无法预览该类型文件，请下载后查看")]),t("p",[e._v("文件类型: "+e._s(e.previewingMaterial.fileType))]),t("button",{on:{click:function(t){return e.downloadMaterial(e.previewingMaterial)}}},[e._v("下载文件")])])])]):e._e(),e.showDeleteConfirm?t("div",{staticClass:"modal-backdrop",on:{click:e.cancelDelete}}):e._e(),e.showDeleteConfirm?t("div",{staticClass:"modal delete-confirm-modal"},[t("div",{staticClass:"modal-header"},[t("h3",[e._v("确认删除")]),t("button",{staticClass:"modal-close",on:{click:e.cancelDelete}},[e._v("×")])]),t("div",{staticClass:"modal-body"},["single"===e.deleteMode?t("p",[e._v(" 确定要删除资料 "),t("strong",[e._v(e._s(e.materialToDelete.name))]),e._v(" 吗？此操作不可恢复。 ")]):"multiple"===e.deleteMode?t("p",[e._v(" 确定要删除已选中的 "),t("strong",[e._v(e._s(e.selectedCount))]),e._v(" 项资料吗？此操作不可恢复。 ")]):e._e()]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"cancel-btn",on:{click:e.cancelDelete}},[e._v("取消")]),t("button",{staticClass:"delete-btn",on:{click:e.deleteMaterial}},[e._v("确认删除")])])]):e._e()])},he=[],fe={name:"MaterialsManagement",data(){return{materials:[],categories:[{id:1,name:"仿真教学资料"},{id:2,name:"视频教学资料"},{id:3,name:"设备介绍"},{id:4,name:"操作手册"},{id:5,name:"其他资料"}],searchKeyword:"",categoryFilter:"",dateFilter:"",filteredMaterials:[],selectAll:!1,showUploadModal:!1,newMaterial:{name:"",categoryId:"",description:"",file:null},uploadPreview:null,showEditModal:!1,editingMaterial:null,showPreviewModal:!1,previewingMaterial:null,showDeleteConfirm:!1,materialToDelete:null,deleteMode:"single"}},computed:{canUpload(){return this.newMaterial.name&&this.newMaterial.categoryId&&this.newMaterial.file},anySelected(){return this.materials.some((e=>e.selected))},selectedCount(){return this.materials.filter((e=>e.selected)).length},isPreviewablePdf(){return this.previewingMaterial&&"application/pdf"===this.previewingMaterial.fileType},isPreviewableImage(){return this.previewingMaterial&&this.previewingMaterial.fileType.startsWith("image/")},isPreviewableVideo(){return this.previewingMaterial&&this.previewingMaterial.fileType.startsWith("video/")},isPreviewableAudio(){return this.previewingMaterial&&this.previewingMaterial.fileType.startsWith("audio/")}},created(){this.loadMaterials()},methods:{loadMaterials(){this.materials=[{id:1,name:"装甲车操作手册.pdf",categoryId:4,fileType:"application/pdf",size:2621440,uploadDate:"2023-05-10T10:30:00",url:"https://example.com/files/manual.pdf",description:"装甲车基本操作指南，包含驾驶和维护说明",selected:!1},{id:2,name:"战术通信培训视频.mp4",categoryId:2,fileType:"video/mp4",size:15728640,uploadDate:"2023-05-08T14:45:00",url:"https://example.com/files/tactical_comms.mp4",description:"战场通信设备使用培训视频，包含实战应用场景",selected:!1},{id:3,name:"战术情境模拟.ppt",categoryId:1,fileType:"application/vnd.ms-powerpoint",size:5452595.2,uploadDate:"2023-05-05T09:15:00",url:"https://example.com/files/simulation.ppt",description:"各种战术情境下的应对措施培训幻灯片",selected:!1},{id:4,name:"通信设备介绍.docx",categoryId:3,fileType:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",size:1887436.8,uploadDate:"2023-05-03T16:20:00",url:"https://example.com/files/equipment.docx",description:"最新型号通信设备的技术参数和使用说明",selected:!1},{id:5,name:"战场急救演示.mp3",categoryId:2,fileType:"audio/mp3",size:3670016,uploadDate:"2023-04-28T11:10:00",url:"https://example.com/files/first_aid.mp3",description:"战场应急救护音频教程，包含抢救技巧讲解",selected:!1}],this.filterMaterials()},filterMaterials(){let e=[...this.materials];if(this.searchKeyword){const t=this.searchKeyword.toLowerCase();e=e.filter((e=>e.name.toLowerCase().includes(t)||e.description.toLowerCase().includes(t)))}this.categoryFilter&&(e=e.filter((e=>e.categoryId===parseInt(this.categoryFilter)))),this.dateFilter&&e.sort(((e,t)=>{const s=new Date(e.uploadDate),a=new Date(t.uploadDate);return"newest"===this.dateFilter?a-s:s-a})),this.filteredMaterials=e},searchMaterials(){this.filterMaterials()},getCategoryName(e){const t=this.categories.find((t=>t.id===e));return t?t.name:"未分类"},formatFileSize(e){return e<1024?e+" B":e<1048576?(e/1024).toFixed(1)+" KB":e<1073741824?(e/1048576).toFixed(1)+" MB":(e/1073741824).toFixed(1)+" GB"},formatDate(e){const t=new Date(e);return t.toLocaleDateString("zh-CN")},toggleSelectAll(){this.materials.forEach((e=>{e.selected=this.selectAll}))},handleFileUpload(e){const t=e.target.files[0];t&&(this.uploadPreview=t,this.newMaterial.file=t)},uploadMaterial(){if(!this.canUpload)return;const e=Math.max(...this.materials.map((e=>e.id)))+1,t={"application/pdf":"application/pdf","image/jpeg":"image/jpeg","image/png":"image/png","video/mp4":"video/mp4","audio/mp3":"audio/mp3","application/vnd.ms-powerpoint":"application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"application/vnd.openxmlformats-officedocument.wordprocessingml.document"},s=t[this.uploadPreview.type]||this.uploadPreview.type,a={id:e,name:this.newMaterial.name,categoryId:parseInt(this.newMaterial.categoryId),fileType:s,size:this.uploadPreview.size,uploadDate:(new Date).toISOString(),url:URL.createObjectURL(this.uploadPreview),description:this.newMaterial.description,selected:!1};this.materials.unshift(a),this.filterMaterials(),this.newMaterial={name:"",categoryId:"",description:"",file:null},this.uploadPreview=null,this.showUploadModal=!1},previewMaterial(e){this.previewingMaterial=e,this.showPreviewModal=!0},closePreview(){this.showPreviewModal=!1,this.previewingMaterial=null},downloadMaterial(e){console.log("下载资料:",e.name);const t=document.createElement("a");t.href=e.url,t.download=e.name,document.body.appendChild(t),t.click(),document.body.removeChild(t)},showEditModal(e){this.editingMaterial={...e},this.showEditModal=!0},cancelEdit(){this.editingMaterial=null,this.showEditModal=!1},saveMaterialEdit(){if(!this.editingMaterial.name||!this.editingMaterial.categoryId)return;const e=this.materials.findIndex((e=>e.id===this.editingMaterial.id));-1!==e&&(this.materials[e]={...this.materials[e],...this.editingMaterial}),this.filterMaterials(),this.cancelEdit()},confirmDeleteMaterial(e){this.materialToDelete=e,this.deleteMode="single",this.showDeleteConfirm=!0},confirmDeleteSelected(){this.deleteMode="multiple",this.showDeleteConfirm=!0},cancelDelete(){this.materialToDelete=null,this.showDeleteConfirm=!1},deleteMaterial(){"single"===this.deleteMode&&this.materialToDelete?this.materials=this.materials.filter((e=>e.id!==this.materialToDelete.id)):"multiple"===this.deleteMode&&(this.materials=this.materials.filter((e=>!e.selected))),this.filterMaterials(),this.cancelDelete(),this.selectAll=!1}}},ge=fe,_e=(0,n.A)(ge,ve,he,!1,null,"7f938b05",null),Ce=_e.exports,we=function(){var e=this,t=e._self._c;return t("div",{staticClass:"guided-teaching-container"},[t("h1",{staticClass:"page-title"},[e._v("引导教学")]),t("div",{staticClass:"function-area"},[t("div",{staticClass:"search-area"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchKeyword,expression:"searchKeyword"}],attrs:{type:"text",placeholder:"输入课程名称搜索"},domProps:{value:e.searchKeyword},on:{input:[function(t){t.target.composing||(e.searchKeyword=t.target.value)},e.searchCourses]}}),t("select",{directives:[{name:"model",rawName:"v-model",value:e.statusFilter,expression:"statusFilter"}],on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.statusFilter=t.target.multiple?s:s[0]},e.filterCourses]}},[t("option",{attrs:{value:""}},[e._v("所有状态")]),t("option",{attrs:{value:"upcoming"}},[e._v("即将开始")]),t("option",{attrs:{value:"ongoing"}},[e._v("进行中")]),t("option",{attrs:{value:"completed"}},[e._v("已结束")])]),t("button",{staticClass:"add-btn",on:{click:function(t){e.showAddModal=!0}}},[e._v("新增引导教学")])])]),t("div",{staticClass:"course-list"},[t("table",[t("thead",[t("tr",[t("th",[t("input",{directives:[{name:"model",rawName:"v-model",value:e.selectAll,expression:"selectAll"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.selectAll)?e._i(e.selectAll,null)>-1:e.selectAll},on:{change:[function(t){var s=e.selectAll,a=t.target,r=!!a.checked;if(Array.isArray(s)){var i=null,o=e._i(s,i);a.checked?o<0&&(e.selectAll=s.concat([i])):o>-1&&(e.selectAll=s.slice(0,o).concat(s.slice(o+1)))}else e.selectAll=r},e.toggleSelectAll]}})]),t("th",[e._v("课程名称")]),t("th",[e._v("班级")]),t("th",[e._v("编组类型")]),t("th",[e._v("开始时间")]),t("th",[e._v("结束时间")]),t("th",[e._v("学习时长(分钟)")]),t("th",[e._v("可学习次数")]),t("th",[e._v("状态")]),t("th",[e._v("操作")])])]),t("tbody",[e._l(e.filteredCourses,(function(s){return t("tr",{key:s.id},[t("td",[t("input",{directives:[{name:"model",rawName:"v-model",value:s.selected,expression:"course.selected"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(s.selected)?e._i(s.selected,null)>-1:s.selected},on:{change:function(t){var a=s.selected,r=t.target,i=!!r.checked;if(Array.isArray(a)){var o=null,l=e._i(a,o);r.checked?l<0&&e.$set(s,"selected",a.concat([o])):l>-1&&e.$set(s,"selected",a.slice(0,l).concat(a.slice(l+1)))}else e.$set(s,"selected",i)}}})]),t("td",[e._v(e._s(e.getCourseName(s.courseId)))]),t("td",[e._v(e._s(e.getClassName(s.classId)))]),t("td",[e._v(e._s(e.getGroupTypeDisplay(s.groupType)))]),t("td",[e._v(e._s(e.formatDate(s.startTime)))]),t("td",[e._v(e._s(e.formatDate(s.endTime)))]),t("td",[e._v(e._s(s.duration))]),t("td",[e._v(e._s(-1===s.maxAttempts?"不限":s.maxAttempts))]),t("td",[t("span",{staticClass:"status-tag",class:e.getCourseStatus(s)},[e._v(" "+e._s(e.getStatusText(e.getCourseStatus(s)))+" ")])]),t("td",{staticClass:"actions"},[t("button",{on:{click:function(t){return e.viewCourse(s)}}},[e._v("查看")]),t("button",{on:{click:function(t){return e.editCourse(s)}}},[e._v("编辑")]),t("button",{on:{click:function(t){return e.confirmDeleteCourse(s)}}},[e._v("删除")]),"student"===e.userRole?t("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.launchSimulation(s)}}},[e._v(" 启动仿真 ")]):e._e()],1)])})),0===e.filteredCourses.length?t("tr",[t("td",{staticClass:"no-data",attrs:{colspan:"10"}},[e._v("暂无课程")])]):e._e()],2)]),e.anySelected?t("div",{staticClass:"batch-actions"},[t("button",{on:{click:e.confirmDeleteSelected}},[e._v("删除选中项")])]):e._e()]),e.showAddModal||e.showEditModal?t("div",{staticClass:"modal-backdrop",on:{click:e.cancelAddEdit}}):e._e(),e.showAddModal||e.showEditModal?t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-header"},[t("h3",[e._v(e._s(e.showAddModal?"新增":"编辑")+"引导教学课程")]),t("button",{staticClass:"modal-close",on:{click:e.cancelAddEdit}},[e._v("×")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"form-group"},[e._m(0),t("select",{directives:[{name:"model",rawName:"v-model",value:e.currentCourse.courseId,expression:"currentCourse.courseId"}],on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.currentCourse,"courseId",t.target.multiple?s:s[0])}}},[t("option",{attrs:{value:""}},[e._v("请选择课程")]),e._l(e.availableCourses,(function(s){return t("option",{key:s.id,domProps:{value:s.id}},[e._v(" "+e._s(s.name)+" ")])}))],2)]),t("div",{staticClass:"form-group"},[e._m(1),t("select",{directives:[{name:"model",rawName:"v-model",value:e.currentCourse.classId,expression:"currentCourse.classId"}],on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.currentCourse,"classId",t.target.multiple?s:s[0])},e.handleClassChange]}},[t("option",{attrs:{value:""}},[e._v("请选择班级")]),e._l(e.classList,(function(s){return t("option",{key:s.id,domProps:{value:s.id}},[e._v(" "+e._s(s.name)+" ")])}))],2)]),t("div",{staticClass:"form-group"},[e._m(2),t("div",{staticClass:"radio-group"},[t("label",{staticClass:"radio-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.currentCourse.groupType,expression:"currentCourse.groupType"}],attrs:{type:"radio",value:"individual"},domProps:{checked:e._q(e.currentCourse.groupType,"individual")},on:{change:function(t){return e.$set(e.currentCourse,"groupType","individual")}}}),t("span",[e._v("单人")])]),t("label",{staticClass:"radio-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.currentCourse.groupType,expression:"currentCourse.groupType"}],attrs:{type:"radio",value:"single"},domProps:{checked:e._q(e.currentCourse.groupType,"single")},on:{change:function(t){return e.$set(e.currentCourse,"groupType","single")}}}),t("span",[e._v("单编组")])]),t("label",{staticClass:"radio-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.currentCourse.groupType,expression:"currentCourse.groupType"}],attrs:{type:"radio",value:"multiple"},domProps:{checked:e._q(e.currentCourse.groupType,"multiple")},on:{change:function(t){return e.$set(e.currentCourse,"groupType","multiple")}}}),t("span",[e._v("多编组")])])])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group half"},[e._m(3),t("input",{directives:[{name:"model",rawName:"v-model",value:e.currentCourse.startTime,expression:"currentCourse.startTime"}],attrs:{type:"datetime-local"},domProps:{value:e.currentCourse.startTime},on:{input:function(t){t.target.composing||e.$set(e.currentCourse,"startTime",t.target.value)}}})]),t("div",{staticClass:"form-group half"},[e._m(4),t("input",{directives:[{name:"model",rawName:"v-model",value:e.currentCourse.endTime,expression:"currentCourse.endTime"}],attrs:{type:"datetime-local"},domProps:{value:e.currentCourse.endTime},on:{input:function(t){t.target.composing||e.$set(e.currentCourse,"endTime",t.target.value)}}})])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group half"},[e._m(5),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.currentCourse.duration,expression:"currentCourse.duration",modifiers:{number:!0}}],attrs:{type:"number",min:"1"},domProps:{value:e.currentCourse.duration},on:{input:function(t){t.target.composing||e.$set(e.currentCourse,"duration",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})]),t("div",{staticClass:"form-group half"},[t("label",[e._v("可学习次数")]),t("div",{staticClass:"input-with-option"},[t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.currentCourse.maxAttempts,expression:"currentCourse.maxAttempts",modifiers:{number:!0}}],attrs:{type:"number",min:"1",disabled:e.currentCourse.unlimitedAttempts},domProps:{value:e.currentCourse.maxAttempts},on:{input:function(t){t.target.composing||e.$set(e.currentCourse,"maxAttempts",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),t("label",{staticClass:"checkbox-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.currentCourse.unlimitedAttempts,expression:"currentCourse.unlimitedAttempts"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.currentCourse.unlimitedAttempts)?e._i(e.currentCourse.unlimitedAttempts,null)>-1:e.currentCourse.unlimitedAttempts},on:{change:function(t){var s=e.currentCourse.unlimitedAttempts,a=t.target,r=!!a.checked;if(Array.isArray(s)){var i=null,o=e._i(s,i);a.checked?o<0&&e.$set(e.currentCourse,"unlimitedAttempts",s.concat([i])):o>-1&&e.$set(e.currentCourse,"unlimitedAttempts",s.slice(0,o).concat(s.slice(o+1)))}else e.$set(e.currentCourse,"unlimitedAttempts",r)}}}),t("span",[e._v("不限")])])])])]),t("div",{staticClass:"form-group"},[t("label",[e._v("备注说明")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.currentCourse.notes,expression:"currentCourse.notes"}],attrs:{rows:"3",placeholder:"请输入备注说明"},domProps:{value:e.currentCourse.notes},on:{input:function(t){t.target.composing||e.$set(e.currentCourse,"notes",t.target.value)}}})])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"cancel-btn",on:{click:e.cancelAddEdit}},[e._v("取消")]),t("button",{staticClass:"confirm-btn",attrs:{disabled:!e.isFormValid},on:{click:e.saveCourse}},[e._v(" 保存 ")])])]):e._e(),e.showViewModal?t("div",{staticClass:"modal-backdrop",on:{click:function(t){e.showViewModal=!1}}}):e._e(),e.showViewModal?t("div",{staticClass:"modal view-modal"},[t("div",{staticClass:"modal-header"},[t("h3",[e._v("课程详情")]),t("button",{staticClass:"modal-close",on:{click:function(t){e.showViewModal=!1}}},[e._v("×")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"view-group"},[t("label",[e._v("课程名称")]),t("div",[e._v(e._s(e.getCourseName(e.viewingCourse.courseId)))])]),t("div",{staticClass:"view-group"},[t("label",[e._v("班级")]),t("div",[e._v(e._s(e.getClassName(e.viewingCourse.classId)))])]),t("div",{staticClass:"view-group"},[t("label",[e._v("编组类型")]),t("div",[e._v(e._s(e.getGroupTypeDisplay(e.viewingCourse.groupType)))])]),t("div",{staticClass:"view-row"},[t("div",{staticClass:"view-group half"},[t("label",[e._v("开始时间")]),t("div",[e._v(e._s(e.formatDateTime(e.viewingCourse.startTime)))])]),t("div",{staticClass:"view-group half"},[t("label",[e._v("结束时间")]),t("div",[e._v(e._s(e.formatDateTime(e.viewingCourse.endTime)))])])]),t("div",{staticClass:"view-row"},[t("div",{staticClass:"view-group half"},[t("label",[e._v("学习时长")]),t("div",[e._v(e._s(e.viewingCourse.duration)+" 分钟")])]),t("div",{staticClass:"view-group half"},[t("label",[e._v("可学习次数")]),t("div",[e._v(e._s(-1===e.viewingCourse.maxAttempts?"不限":e.viewingCourse.maxAttempts))])])]),t("div",{staticClass:"view-group"},[t("label",[e._v("状态")]),t("div",[t("span",{staticClass:"status-tag",class:e.getCourseStatus(e.viewingCourse)},[e._v(" "+e._s(e.getStatusText(e.getCourseStatus(e.viewingCourse)))+" ")])])]),t("div",{staticClass:"view-group"},[t("label",[e._v("备注说明")]),t("div",{staticClass:"view-description"},[e._v(e._s(e.viewingCourse.notes||"暂无备注"))])])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"confirm-btn",on:{click:function(t){e.showViewModal=!1}}},[e._v("关闭")])])]):e._e(),e.showDeleteConfirm?t("div",{staticClass:"modal-backdrop",on:{click:e.cancelDelete}}):e._e(),e.showDeleteConfirm?t("div",{staticClass:"modal delete-confirm-modal"},[t("div",{staticClass:"modal-header"},[t("h3",[e._v("确认删除")]),t("button",{staticClass:"modal-close",on:{click:e.cancelDelete}},[e._v("×")])]),t("div",{staticClass:"modal-body"},["single"===e.deleteMode?t("p",[e._v(" 确定要删除引导教学课程 "),t("strong",[e._v(e._s(e.getCourseName(e.courseToDelete?.courseId)))]),e._v(" 吗？此操作不可恢复。 ")]):"multiple"===e.deleteMode?t("p",[e._v(" 确定要删除已选中的 "),t("strong",[e._v(e._s(e.selectedCount))]),e._v(" 项引导教学课程吗？此操作不可恢复。 ")]):e._e()]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"cancel-btn",on:{click:e.cancelDelete}},[e._v("取消")]),t("button",{staticClass:"delete-btn",on:{click:e.deleteCourse}},[e._v("确认删除")])])]):e._e()])},be=[function(){var e=this,t=e._self._c;return t("label",[e._v("课程名称 "),t("span",{staticClass:"required"},[e._v("*")])])},function(){var e=this,t=e._self._c;return t("label",[e._v("班级 "),t("span",{staticClass:"required"},[e._v("*")])])},function(){var e=this,t=e._self._c;return t("label",[e._v("编组类型 "),t("span",{staticClass:"required"},[e._v("*")])])},function(){var e=this,t=e._self._c;return t("label",[e._v("开始时间 "),t("span",{staticClass:"required"},[e._v("*")])])},function(){var e=this,t=e._self._c;return t("label",[e._v("结束时间 "),t("span",{staticClass:"required"},[e._v("*")])])},function(){var e=this,t=e._self._c;return t("label",[e._v("学习时长(分钟) "),t("span",{staticClass:"required"},[e._v("*")])])}],ye={name:"GuidedTeaching",data(){return{searchKeyword:"",statusFilter:"",selectAll:!1,courses:[{id:1,courseId:1,classId:1,groupType:"individual",startTime:"2024-03-21T09:00",endTime:"2024-03-21T17:00",duration:120,maxAttempts:3,notes:"请学员在规定时间内完成训练，注意按照操作规程进行。训练过程中如遇问题请及时与教员联系。",selected:!1}],filteredCourses:[],classList:[{id:1,name:"装甲一班",students:["张三","李四","王五"]}],classStudents:[],classGroups:[],availableCourses:[{id:1,name:"装甲车操作模拟训练",category:"仿真课程"}],showAddModal:!1,showEditModal:!1,showViewModal:!1,showDeleteConfirm:!1,currentCourse:{courseId:"",classId:"",groupType:"individual",startTime:"",endTime:"",duration:120,maxAttempts:3,unlimitedAttempts:!1,notes:""},viewingCourse:null,courseToDelete:null,deleteMode:"single",userRole:"",userId:"",groupId:""}},computed:{anySelected(){return this.courses.some((e=>e.selected))},selectedCount(){return this.courses.filter((e=>e.selected)).length},isFormValid(){const e=this.currentCourse;return e.courseId&&e.classId&&e.groupType&&e.startTime&&e.endTime&&e.duration>0&&(e.unlimitedAttempts||e.maxAttempts>0)}},created(){this.userRole=this.$store.state.user.userInfo.role||"student";const e=this.$store.state.user.userInfo;this.userId=e.id,this.groupId=e.groupId,this.loadData()},methods:{loadData(){this.loadClassList(),this.loadCourseList(),this.loadGuidedTeachingData()},loadClassList(){this.classList=[{id:1,name:"装甲一班",students:["张三","李四","王五"]},{id:2,name:"新兵连二班",code:"XBL-02"},{id:3,name:"特种作战训练班",code:"TSC-01"}]},loadCourseList(){this.availableCourses=[{id:1,name:"装甲车操作模拟训练",category:"仿真课程"},{id:2,name:"VR战场环境适应训练",categoryId:1,totalScore:90},{id:3,name:"战术通信训练",categoryId:2,totalScore:85},{id:4,name:"战场急救技能",categoryId:3,totalScore:80}]},loadGuidedTeachingData(){this.courses=[{id:1,courseId:1,classId:1,groupType:"individual",startTime:"2023-12-01T08:00",endTime:"2023-12-15T18:00",duration:60,maxAttempts:3,notes:"装甲车辆驾驶基础训练，请按时完成",selected:!1},{id:2,courseId:2,classId:2,groupType:"individual",startTime:"2023-11-25T10:00",endTime:"2023-12-10T18:00",duration:90,maxAttempts:-1,notes:"VR适应性训练，可重复练习",selected:!1},{id:3,courseId:4,classId:3,groupType:"individual",startTime:"2023-12-20T09:00",endTime:"2024-01-10T18:00",duration:45,maxAttempts:2,notes:"战场急救技能入门课程",selected:!1},{id:4,courseId:3,classId:1,groupType:"single",startTime:"2023-12-05T13:00",endTime:"2023-12-20T18:00",duration:120,maxAttempts:1,notes:"新兵连一班第一编组战术通信训练",selected:!1},{id:5,courseId:1,classId:2,groupType:"multiple",startTime:"2023-12-10T09:00",endTime:"2023-12-30T18:00",duration:180,maxAttempts:2,notes:"新兵连二班多编组装甲车辆驾驶训练",selected:!1},{id:6,courseId:2,classId:3,groupType:"multiple",startTime:"2024-01-05T08:00",endTime:"2024-01-25T18:00",duration:90,maxAttempts:-1,notes:"特种作战班多编组VR战场环境训练",selected:!1},{id:7,courseId:1,classId:1,groupType:"individual",startTime:"2024-03-21T09:00",endTime:"2024-03-21T17:00",duration:120,maxAttempts:3,notes:"请学员在规定时间内完成训练，注意按照操作规程进行。训练过程中如遇问题请及时与教员联系。",selected:!1}],this.filterCourses()},filterCourses(){let e=[...this.courses];if(this.searchKeyword){const t=this.searchKeyword.toLowerCase();e=e.filter((e=>{const s=this.getCourseName(e.courseId).toLowerCase(),a=this.getClassName(e.classId).toLowerCase(),r=(e.notes||"").toLowerCase();return s.includes(t)||a.includes(t)||r.includes(t)}))}this.statusFilter&&(e=e.filter((e=>this.getCourseStatus(e)===this.statusFilter))),e.sort(((e,t)=>new Date(t.startTime)-new Date(e.startTime))),this.filteredCourses=e},searchCourses(){this.filterCourses()},toggleSelectAll(){this.courses.forEach((e=>{e.selected=this.selectAll}))},getCourseName(e){const t=this.availableCourses.find((t=>t.id===e));return t?t.name:"未知课程"},getClassName(e){const t=this.classList.find((t=>t.id===e));return t?t.name:"未知班级"},getCourseStatus(e){const t=new Date,s=new Date(e.startTime),a=new Date(e.endTime);return t<s?"upcoming":t>a?"completed":"ongoing"},getStatusText(e){const t={upcoming:"即将开始",ongoing:"进行中",completed:"已结束"};return t[e]||"未知"},viewCourse(e){this.viewingCourse={...e},this.showViewModal=!0},editCourse(e){this.currentCourse={...e,unlimitedAttempts:-1===e.maxAttempts},this.showEditModal=!0},cancelAddEdit(){this.showAddModal=!1,this.showEditModal=!1},saveCourse(){if(this.currentCourse.unlimitedAttempts&&(this.currentCourse.maxAttempts=-1),this.showAddModal){const e={...this.currentCourse,id:this.courses.length>0?Math.max(...this.courses.map((e=>e.id)))+1:1,selected:!1};this.courses.push(e)}else{const e=this.courses.findIndex((e=>e.id===this.currentCourse.id));-1!==e&&(this.courses[e]={...this.currentCourse})}this.filterCourses(),this.cancelAddEdit()},confirmDeleteCourse(e){this.courseToDelete=e,this.deleteMode="single",this.showDeleteConfirm=!0},cancelDelete(){this.showDeleteConfirm=!1,this.courseToDelete=null},deleteCourse(){"single"===this.deleteMode?this.courses=this.courses.filter((e=>e.id!==this.courseToDelete.id)):this.courses=this.courses.filter((e=>!e.selected)),this.filterCourses(),this.cancelDelete()},formatDate(e){const t=new Date(e);return t.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"})},formatDateTime(e){const t=new Date(e);return t.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},formatDateForInput(e){const t=new Date(e),s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),i=String(t.getHours()).padStart(2,"0"),o=String(t.getMinutes()).padStart(2,"0");return`${s}-${a}-${r}T${i}:${o}`},handleClassChange(){this.loadClassStudents(this.currentCourse.classId),this.loadClassGroups(this.currentCourse.classId)},loadClassStudents(e){const t={1:[{id:3,username:"student_wang",fullName:"王学员"},{id:8,username:"student_yang",fullName:"杨学员"},{id:17,username:"student_gao",fullName:"高学员"},{id:18,username:"student_lin",fullName:"林学员"},{id:19,username:"student_he",fullName:"何学员"}],2:[{id:7,username:"student_liu",fullName:"刘学员"},{id:25,username:"student_hu",fullName:"胡学员"},{id:26,username:"student_tian",fullName:"田学员"},{id:27,username:"student_xu",fullName:"徐学员"},{id:28,username:"student_deng",fullName:"邓学员"}],3:[{id:9,username:"student_zhang",fullName:"张学员"},{id:10,username:"student_zhao",fullName:"赵学员"},{id:11,username:"student_qian",fullName:"钱学员"},{id:12,username:"student_sun",fullName:"孙学员"},{id:13,username:"student_li",fullName:"李学员"}]};this.classStudents=t[e]||[]},loadClassGroups(e){const t={1:[{id:1,name:"步兵小组",memberCount:3},{id:2,name:"炮兵小组",memberCount:2}],2:[{id:3,name:"通信小组",memberCount:2},{id:4,name:"侦察小组",memberCount:3}],3:[{id:5,name:"突击小组",memberCount:2},{id:6,name:"狙击小组",memberCount:1},{id:7,name:"支援小组",memberCount:2}]};this.classGroups=t[e]||[]},getGroupTypeDisplay(e){const t={individual:"单人",single:"单编组",multiple:"多编组"};return t[e]||"未知"},async launchSimulation(e){try{const t=this.$store.state.user.userInfo,s={courseId:e.id,studentId:t.id,groupId:t.groupId||null},a=await this.$api.post("/simulation/launch",s);a.success?this.$message.success("仿真程序启动成功"):this.$message.error("仿真程序启动失败")}catch(t){console.error("启动仿真程序失败:",t),this.$message.error("启动仿真程序失败，请稍后重试")}}}},Me=ye,ke=(0,n.A)(Me,we,be,!1,null,"1d46eb32",null),Ie=ke.exports,xe=function(){var e=this,t=e._self._c;return t("div",{staticClass:"free-training-container"},[t("h1",{staticClass:"page-title"},[e._v("自由训练")]),t("div",{staticClass:"function-area"},[t("div",{staticClass:"search-area"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchKeyword,expression:"searchKeyword"}],attrs:{type:"text",placeholder:"输入课程名称搜索"},domProps:{value:e.searchKeyword},on:{input:[function(t){t.target.composing||(e.searchKeyword=t.target.value)},e.searchCourses]}}),t("select",{directives:[{name:"model",rawName:"v-model",value:e.statusFilter,expression:"statusFilter"}],on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.statusFilter=t.target.multiple?s:s[0]},e.filterCourses]}},[t("option",{attrs:{value:""}},[e._v("所有状态")]),t("option",{attrs:{value:"upcoming"}},[e._v("即将开始")]),t("option",{attrs:{value:"ongoing"}},[e._v("进行中")]),t("option",{attrs:{value:"completed"}},[e._v("已结束")])]),t("button",{staticClass:"add-btn",on:{click:function(t){e.showAddModal=!0}}},[e._v("新增自由训练")])])]),t("div",{staticClass:"course-list"},[t("table",[t("thead",[t("tr",[t("th",[t("input",{directives:[{name:"model",rawName:"v-model",value:e.selectAll,expression:"selectAll"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.selectAll)?e._i(e.selectAll,null)>-1:e.selectAll},on:{change:[function(t){var s=e.selectAll,a=t.target,r=!!a.checked;if(Array.isArray(s)){var i=null,o=e._i(s,i);a.checked?o<0&&(e.selectAll=s.concat([i])):o>-1&&(e.selectAll=s.slice(0,o).concat(s.slice(o+1)))}else e.selectAll=r},e.toggleSelectAll]}})]),t("th",[e._v("课程名称")]),t("th",[e._v("班级")]),t("th",[e._v("编组类型")]),t("th",[e._v("开始时间")]),t("th",[e._v("结束时间")]),t("th",[e._v("学习时长(分钟)")]),t("th",[e._v("可学习次数")]),t("th",[e._v("状态")]),t("th",[e._v("操作")])])]),t("tbody",[e._l(e.filteredCourses,(function(s){return t("tr",{key:s.id},[t("td",[t("input",{directives:[{name:"model",rawName:"v-model",value:s.selected,expression:"course.selected"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(s.selected)?e._i(s.selected,null)>-1:s.selected},on:{change:function(t){var a=s.selected,r=t.target,i=!!r.checked;if(Array.isArray(a)){var o=null,l=e._i(a,o);r.checked?l<0&&e.$set(s,"selected",a.concat([o])):l>-1&&e.$set(s,"selected",a.slice(0,l).concat(a.slice(l+1)))}else e.$set(s,"selected",i)}}})]),t("td",[e._v(e._s(e.getCourseName(s.courseId)))]),t("td",[e._v(e._s(e.getClassName(s.classId)))]),t("td",[e._v(e._s(e.getGroupTypeDisplay(s.groupType)))]),t("td",[e._v(e._s(e.formatDate(s.startTime)))]),t("td",[e._v(e._s(e.formatDate(s.endTime)))]),t("td",[e._v(e._s(s.duration))]),t("td",[e._v(e._s(-1===s.maxAttempts?"不限":s.maxAttempts))]),t("td",[t("span",{staticClass:"status-tag",class:e.getCourseStatus(s)},[e._v(" "+e._s(e.getStatusText(e.getCourseStatus(s)))+" ")])]),t("td",{staticClass:"actions"},[t("button",{on:{click:function(t){return e.viewCourse(s)}}},[e._v("查看")]),t("button",{on:{click:function(t){return e.editCourse(s)}}},[e._v("编辑")]),t("button",{on:{click:function(t){return e.confirmDeleteCourse(s)}}},[e._v("删除")]),"student"===e.userRole?t("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.launchSimulation(s)}}},[e._v(" 启动仿真 ")]):e._e()],1)])})),0===e.filteredCourses.length?t("tr",[t("td",{staticClass:"no-data",attrs:{colspan:"10"}},[e._v("暂无课程")])]):e._e()],2)]),e.anySelected?t("div",{staticClass:"batch-actions"},[t("button",{on:{click:e.confirmDeleteSelected}},[e._v("删除选中项")])]):e._e()]),e.showAddModal||e.showEditModal?t("div",{staticClass:"modal-backdrop",on:{click:e.cancelAddEdit}}):e._e(),e.showAddModal||e.showEditModal?t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-header"},[t("h3",[e._v(e._s(e.showAddModal?"新增":"编辑")+"自由训练课程")]),t("button",{staticClass:"modal-close",on:{click:e.cancelAddEdit}},[e._v("×")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"form-group"},[e._m(0),t("select",{directives:[{name:"model",rawName:"v-model",value:e.currentCourse.courseId,expression:"currentCourse.courseId"}],on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.currentCourse,"courseId",t.target.multiple?s:s[0])}}},[t("option",{attrs:{value:""}},[e._v("请选择课程")]),e._l(e.availableCourses,(function(s){return t("option",{key:s.id,domProps:{value:s.id}},[e._v(" "+e._s(s.name)+" ")])}))],2)]),t("div",{staticClass:"form-group"},[e._m(1),t("select",{directives:[{name:"model",rawName:"v-model",value:e.currentCourse.classId,expression:"currentCourse.classId"}],on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.currentCourse,"classId",t.target.multiple?s:s[0])},e.handleClassChange]}},[t("option",{attrs:{value:""}},[e._v("请选择班级")]),e._l(e.classList,(function(s){return t("option",{key:s.id,domProps:{value:s.id}},[e._v(" "+e._s(s.name)+" ")])}))],2)]),t("div",{staticClass:"form-group"},[e._m(2),t("div",{staticClass:"radio-group"},[t("label",{staticClass:"radio-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.currentCourse.groupType,expression:"currentCourse.groupType"}],attrs:{type:"radio",value:"individual"},domProps:{checked:e._q(e.currentCourse.groupType,"individual")},on:{change:function(t){return e.$set(e.currentCourse,"groupType","individual")}}}),t("span",[e._v("单人")])]),t("label",{staticClass:"radio-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.currentCourse.groupType,expression:"currentCourse.groupType"}],attrs:{type:"radio",value:"single"},domProps:{checked:e._q(e.currentCourse.groupType,"single")},on:{change:function(t){return e.$set(e.currentCourse,"groupType","single")}}}),t("span",[e._v("单编组")])]),t("label",{staticClass:"radio-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.currentCourse.groupType,expression:"currentCourse.groupType"}],attrs:{type:"radio",value:"multiple"},domProps:{checked:e._q(e.currentCourse.groupType,"multiple")},on:{change:function(t){return e.$set(e.currentCourse,"groupType","multiple")}}}),t("span",[e._v("多编组")])])])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group half"},[e._m(3),t("input",{directives:[{name:"model",rawName:"v-model",value:e.currentCourse.startTime,expression:"currentCourse.startTime"}],attrs:{type:"datetime-local"},domProps:{value:e.currentCourse.startTime},on:{input:function(t){t.target.composing||e.$set(e.currentCourse,"startTime",t.target.value)}}})]),t("div",{staticClass:"form-group half"},[e._m(4),t("input",{directives:[{name:"model",rawName:"v-model",value:e.currentCourse.endTime,expression:"currentCourse.endTime"}],attrs:{type:"datetime-local"},domProps:{value:e.currentCourse.endTime},on:{input:function(t){t.target.composing||e.$set(e.currentCourse,"endTime",t.target.value)}}})])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"form-group half"},[e._m(5),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.currentCourse.duration,expression:"currentCourse.duration",modifiers:{number:!0}}],attrs:{type:"number",min:"1"},domProps:{value:e.currentCourse.duration},on:{input:function(t){t.target.composing||e.$set(e.currentCourse,"duration",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})]),t("div",{staticClass:"form-group half"},[t("label",[e._v("可学习次数")]),t("div",{staticClass:"input-with-option"},[t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.currentCourse.maxAttempts,expression:"currentCourse.maxAttempts",modifiers:{number:!0}}],attrs:{type:"number",min:"1",disabled:e.currentCourse.unlimitedAttempts},domProps:{value:e.currentCourse.maxAttempts},on:{input:function(t){t.target.composing||e.$set(e.currentCourse,"maxAttempts",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),t("label",{staticClass:"checkbox-label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.currentCourse.unlimitedAttempts,expression:"currentCourse.unlimitedAttempts"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.currentCourse.unlimitedAttempts)?e._i(e.currentCourse.unlimitedAttempts,null)>-1:e.currentCourse.unlimitedAttempts},on:{change:function(t){var s=e.currentCourse.unlimitedAttempts,a=t.target,r=!!a.checked;if(Array.isArray(s)){var i=null,o=e._i(s,i);a.checked?o<0&&e.$set(e.currentCourse,"unlimitedAttempts",s.concat([i])):o>-1&&e.$set(e.currentCourse,"unlimitedAttempts",s.slice(0,o).concat(s.slice(o+1)))}else e.$set(e.currentCourse,"unlimitedAttempts",r)}}}),t("span",[e._v("不限")])])])])]),t("div",{staticClass:"form-group"},[t("label",[e._v("备注说明")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.currentCourse.notes,expression:"currentCourse.notes"}],attrs:{rows:"3",placeholder:"请输入备注说明"},domProps:{value:e.currentCourse.notes},on:{input:function(t){t.target.composing||e.$set(e.currentCourse,"notes",t.target.value)}}})])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"cancel-btn",on:{click:e.cancelAddEdit}},[e._v("取消")]),t("button",{staticClass:"confirm-btn",attrs:{disabled:!e.isFormValid},on:{click:e.saveCourse}},[e._v(" 保存 ")])])]):e._e(),e.showViewModal?t("div",{staticClass:"modal-backdrop",on:{click:function(t){e.showViewModal=!1}}}):e._e(),e.showViewModal?t("div",{staticClass:"modal view-modal"},[t("div",{staticClass:"modal-header"},[t("h3",[e._v("课程详情")]),t("button",{staticClass:"modal-close",on:{click:function(t){e.showViewModal=!1}}},[e._v("×")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"view-group"},[t("label",[e._v("课程名称")]),t("div",[e._v(e._s(e.getCourseName(e.viewingCourse.courseId)))])]),t("div",{staticClass:"view-group"},[t("label",[e._v("班级")]),t("div",[e._v(e._s(e.getClassName(e.viewingCourse.classId)))])]),t("div",{staticClass:"view-group"},[t("label",[e._v("编组类型")]),t("div",[e._v(e._s(e.getGroupTypeDisplay(e.viewingCourse.groupType)))])]),t("div",{staticClass:"view-row"},[t("div",{staticClass:"view-group half"},[t("label",[e._v("开始时间")]),t("div",[e._v(e._s(e.formatDateTime(e.viewingCourse.startTime)))])]),t("div",{staticClass:"view-group half"},[t("label",[e._v("结束时间")]),t("div",[e._v(e._s(e.formatDateTime(e.viewingCourse.endTime)))])])]),t("div",{staticClass:"view-row"},[t("div",{staticClass:"view-group half"},[t("label",[e._v("学习时长")]),t("div",[e._v(e._s(e.viewingCourse.duration)+" 分钟")])]),t("div",{staticClass:"view-group half"},[t("label",[e._v("可学习次数")]),t("div",[e._v(e._s(-1===e.viewingCourse.maxAttempts?"不限":e.viewingCourse.maxAttempts))])])]),t("div",{staticClass:"view-group"},[t("label",[e._v("状态")]),t("div",[t("span",{staticClass:"status-tag",class:e.getCourseStatus(e.viewingCourse)},[e._v(" "+e._s(e.getStatusText(e.getCourseStatus(e.viewingCourse)))+" ")])])]),t("div",{staticClass:"view-group"},[t("label",[e._v("备注说明")]),t("div",{staticClass:"view-description"},[e._v(e._s(e.viewingCourse.notes||"暂无备注"))])])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"confirm-btn",on:{click:function(t){e.showViewModal=!1}}},[e._v("关闭")])])]):e._e(),e.showDeleteConfirm?t("div",{staticClass:"modal-backdrop",on:{click:e.cancelDelete}}):e._e(),e.showDeleteConfirm?t("div",{staticClass:"modal delete-confirm-modal"},[t("div",{staticClass:"modal-header"},[t("h3",[e._v("确认删除")]),t("button",{staticClass:"modal-close",on:{click:e.cancelDelete}},[e._v("×")])]),t("div",{staticClass:"modal-body"},["single"===e.deleteMode?t("p",[e._v(" 确定要删除自由训练课程 "),t("strong",[e._v(e._s(e.getCourseName(e.courseToDelete?.courseId)))]),e._v(" 吗？此操作不可恢复。 ")]):"multiple"===e.deleteMode?t("p",[e._v(" 确定要删除已选中的 "),t("strong",[e._v(e._s(e.selectedCount))]),e._v(" 项自由训练课程吗？此操作不可恢复。 ")]):e._e()]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"cancel-btn",on:{click:e.cancelDelete}},[e._v("取消")]),t("button",{staticClass:"delete-btn",on:{click:e.deleteCourse}},[e._v("确认删除")])])]):e._e()])},Pe=[function(){var e=this,t=e._self._c;return t("label",[e._v("课程名称 "),t("span",{staticClass:"required"},[e._v("*")])])},function(){var e=this,t=e._self._c;return t("label",[e._v("班级 "),t("span",{staticClass:"required"},[e._v("*")])])},function(){var e=this,t=e._self._c;return t("label",[e._v("编组类型 "),t("span",{staticClass:"required"},[e._v("*")])])},function(){var e=this,t=e._self._c;return t("label",[e._v("开始时间 "),t("span",{staticClass:"required"},[e._v("*")])])},function(){var e=this,t=e._self._c;return t("label",[e._v("结束时间 "),t("span",{staticClass:"required"},[e._v("*")])])},function(){var e=this,t=e._self._c;return t("label",[e._v("学习时长(分钟) "),t("span",{staticClass:"required"},[e._v("*")])])}],Se={name:"FreeTraining",data(){return{searchKeyword:"",statusFilter:"",courses:[],filteredCourses:[],selectAll:!1,showAddModal:!1,showEditModal:!1,showViewModal:!1,showDeleteConfirm:!1,currentCourse:this.getEmptyCourse(),viewingCourse:{},courseToDelete:null,deleteMode:"single",availableCourses:[{id:"ft001",name:"装甲车辆驾驶训练",type:"freeTraining"},{id:"ft002",name:"战场通信训练",type:"freeTraining"},{id:"ft003",name:"战术协同训练",type:"freeTraining"},{id:"ft004",name:"战场急救技能",type:"freeTraining"},{id:"ft005",name:"VR战场环境适应训练",type:"freeTraining"}],classList:[{id:"class001",name:"新兵连一班"},{id:"class002",name:"新兵连二班"},{id:"class003",name:"特种作战班"},{id:"class004",name:"通信技术班"}],userRole:"",userId:"",groupId:""}},computed:{isFormValid(){return this.currentCourse.courseId&&this.currentCourse.classId&&this.currentCourse.groupType&&this.currentCourse.startTime&&this.currentCourse.endTime&&this.currentCourse.duration>0&&(this.currentCourse.unlimitedAttempts||this.currentCourse.maxAttempts>0)&&new Date(this.currentCourse.startTime)<new Date(this.currentCourse.endTime)},anySelected(){return this.courses.some((e=>e.selected))},selectedCount(){return this.courses.filter((e=>e.selected)).length}},created(){this.userRole=this.$store.state.user.role;const e=this.$store.state.user.userInfo;this.userId=e.id,this.groupId=e.groupId,this.loadCourses()},methods:{loadCourses(){this.courses=[{id:"ftc001",courseId:"ft001",classId:"class001",groupType:"individual",startTime:"2023-12-10T08:00",endTime:"2023-12-20T18:00",duration:60,maxAttempts:3,notes:"单人装甲车辆驾驶训练课程",selected:!1},{id:"ftc002",courseId:"ft002",classId:"class003",groupType:"single",startTime:"2023-12-15T09:00",endTime:"2023-12-25T17:00",duration:90,maxAttempts:-1,notes:"单编组战场通信训练",selected:!1},{id:"ftc003",courseId:"ft003",classId:"class004",groupType:"multiple",startTime:"2023-12-05T10:00",endTime:"2023-12-15T16:00",duration:120,maxAttempts:5,notes:"多编组战术协同训练",selected:!1}],this.filterCourses()},filterCourses(){let e=[...this.courses];if(this.searchKeyword){const t=this.searchKeyword.toLowerCase();e=e.filter((e=>{const s=this.getCourseName(e.courseId).toLowerCase();return s.includes(t)}))}this.statusFilter&&(e=e.filter((e=>this.getCourseStatus(e)===this.statusFilter))),this.filteredCourses=e},searchCourses(){this.filterCourses()},getCourseName(e){const t=this.availableCourses.find((t=>t.id===e));return t?t.name:"未知课程"},getClassName(e){const t=this.classList.find((t=>t.id===e));return t?t.name:"未知班级"},getGroupTypeDisplay(e){const t={individual:"单人",single:"单编组",multiple:"多编组"};return t[e]||"未知类型"},getCourseStatus(e){const t=new Date,s=new Date(e.startTime),a=new Date(e.endTime);return t<s?"upcoming":t>a?"completed":"ongoing"},getStatusText(e){const t={upcoming:"即将开始",ongoing:"进行中",completed:"已结束"};return t[e]||"未知状态"},formatDate(e){const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`},formatDateTime(e){const t=new Date(e);return`${this.formatDate(e)} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`},toggleSelectAll(){this.courses.forEach((e=>{e.selected=this.selectAll}))},viewCourse(e){this.viewingCourse={...e},this.showViewModal=!0},editCourse(e){this.currentCourse={...e,unlimitedAttempts:-1===e.maxAttempts},this.showEditModal=!0},confirmDeleteCourse(e){this.courseToDelete=e,this.deleteMode="single",this.showDeleteConfirm=!0},confirmDeleteSelected(){this.deleteMode="multiple",this.showDeleteConfirm=!0},deleteCourse(){"single"===this.deleteMode&&this.courseToDelete?this.courses=this.courses.filter((e=>e.id!==this.courseToDelete.id)):"multiple"===this.deleteMode&&(this.courses=this.courses.filter((e=>!e.selected))),this.filterCourses(),this.cancelDelete()},cancelDelete(){this.showDeleteConfirm=!1,this.courseToDelete=null},saveCourse(){const e={...this.currentCourse};if(e.unlimitedAttempts&&(e.maxAttempts=-1),delete e.unlimitedAttempts,this.showAddModal)e.id="ftc"+Date.now().toString().slice(-6),e.selected=!1,this.courses.push(e);else{const t=this.courses.findIndex((t=>t.id===e.id));-1!==t&&(this.courses[t]=e)}this.filterCourses(),this.cancelAddEdit()},cancelAddEdit(){this.showAddModal=!1,this.showEditModal=!1,this.currentCourse=this.getEmptyCourse()},handleClassChange(){},getEmptyCourse(){return{id:"",courseId:"",classId:"",groupType:"individual",startTime:"",endTime:"",duration:60,maxAttempts:3,unlimitedAttempts:!1,notes:""}},async launchSimulation(e){try{const t=this.$store.state.user.userInfo,s={courseId:e.id,studentId:t.id,groupId:t.groupId||null},a=await this.$api.post("/simulation/launch",s);a.success?this.$message.success("仿真程序启动成功"):this.$message.error("仿真程序启动失败")}catch(t){console.error("启动仿真程序失败:",t),this.$message.error("启动仿真程序失败，请稍后重试")}}}},Ne=Se,Ae=(0,n.A)(Ne,xe,Pe,!1,null,"89edf8fe",null),Fe=Ae.exports,De=function(){var e=this,t=e._self._c;return t("div",{staticClass:"training-simulator"},[t("div",{staticClass:"simulator-header"},[t("div",{staticClass:"back-button",on:{click:e.goBack}},[t("span",{staticClass:"back-icon"},[e._v("←")]),t("span",[e._v("返回")])]),t("div",{staticClass:"training-info"},[t("h2",[e._v(e._s(e.trainingName))]),t("div",{staticClass:"training-meta"},[t("span",{staticClass:"category-tag"},[e._v(e._s(e.categoryName))]),t("span",{staticClass:"time-counter"},[e._v("已训练时间: "+e._s(e.formatTime(e.elapsedTime)))])])]),t("div",{staticClass:"controls"},[t("button",{staticClass:"control-btn",on:{click:e.toggleFullscreen}},[t("span",{staticClass:"icon"},[e._v("⛶")]),e._v(" 全屏 ")]),t("button",{staticClass:"control-btn",on:{click:e.exitTraining}},[t("span",{staticClass:"icon"},[e._v("⏹")]),e._v(" 结束训练 ")])])]),t("div",{staticClass:"simulator-container"},[t("div",{staticClass:"simulator-frame"},[t("div",{staticClass:"placeholder-content"},[t("div",{staticClass:"simulator-placeholder"},[t("div",{staticClass:"placeholder-icon"},[e._v("🖥️")]),t("div",{staticClass:"placeholder-text"},[e._v("训练模拟器界面")]),t("div",{staticClass:"placeholder-loading"},[e._v(" 正在加载仿真环境..."+e._s(e.progress)+"% "),t("div",{staticClass:"progress-bar"},[t("div",{staticClass:"progress-fill",style:{width:e.progress+"%"}})])])])])])]),e.showExitConfirm?t("div",{staticClass:"modal-backdrop",on:{click:e.cancelExit}}):e._e(),e.showExitConfirm?t("div",{staticClass:"modal exit-modal"},[t("div",{staticClass:"modal-header"},[t("h3",[e._v("确认退出训练")]),t("button",{staticClass:"modal-close",on:{click:e.cancelExit}},[e._v("×")])]),t("div",{staticClass:"modal-body"},[t("p",[e._v("确定要退出当前训练吗？")]),t("p",{staticClass:"warning-text"},[e._v("退出后将保存当前进度 "+e._s(e.progress)+"%")])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"cancel-btn",on:{click:e.cancelExit}},[e._v("继续训练")]),t("button",{staticClass:"confirm-btn",on:{click:e.confirmExit}},[e._v("确认退出")])])]):e._e(),e.showCompletionModal?t("div",{staticClass:"modal-backdrop"}):e._e(),e.showCompletionModal?t("div",{staticClass:"modal completion-modal"},[e._m(0),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"completion-info"},[t("div",{staticClass:"score-display"},[t("div",{staticClass:"score"},[e._v(e._s(e.trainingScore))]),t("div",{staticClass:"score-label"},[e._v("得分")])]),t("div",{staticClass:"completion-details"},[t("div",{staticClass:"detail-item"},[t("div",{staticClass:"detail-label"},[e._v("训练名称:")]),t("div",{staticClass:"detail-value"},[e._v(e._s(e.trainingName))])]),t("div",{staticClass:"detail-item"},[t("div",{staticClass:"detail-label"},[e._v("训练时长:")]),t("div",{staticClass:"detail-value"},[e._v(e._s(e.formatTime(e.elapsedTime)))])]),t("div",{staticClass:"detail-item"},[t("div",{staticClass:"detail-label"},[e._v("完成时间:")]),t("div",{staticClass:"detail-value"},[e._v(e._s(e.getCurrentDateTime()))])])])]),e._m(1)]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"confirm-btn",on:{click:e.returnToList}},[e._v("返回列表")]),t("button",{staticClass:"restart-btn",on:{click:e.restartTraining}},[e._v("再次训练")])])]):e._e()])},Te=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal-header"},[t("h3",[e._v("训练完成")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"feedback-section"},[t("h4",[e._v("训练评价")]),t("div",{staticClass:"feedback-item"},[t("div",{staticClass:"feedback-icon good"},[e._v("✓")]),t("div",{staticClass:"feedback-content"},[t("div",{staticClass:"feedback-title"},[e._v("操作熟练度良好")]),t("div",{staticClass:"feedback-description"},[e._v("基本操作流程掌握准确，动作协调性良好")])])]),t("div",{staticClass:"feedback-item"},[t("div",{staticClass:"feedback-icon neutral"},[e._v("!")]),t("div",{staticClass:"feedback-content"},[t("div",{staticClass:"feedback-title"},[e._v("紧急情况处理需加强")]),t("div",{staticClass:"feedback-description"},[e._v("在应对突发状况时反应速度有待提高")])])])])}],Re={name:"TrainingSimulator",data(){return{trainingId:null,trainingName:"训练模拟",categoryName:"装备操作",elapsedTime:0,progress:0,timerInterval:null,progressInterval:null,showExitConfirm:!1,showCompletionModal:!1,trainingScore:86}},created(){this.initTrainingParameters(),this.startTimer(),this.simulateProgress()},beforeDestroy(){this.clearIntervals()},methods:{initTrainingParameters(){const{trainingId:e,trainingName:t,categoryId:s,categoryName:a}=this.$route.query;this.trainingId=e||null,this.trainingName=t||"未指定训练",a&&(this.categoryName=a)},startTimer(){this.timerInterval=setInterval((()=>{this.elapsedTime+=1}),1e3)},simulateProgress(){this.progressInterval=setInterval((()=>{this.progress<100?(this.progress+=Math.floor(3*Math.random())+1,this.progress>100&&(this.progress=100)):(clearInterval(this.progressInterval),setTimeout((()=>{this.showCompletionModal=!0}),1e3))}),1500)},clearIntervals(){this.timerInterval&&clearInterval(this.timerInterval),this.progressInterval&&clearInterval(this.progressInterval)},formatTime(e){const t=Math.floor(e/60),s=e%60;return`${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`},getCurrentDateTime(){const e=new Date;return e.toLocaleString("zh-CN")},goBack(){this.exitTraining()},toggleFullscreen(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()},exitTraining(){this.showExitConfirm=!0},cancelExit(){this.showExitConfirm=!1},confirmExit(){this.clearIntervals(),this.$router.push("/free-training")},returnToList(){this.clearIntervals(),this.$router.push("/free-training")},restartTraining(){this.clearIntervals(),this.progress=0,this.elapsedTime=0,this.showCompletionModal=!1,this.startTimer(),this.simulateProgress()}}},Ee=Re,Ue=(0,n.A)(Ee,De,Te,!1,null,"3481d92b",null),$e=Ue.exports,Le=function(){var e=this,t=e._self._c;return t("div",{staticClass:"score-query-container"},[t("h1",{staticClass:"page-title"},[e._v("成绩查询")]),t("div",{staticClass:"function-area"},[t("div",{staticClass:"search-area"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchName,expression:"searchName"}],attrs:{type:"text",placeholder:"输入人员姓名搜索"},domProps:{value:e.searchName},on:{input:[function(t){t.target.composing||(e.searchName=t.target.value)},e.filterScores]}}),t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchCourse,expression:"searchCourse"}],attrs:{type:"text",placeholder:"输入课程名称搜索"},domProps:{value:e.searchCourse},on:{input:[function(t){t.target.composing||(e.searchCourse=t.target.value)},e.filterScores]}}),t("select",{directives:[{name:"model",rawName:"v-model",value:e.classFilter,expression:"classFilter"}],on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.classFilter=t.target.multiple?s:s[0]},e.filterScores]}},[t("option",{attrs:{value:""}},[e._v("所有班级")]),e._l(e.classList,(function(s){return t("option",{key:s.id,domProps:{value:s.id}},[e._v(" "+e._s(s.name)+" ")])}))],2),t("select",{directives:[{name:"model",rawName:"v-model",value:e.timeFilter,expression:"timeFilter"}],on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.timeFilter=t.target.multiple?s:s[0]},e.filterScores]}},[t("option",{attrs:{value:""}},[e._v("所有时间")]),t("option",{attrs:{value:"today"}},[e._v("今天")]),t("option",{attrs:{value:"week"}},[e._v("本周")]),t("option",{attrs:{value:"month"}},[e._v("本月")])])])]),t("div",{staticClass:"score-list"},[t("table",[t("thead",[t("tr",[t("th",{on:{click:function(t){return e.sortBy("courseName")}}},[e._v(" 课程名称 "),"courseName"===e.sortField?t("span",{staticClass:"sort-icon"},[e._v(" "+e._s("asc"===e.sortOrder?"↑":"↓")+" ")]):e._e()]),t("th",{on:{click:function(t){return e.sortBy("time")}}},[e._v(" 时间 "),"time"===e.sortField?t("span",{staticClass:"sort-icon"},[e._v(" "+e._s("asc"===e.sortOrder?"↑":"↓")+" ")]):e._e()]),t("th",[e._v("班级")]),t("th",[e._v("编组")]),t("th",[e._v("姓名")]),t("th",[e._v("任务完成情况")]),t("th",[e._v("用时(分钟)")]),t("th",{on:{click:function(t){return e.sortBy("score")}}},[e._v(" 得分 "),"score"===e.sortField?t("span",{staticClass:"sort-icon"},[e._v(" "+e._s("asc"===e.sortOrder?"↑":"↓")+" ")]):e._e()]),t("th",[e._v("操作")])])]),t("tbody",[e._l(e.filteredScores,(function(s){return t("tr",{key:s.id},[t("td",[e._v(e._s(s.courseName))]),t("td",[e._v(e._s(e.formatDateTime(s.time)))]),t("td",[e._v(e._s(s.className))]),t("td",[e._v(e._s(s.groupName||"个人"))]),t("td",[e._v(e._s(s.studentName))]),t("td",[t("span",{staticClass:"status-tag",class:e.getTaskStatus(s)},[e._v(" "+e._s(e.getTaskStatusText(s))+" ")])]),t("td",[e._v(e._s(s.duration))]),t("td",[e._v(e._s(e.showScore(s)))]),t("td",{staticClass:"actions"},[t("button",{staticClass:"detail-btn",on:{click:function(t){return e.viewScoreDetail(s)}}},[e._v("查看详情")]),e.canReview&&"pending"===e.getTaskStatus(s)?t("button",{staticClass:"review-btn",on:{click:function(t){return e.goToReview(s)}}},[e._v(" 点评 ")]):e._e()])])})),0===e.filteredScores.length?t("tr",[t("td",{staticClass:"no-data",attrs:{colspan:"10"}},[e._v("暂无成绩数据")])]):e._e()],2)])]),e.showDetailModal?t("div",{staticClass:"modal-backdrop",on:{click:e.closeDetailModal}}):e._e(),e.showDetailModal?t("div",{staticClass:"modal detail-modal"},[t("div",{staticClass:"modal-header"},[t("h3",[e._v(e._s(e.isReviewMode?"教员点评":"成绩详情"))]),t("button",{staticClass:"modal-close",on:{click:e.closeDetailModal}},[e._v("×")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"detail-header"},[t("div",{staticClass:"detail-info"},[t("h4",[e._v(e._s(e.currentDetail.courseName))]),t("div",{staticClass:"detail-meta"},[t("span",[e._v(e._s(e.currentDetail.studentName))]),t("span",[e._v(e._s(e.currentDetail.className))]),t("span",[e._v(e._s(e.currentDetail.groupName||"个人"))]),t("span",[e._v("课程角色："+e._s(e.currentDetail.courseRole||"本控操作员"))]),t("span",[e._v(e._s(e.formatDateTime(e.currentDetail.time)))])])]),t("div",{staticClass:"detail-score"},[e.isReviewMode?t("div",{staticClass:"score-input"},[t("label",[e._v("总分：")]),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.currentDetail.score,expression:"currentDetail.score",modifiers:{number:!0}}],staticClass:"score-number-input",attrs:{type:"number",min:"0",max:"100"},domProps:{value:e.currentDetail.score},on:{input:[function(t){t.target.composing||e.$set(e.currentDetail,"score",e._n(t.target.value))},e.updateScore],blur:function(t){return e.$forceUpdate()}}})]):t("div",[t("div",{staticClass:"score-circle"},[t("span",[e._v(e._s(e.currentDetail.score||"-"))])]),t("div",[e._v("总分")])])])]),t("div",{staticClass:"detail-section"},[t("h4",[e._v("任务节点")]),t("div",{staticClass:"task-nodes"},e._l(e.currentDetail.taskNodes,(function(s,a){return t("div",{key:a,staticClass:"task-node"},[t("div",{staticClass:"node-header",on:{click:function(t){return e.toggleNode(a)}}},[t("div",{staticClass:"node-number"},[e._v(e._s(s.order))]),t("div",{staticClass:"node-title"},[e._v(e._s(s.name))]),t("div",{staticClass:"node-time"},[e._v(e._s(e.formatTime(s.timestamp)))]),t("div",{staticClass:"node-status",class:{completed:s.completed}},[e._v(" "+e._s(s.completed?"已完成":"未完成")+" ")]),t("div",{staticClass:"node-toggle"},[e._v(e._s(s.expanded?"收起":"展开"))])]),s.screenshot&&s.expanded?t("div",{staticClass:"node-screenshot"},[t("img",{attrs:{src:s.screenshot,alt:s.name}})]):e._e()])})),0)]),t("div",{staticClass:"detail-section"},[t("h4",[e._v("教师点评")]),t("div",{staticClass:"review-content"},[e.isReviewMode?t("div",{staticClass:"review-form"},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.currentDetail.review,expression:"currentDetail.review"}],staticClass:"review-textarea",attrs:{placeholder:"请输入点评内容...",rows:"4"},domProps:{value:e.currentDetail.review},on:{input:[function(t){t.target.composing||e.$set(e.currentDetail,"review",t.target.value)},e.updateReview]}}),e.reviewError?t("div",{staticClass:"form-error"},[e._v(e._s(e.reviewError))]):e._e()]):t("div",[e.currentDetail.hasReview?t("div",{staticClass:"review-text"},[e._v(" "+e._s(e.currentDetail.review)+" "),t("div",{staticClass:"review-meta"},[t("span",[e._v("点评教师："+e._s(e.currentDetail.reviewerName))]),t("span",[e._v("点评时间："+e._s(e.formatDateTime(e.currentDetail.reviewTime)))])])]):e.canReview?t("div",{staticClass:"no-review"},[t("p",[e._v("该成绩尚未点评")]),t("button",{staticClass:"review-btn",on:{click:e.startReview}},[e._v("进行点评")])]):e._e()])])])]),t("div",{staticClass:"modal-footer"},[e.isReviewMode?t("div",[t("button",{staticClass:"cancel-btn",on:{click:e.closeDetailModal}},[e._v("取消")]),t("button",{staticClass:"submit-btn",attrs:{disabled:!e.isFormValid()},on:{click:e.submitReview}},[e._v("提交点评")])]):t("div",[t("button",{staticClass:"confirm-btn",on:{click:e.closeDetailModal}},[e._v("关闭")]),e.canReview&&!e.currentDetail.hasReview?t("button",{staticClass:"review-btn",on:{click:e.startReview}},[e._v("进行点评")]):e._e()])])]):e._e()])},Ge=[],qe={name:"ScoreQuery",data(){return{searchName:"",searchCourse:"",classFilter:"",timeFilter:"",sortField:"time",sortOrder:"desc",scores:[],filteredScores:[],showDetailModal:!1,currentDetail:{taskNodes:[]},classList:[{id:"class001",name:"新兵连一班"},{id:"class002",name:"新兵连二班"},{id:"class003",name:"特种作战班"},{id:"class004",name:"通信技术班"}],isReviewMode:!1,reviewForm:{score:null,review:""},reviewRules:{score:[{required:!0,message:"请输入分数",trigger:"blur"},{type:"number",min:0,max:100,message:"分数必须在0-100之间",trigger:"blur"}],review:[{required:!0,message:"请输入点评内容",trigger:"blur"},{min:10,max:500,message:"点评内容长度应在10-500字之间",trigger:"blur"}]},reviewError:""}},computed:{canReview(){return"admin"===this.userInfo.role||"teacher"===this.userInfo.role}},created(){this.loadScores()},methods:{loadScores(){const e=[{id:"score001",courseId:"ft001",courseName:"装甲车辆驾驶训练",classId:"class001",className:"新兵连一班",groupId:"",groupName:"",studentId:"student001",studentName:"张三",time:"2023-12-10T14:30:00",completionRate:100,duration:45,score:92,hasReview:!0,review:"操作熟练，反应迅速，但在紧急情况下的处理还需加强。",reviewerName:"李教官",reviewTime:"2023-12-10T16:20:00",taskNodes:[{order:1,name:"开机",timestamp:"2023-12-10T14:30:10",completed:!0,screenshot:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},{order:2,name:"切换工作模式",timestamp:"2023-12-10T14:32:45",completed:!0,screenshot:"https://images.unsplash.com/photo-1464983953574-0892a716854b?auto=format&fit=crop&w=400&q=80"},{order:3,name:"生成高压",timestamp:"2023-12-10T14:35:20",completed:!0,screenshot:"https://images.unsplash.com/photo-1519125323398-675f0ddb6308?auto=format&fit=crop&w=400&q=80"},{order:4,name:"模拟行驶",timestamp:"2023-12-10T14:40:15",completed:!0,screenshot:"https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?auto=format&fit=crop&w=400&q=80"}]},{id:"score002",courseId:"ft002",courseName:"战场通信训练",classId:"class003",className:"特种作战班",groupId:"group001",groupName:"通信小组A",studentId:"student002",studentName:"李四",time:"2023-12-12T10:15:00",completionRate:85,duration:60,score:78,hasReview:!1,review:"",reviewerName:"",reviewTime:"",taskNodes:[{order:1,name:"设备检查",timestamp:"2023-12-12T10:15:30",completed:!0,screenshot:"https://images.unsplash.com/photo-1517694712202-14dd9538aa97?auto=format&fit=crop&w=400&q=80"},{order:2,name:"建立通信链路",timestamp:"2023-12-12T10:20:45",completed:!0,screenshot:"https://images.unsplash.com/photo-1465101046530-73398c7f28ca?auto=format&fit=crop&w=400&q=80"},{order:3,name:"信息加密传输",timestamp:"2023-12-12T10:30:20",completed:!0,screenshot:"https://images.unsplash.com/photo-1519125323398-675f0ddb6308?auto=format&fit=crop&w=400&q=80"},{order:4,name:"应对干扰处理",timestamp:"2023-12-12T10:45:15",completed:!1,screenshot:"https://images.unsplash.com/photo-1465101178521-c1a9136a3c5c?auto=format&fit=crop&w=400&q=80"}]},{id:"score003",courseId:"ft003",courseName:"战术协同训练",classId:"class004",className:"通信技术班",groupId:"group002",groupName:"战术协同组B",studentId:"student003",studentName:"王五",time:"2023-12-08T09:00:00",completionRate:95,duration:90,score:88,hasReview:!0,review:"团队协作能力强，指挥决策明确，但战术配合的时机把握还需提高。",reviewerName:"张教官",reviewTime:"2023-12-08T11:30:00",taskNodes:[{order:1,name:"任务部署",timestamp:"2023-12-08T09:00:30",completed:!0,screenshot:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},{order:2,name:"战术分析",timestamp:"2023-12-08T09:15:45",completed:!0,screenshot:"https://images.unsplash.com/photo-1464983953574-0892a716854b?auto=format&fit=crop&w=400&q=80"},{order:3,name:"协同行动",timestamp:"2023-12-08T09:30:20",completed:!0,screenshot:"https://images.unsplash.com/photo-1519125323398-675f0ddb6308?auto=format&fit=crop&w=400&q=80"},{order:4,name:"任务总结",timestamp:"2023-12-08T10:00:15",completed:!0,screenshot:"https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?auto=format&fit=crop&w=400&q=80"}]}];"admin"===this.userInfo.userType?this.scores=e:"teacher"===this.userInfo.userType?this.scores=e.filter((e=>["class001","class003"].includes(e.classId))):this.scores=e.filter((e=>"student001"===e.studentId)),this.filterScores()},filterScores(){let e=[...this.scores];if(this.searchName){const t=this.searchName.toLowerCase();e=e.filter((e=>e.studentName.toLowerCase().includes(t)))}if(this.searchCourse){const t=this.searchCourse.toLowerCase();e=e.filter((e=>e.courseName.toLowerCase().includes(t)))}if(this.classFilter&&(e=e.filter((e=>e.classId===this.classFilter))),this.timeFilter){const t=new Date,s=new Date(t.getFullYear(),t.getMonth(),t.getDate()),a=new Date(s);a.setDate(s.getDate()-s.getDay());const r=new Date(t.getFullYear(),t.getMonth(),1);e=e.filter((e=>{const t=new Date(e.time);return"today"===this.timeFilter?t>=s:"week"===this.timeFilter?t>=a:"month"!==this.timeFilter||t>=r}))}this.applySorting(e)},sortBy(e){this.sortField===e?this.sortOrder="asc"===this.sortOrder?"desc":"asc":(this.sortField=e,this.sortOrder="asc"),this.filterScores()},applySorting(e){e.sort(((e,t)=>{let s=0;return"courseName"===this.sortField?s=e.courseName.localeCompare(t.courseName):"time"===this.sortField?s=new Date(e.time)-new Date(t.time):"score"===this.sortField&&(s=e.score-t.score),"asc"===this.sortOrder?s:-s})),this.filteredScores=e},viewScoreDetail(e){this.currentDetail={...e},this.currentDetail.taskNodes=this.currentDetail.taskNodes.map((e=>({...e,expanded:!1}))),this.canReview&&!e.hasReview&&(this.reviewForm.score=null,this.reviewForm.review="",this.$refs.reviewForm&&this.$refs.reviewForm.resetFields()),this.showDetailModal=!0},goToReview(e){this.currentDetail={...e},this.currentDetail.taskNodes=this.currentDetail.taskNodes.map((e=>({...e,expanded:!1}))),this.currentDetail.score=this.currentDetail.score||0,this.currentDetail.review=this.currentDetail.review||"",this.showDetailModal=!0,this.isReviewMode=!0},async submitReview(){try{await this.$refs.reviewForm.validate(),this.currentDetail={...this.currentDetail,hasReview:!0,score:this.reviewForm.score,review:this.reviewForm.review,reviewerName:this.userInfo.name,reviewTime:(new Date).toISOString()};const e=this.scores.findIndex((e=>e.id===this.currentDetail.id));-1!==e&&(this.scores[e]={...this.currentDetail},this.filterScores()),this.reviewForm.score=null,this.reviewForm.review="",this.$refs.reviewForm.resetFields(),this.$message.success("点评提交成功")}catch(e){console.error("点评提交失败:",e),this.$message.error("点评提交失败，请重试")}},updateScore(e){const t=parseInt(e.target.value);isNaN(t)||(this.currentDetail.score=Math.min(100,Math.max(0,t)))},getTaskStatus(e){return!e.taskNodes||e.taskNodes.some((e=>!e.completed))?"not-finished":e.hasReview?"reviewed":"pending"},getTaskStatusText(e){const t=this.getTaskStatus(e);return"not-finished"===t?"未完成":"pending"===t?"待点评":"reviewed"===t?"已点评":""},showScore(e){const t=this.getTaskStatus(e);return"reviewed"!==t?"-":e.score},formatDateTime(e){const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`},formatTime(e){const t=new Date(e);return`${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`},toggleNode(e){this.$set(this.currentDetail.taskNodes[e],"expanded",!this.currentDetail.taskNodes[e].expanded)},closeDetailModal(){this.showDetailModal=!1,this.isReviewMode=!1,this.reviewError=""},startReview(){this.isReviewMode=!0,this.currentDetail.score||(this.currentDetail.score=0),this.currentDetail.review||(this.currentDetail.review="")},updateReview(e){this.currentDetail.review=e.target.value},isFormValid(){return null!==this.reviewForm.score&&""!==this.reviewForm.review.trim()}}},Ke=qe,ze=(0,n.A)(Ke,Le,Ge,!1,null,"49f7789c",null),Oe=ze.exports,Ve=function(){var e=this,t=e._self._c;return t("div",{staticClass:"statistics-analysis-container"},[t("h1",{staticClass:"page-title"},[e._v("统计分析")]),t("div",{staticClass:"top-bar"},[t("div",{staticClass:"year-select"},[t("label",[e._v("年份：")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedYear,expression:"selectedYear"}],on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.selectedYear=t.target.multiple?s:s[0]},e.onYearChange]}},e._l(e.yearList,(function(s){return t("option",{key:s,domProps:{value:s}},[e._v(e._s(s))])})),0)])]),t("div",{staticClass:"charts-grid"},[t("div",{staticClass:"chart-card"},[t("div",{staticClass:"chart-header"},[t("span",[e._v("课程成绩分布")]),t("div",{staticClass:"chart-filters"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedCourse,expression:"selectedCourse"}],on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.selectedCourse=t.target.multiple?s:s[0]},e.updateCourseScoreDist]}},e._l(e.courseList,(function(s){return t("option",{key:s.id,domProps:{value:s.id}},[e._v(e._s(s.name))])})),0),t("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedCourseQuarter,expression:"selectedCourseQuarter"}],on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.selectedCourseQuarter=t.target.multiple?s:s[0]},e.updateCourseScoreDist]}},e._l(e.quarterList,(function(s){return t("option",{key:s.value,domProps:{value:s.value}},[e._v(e._s(s.label))])})),0)])]),t("div",{staticClass:"chart-body"},[t("div",{ref:"courseScoreDistChart",staticClass:"echart-box"})])]),t("div",{staticClass:"chart-card"},[t("div",{staticClass:"chart-header"},[t("span",[e._v("学员成绩分布")]),t("div",{staticClass:"chart-filters"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedStudent,expression:"selectedStudent"}],on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.selectedStudent=t.target.multiple?s:s[0]},e.updateStudentScoreDist]}},e._l(e.studentList,(function(s){return t("option",{key:s.id,domProps:{value:s.id}},[e._v(e._s(s.name))])})),0),t("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedStudentQuarter,expression:"selectedStudentQuarter"}],on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.selectedStudentQuarter=t.target.multiple?s:s[0]},e.updateStudentScoreDist]}},e._l(e.quarterList,(function(s){return t("option",{key:s.value,domProps:{value:s.value}},[e._v(e._s(s.label))])})),0)])]),t("div",{staticClass:"chart-body"},[t("div",{ref:"studentScoreDistChart",staticClass:"echart-box"})])]),t("div",{staticClass:"chart-card"},[t("div",{staticClass:"chart-header"},[t("span",[e._v("课程通过率")]),t("div",{staticClass:"chart-filters"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedPassCourse,expression:"selectedPassCourse"}],on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.selectedPassCourse=t.target.multiple?s:s[0]},e.updatePassRate]}},e._l(e.courseList,(function(s){return t("option",{key:s.id,domProps:{value:s.id}},[e._v(e._s(s.name))])})),0),t("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedPassQuarter,expression:"selectedPassQuarter"}],on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.selectedPassQuarter=t.target.multiple?s:s[0]},e.updatePassRate]}},e._l(e.quarterList,(function(s){return t("option",{key:s.value,domProps:{value:s.value}},[e._v(e._s(s.label))])})),0),t("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedPassClass,expression:"selectedPassClass"}],on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.selectedPassClass=t.target.multiple?s:s[0]},e.updatePassRate]}},[t("option",{attrs:{value:""}},[e._v("全部班级")]),e._l(e.classList,(function(s){return t("option",{key:s.id,domProps:{value:s.id}},[e._v(e._s(s.name))])}))],2),t("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedPassStudent,expression:"selectedPassStudent"}],on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.selectedPassStudent=t.target.multiple?s:s[0]},e.updatePassRate]}},[t("option",{attrs:{value:""}},[e._v("全部学员")]),e._l(e.studentList,(function(s){return t("option",{key:s.id,domProps:{value:s.id}},[e._v(e._s(s.name))])}))],2)])]),t("div",{staticClass:"chart-body"},[t("div",{ref:"passRateChart",staticClass:"echart-box"})])]),t("div",{staticClass:"chart-card"},[t("div",{staticClass:"chart-header"},[t("span",[e._v("班级/班组排行榜")]),t("div",{staticClass:"chart-filters"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.rankType,expression:"rankType"}],on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.rankType=t.target.multiple?s:s[0]},e.updateRankChart]}},[t("option",{attrs:{value:"class"}},[e._v("班级")]),t("option",{attrs:{value:"group"}},[e._v("班组")])]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.rankMetric,expression:"rankMetric"}],on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.rankMetric=t.target.multiple?s:s[0]},e.updateRankChart]}},[t("option",{attrs:{value:"avgScore"}},[e._v("平均分")]),t("option",{attrs:{value:"passRate"}},[e._v("通过率")])]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedRankQuarter,expression:"selectedRankQuarter"}],on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.selectedRankQuarter=t.target.multiple?s:s[0]},e.updateRankChart]}},e._l(e.quarterList,(function(s){return t("option",{key:s.value,domProps:{value:s.value}},[e._v(e._s(s.label))])})),0)])]),t("div",{staticClass:"chart-body"},[t("div",{ref:"rankChart",staticClass:"echart-box"})])])])])},Qe=[],Be=s(7609),je={name:"StatisticsAnalysis",data(){const e=new Date,t=e.getFullYear();return{yearList:[t-2,t-1,t],selectedYear:t,quarterList:[{value:"Q1",label:"第一季度"},{value:"Q2",label:"第二季度"},{value:"Q3",label:"第三季度"},{value:"Q4",label:"第四季度"}],courseList:[{id:"ft001",name:"装甲车辆驾驶训练"},{id:"ft002",name:"战场通信训练"},{id:"ft003",name:"战术协同训练"},{id:"ft004",name:"战场急救技能"},{id:"ft005",name:"VR战场环境适应训练"}],selectedCourse:"ft001",selectedCourseQuarter:"Q1",studentList:[{id:"student001",name:"张三"},{id:"student002",name:"李四"},{id:"student003",name:"王五"}],selectedStudent:"student001",selectedStudentQuarter:"Q1",classList:[{id:"class001",name:"新兵连一班"},{id:"class002",name:"新兵连二班"},{id:"class003",name:"特种作战班"},{id:"class004",name:"通信技术班"}],selectedPassCourse:"ft001",selectedPassQuarter:"Q1",selectedPassClass:"",selectedPassStudent:"",rankType:"class",rankMetric:"avgScore",selectedRankQuarter:"Q1",courseScoreDistChart:null,studentScoreDistChart:null,passRateChart:null,rankChart:null}},mounted(){this.initCharts()},methods:{onYearChange(){this.updateAllCharts()},initCharts(){this.courseScoreDistChart=Be.init(this.$refs.courseScoreDistChart),this.studentScoreDistChart=Be.init(this.$refs.studentScoreDistChart),this.passRateChart=Be.init(this.$refs.passRateChart),this.rankChart=Be.init(this.$refs.rankChart),this.updateAllCharts()},updateAllCharts(){this.updateCourseScoreDist(),this.updateStudentScoreDist(),this.updatePassRate(),this.updateRankChart()},updateCourseScoreDist(){const e=["<60","60-70","70-80","80-90","90-100"],t=[5,12,18,22,8];this.courseScoreDistChart.setOption({title:{text:""},tooltip:{},xAxis:{data:e},yAxis:{},series:[{name:"人数",type:"bar",data:t,itemStyle:{color:"#1890ff"}}]})},updateStudentScoreDist(){const e=this.courseList.map((e=>e.name)),t=[78,85,90,82,88];this.studentScoreDistChart.setOption({title:{text:""},tooltip:{},xAxis:{data:e},yAxis:{},series:[{name:"平均分",type:"bar",data:t,itemStyle:{color:"#52c41a"}}]})},updatePassRate(){const e=38,t=12;this.passRateChart.setOption({title:{text:""},tooltip:{trigger:"item"},series:[{name:"通过率",type:"pie",radius:["60%","80%"],avoidLabelOverlap:!1,label:{show:!0,position:"center",formatter:()=>`通过率\n${Math.round(e/(e+t)*100)}%`,fontSize:22,color:"#1890ff",fontWeight:"bold"},data:[{value:e,name:"通过",itemStyle:{color:"#52c41a"}},{value:t,name:"未通过",itemStyle:{color:"#ff4d4f"}}]}]})},updateRankChart(){const e="class"===this.rankType?this.classList.map((e=>e.name)):["A组","B组","C组","D组","E组"],t="avgScore"===this.rankMetric?[88,85,82,80,78]:[.95,.92,.9,.88,.85];this.rankChart.setOption({title:{text:""},tooltip:{},xAxis:{data:e},yAxis:{axisLabel:"avgScore"===this.rankMetric?void 0:{formatter:e=>(100*e).toFixed(0)+"%"}},series:[{name:"avgScore"===this.rankMetric?"平均分":"通过率",type:"bar",data:t,itemStyle:{color:"#faad14"},label:{show:!0,position:"top",formatter:e=>"avgScore"===this.rankMetric?e.value:(100*e.value).toFixed(0)+"%"}}]})}}},He=je,Ye=(0,n.A)(He,Ve,Qe,!1,null,"0c2a6760",null),We=Ye.exports;a["default"].use(u.Ay);const Xe=[{path:"/login",name:"Login",component:O},{path:"/",component:$,redirect:"/analysis",meta:{title:"首页"},children:[{path:"/analysis",name:"StatisticsAnalysis",component:We,meta:{requiresAuth:!0,title:"统计分析"}},{path:"/roles",name:"RoleManagement",component:()=>Promise.resolve().then(s.bind(s,14809)),meta:{requiresAuth:!0,title:"角色管理"}},{path:"/users",name:"UserManagement",component:Y,meta:{requiresAuth:!0,roles:["admin","teacher","student"],title:"用户管理"}},{path:"/classes",name:"ClassManagement",component:te,meta:{requiresAuth:!0,roles:["admin","teacher"],title:"班级管理"}},{path:"/groups",name:"GroupManagement",component:le,meta:{requiresAuth:!0,roles:["admin","teacher"],title:"编组管理"}},{path:"/course-management",name:"CourseManagement",component:pe,meta:{requiresAuth:!0,roles:["admin","teacher"],title:"教学课程"}},{path:"/materials",name:"MaterialsManagement",component:Ce,meta:{requiresAuth:!0,roles:["admin","teacher","student"],title:"教学资料"}},{path:"/guided-teaching",name:"GuidedTeaching",component:Ie,meta:{requiresAuth:!0,roles:["admin","teacher","student"],title:"引导教学"}},{path:"/free-training",name:"FreeTraining",component:Fe,meta:{requiresAuth:!0,roles:["admin","teacher","student"],title:"自由训练"}},{path:"/score-query",name:"ScoreQuery",component:Oe,meta:{requiresAuth:!0,roles:["admin","teacher","student"],title:"成绩查询"}},{path:"/teacher-review",name:"TeacherReview",component:()=>s.e(697).then(s.bind(s,88697)),meta:{requiresAuth:!0,roles:["admin","teacher"],title:"教师点评"}},{path:"/profile",name:"Profile",component:()=>s.e(927).then(s.bind(s,44308)),meta:{requiresAuth:!0,title:"个人中心"}}]},{path:"/training-simulator",name:"TrainingSimulator",component:$e,meta:{requiresAuth:!0,roles:["student"],title:"仿真练习"}}],Je=new u.Ay({routes:Xe});Je.beforeEach((async(e,t,s)=>{try{console.log("==== 路由导航开始 ===="),console.log("从:",t.path),console.log("到:",e.path);const r="true"===localStorage.getItem("isAuthenticated"),i=localStorage.getItem("userRole");if(console.log("认证状态:",{isAuthenticated:r,userRole:i}),"/login"===e.path)return void(r?s("/analysis"):s());if(!r)return void s("/login");if(i&&(!I.state.permission||!I.state.permission.userRole))try{await I.dispatch("permission/initializePermissions",{role:i,userId:I.state.user.userInfo?.id})}catch(a){return console.error("初始化权限失败:",a),void s("/login")}if(e.meta.requiresAuth&&e.meta.roles&&!e.meta.roles.includes(i))return console.log("无权限访问该页面"),void s("/analysis");s()}catch(a){console.error("路由导航错误:",a),localStorage.removeItem("isAuthenticated"),localStorage.removeItem("userRole"),s("/login")}})),Je.onError((e=>{console.error("路由错误:",e)}));var Ze=Je;function et(e,t){const{value:s}=t;if(!s)return;const[a,r]=s.split(":"),i=I.getters["permission/hasPermission"](a,r);i||e.parentNode&&e.parentNode.removeChild(e)}var tt={inserted(e,t){et(e,t)},update(e,t){et(e,t)}},st=s(31052),at=s.n(st);a["default"].use(at()),a["default"].prototype.$api=v,a["default"].config.productionTip=!1,a["default"].config.errorHandler=(e,t,s)=>{console.error("Vue错误:",e),console.info("错误组件:",t),console.info("错误信息:",s)},a["default"].directive("permission",tt),new a["default"]({router:Ze,store:I,render:e=>e(c)}).$mount("#app")}},t={};function s(a){var r=t[a];if(void 0!==r)return r.exports;var i=t[a]={id:a,loaded:!1,exports:{}};return e[a].call(i.exports,i,i.exports,s),i.loaded=!0,i.exports}s.m=e,function(){s.amdO={}}(),function(){var e=[];s.O=function(t,a,r,i){if(!a){var o=1/0;for(c=0;c<e.length;c++){a=e[c][0],r=e[c][1],i=e[c][2];for(var l=!0,n=0;n<a.length;n++)(!1&i||o>=i)&&Object.keys(s.O).every((function(e){return s.O[e](a[n])}))?a.splice(n--,1):(l=!1,i<o&&(o=i));if(l){e.splice(c--,1);var d=r();void 0!==d&&(t=d)}}return t}i=i||0;for(var c=e.length;c>0&&e[c-1][2]>i;c--)e[c]=e[c-1];e[c]=[a,r,i]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){s.f={},s.e=function(e){return Promise.all(Object.keys(s.f).reduce((function(t,a){return s.f[a](e,t),t}),[]))}}(),function(){s.u=function(e){return"static/js/"+e+"."+{697:"3d5c26cb",927:"3076552b"}[e]+".js"}}(),function(){s.miniCssF=function(e){return"static/css/"+e+"."+{697:"f5b9ce14",927:"cd9ea123"}[e]+".css"}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="military-simulation-training-system:";s.l=function(a,r,i,o){if(e[a])e[a].push(r);else{var l,n;if(void 0!==i)for(var d=document.getElementsByTagName("script"),c=0;c<d.length;c++){var u=d[c];if(u.getAttribute("src")==a||u.getAttribute("data-webpack")==t+i){l=u;break}}l||(n=!0,l=document.createElement("script"),l.charset="utf-8",l.timeout=120,s.nc&&l.setAttribute("nonce",s.nc),l.setAttribute("data-webpack",t+i),l.src=a),e[a]=[r];var m=function(t,s){l.onerror=l.onload=null,clearTimeout(p);var r=e[a];if(delete e[a],l.parentNode&&l.parentNode.removeChild(l),r&&r.forEach((function(e){return e(s)})),t)return t(s)},p=setTimeout(m.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=m.bind(null,l.onerror),l.onload=m.bind(null,l.onload),n&&document.head.appendChild(l)}}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){s.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){s.p=""}(),function(){if("undefined"!==typeof document){var e=function(e,t,a,r,i){var o=document.createElement("link");o.rel="stylesheet",o.type="text/css",s.nc&&(o.nonce=s.nc);var l=function(s){if(o.onerror=o.onload=null,"load"===s.type)r();else{var a=s&&s.type,l=s&&s.target&&s.target.href||t,n=new Error("Loading CSS chunk "+e+" failed.\n("+a+": "+l+")");n.name="ChunkLoadError",n.code="CSS_CHUNK_LOAD_FAILED",n.type=a,n.request=l,o.parentNode&&o.parentNode.removeChild(o),i(n)}};return o.onerror=o.onload=l,o.href=t,a?a.parentNode.insertBefore(o,a.nextSibling):document.head.appendChild(o),o},t=function(e,t){for(var s=document.getElementsByTagName("link"),a=0;a<s.length;a++){var r=s[a],i=r.getAttribute("data-href")||r.getAttribute("href");if("stylesheet"===r.rel&&(i===e||i===t))return r}var o=document.getElementsByTagName("style");for(a=0;a<o.length;a++){r=o[a],i=r.getAttribute("data-href");if(i===e||i===t)return r}},a=function(a){return new Promise((function(r,i){var o=s.miniCssF(a),l=s.p+o;if(t(o,l))return r();e(a,l,null,r,i)}))},r={524:0};s.f.miniCss=function(e,t){var s={697:1,927:1};r[e]?t.push(r[e]):0!==r[e]&&s[e]&&t.push(r[e]=a(e).then((function(){r[e]=0}),(function(t){throw delete r[e],t})))}}}(),function(){var e={524:0};s.f.j=function(t,a){var r=s.o(e,t)?e[t]:void 0;if(0!==r)if(r)a.push(r[2]);else{var i=new Promise((function(s,a){r=e[t]=[s,a]}));a.push(r[2]=i);var o=s.p+s.u(t),l=new Error,n=function(a){if(s.o(e,t)&&(r=e[t],0!==r&&(e[t]=void 0),r)){var i=a&&("load"===a.type?"missing":a.type),o=a&&a.target&&a.target.src;l.message="Loading chunk "+t+" failed.\n("+i+": "+o+")",l.name="ChunkLoadError",l.type=i,l.request=o,r[1](l)}};s.l(o,n,"chunk-"+t,t)}},s.O.j=function(t){return 0===e[t]};var t=function(t,a){var r,i,o=a[0],l=a[1],n=a[2],d=0;if(o.some((function(t){return 0!==e[t]}))){for(r in l)s.o(l,r)&&(s.m[r]=l[r]);if(n)var c=n(s)}for(t&&t(a);d<o.length;d++)i=o[d],s.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return s.O(c)},a=self["webpackChunkmilitary_simulation_training_system"]=self["webpackChunkmilitary_simulation_training_system"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=s.O(void 0,[504],(function(){return s(79414)}));a=s.O(a)})();