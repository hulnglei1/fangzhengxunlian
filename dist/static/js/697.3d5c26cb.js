"use strict";(self["webpackChunkmilitary_simulation_training_system"]=self["webpackChunkmilitary_simulation_training_system"]||[]).push([[697],{88697:function(e,t,s){s.r(t),s.d(t,{default:function(){return d}});s(18111),s(61701);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"teacher-review-container"},[t("h1",{staticClass:"page-title"},[e._v("教师点评")]),t("div",{staticClass:"function-area"},[t("div",{staticClass:"search-area"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchName,expression:"searchName"}],attrs:{type:"text",placeholder:"输入人员姓名搜索"},domProps:{value:e.searchName},on:{input:[function(t){t.target.composing||(e.searchName=t.target.value)},e.filterScores]}}),t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchCourse,expression:"searchCourse"}],attrs:{type:"text",placeholder:"输入课程名称搜索"},domProps:{value:e.searchCourse},on:{input:[function(t){t.target.composing||(e.searchCourse=t.target.value)},e.filterScores]}}),t("select",{directives:[{name:"model",rawName:"v-model",value:e.classFilter,expression:"classFilter"}],on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.classFilter=t.target.multiple?s:s[0]},e.filterScores]}},[t("option",{attrs:{value:""}},[e._v("所有班级")]),e._l(e.classList,(function(s){return t("option",{key:s.id,domProps:{value:s.id}},[e._v(" "+e._s(s.name)+" ")])}))],2),t("select",{directives:[{name:"model",rawName:"v-model",value:e.timeFilter,expression:"timeFilter"}],on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.timeFilter=t.target.multiple?s:s[0]},e.filterScores]}},[t("option",{attrs:{value:""}},[e._v("所有时间")]),t("option",{attrs:{value:"today"}},[e._v("今天")]),t("option",{attrs:{value:"week"}},[e._v("本周")]),t("option",{attrs:{value:"month"}},[e._v("本月")])])])]),t("div",{staticClass:"score-list"},[t("table",[t("thead",[t("tr",[t("th",{on:{click:function(t){return e.sortBy("courseName")}}},[e._v(" 课程名称 "),"courseName"===e.sortField?t("span",{staticClass:"sort-icon"},[e._v(" "+e._s("asc"===e.sortOrder?"↑":"↓")+" ")]):e._e()]),t("th",{on:{click:function(t){return e.sortBy("time")}}},[e._v(" 时间 "),"time"===e.sortField?t("span",{staticClass:"sort-icon"},[e._v(" "+e._s("asc"===e.sortOrder?"↑":"↓")+" ")]):e._e()]),t("th",[e._v("班级")]),t("th",[e._v("编组")]),t("th",[e._v("姓名")]),t("th",[e._v("任务完成情况")]),t("th",[e._v("用时(分钟)")]),t("th",{on:{click:function(t){return e.sortBy("score")}}},[e._v(" 得分 "),"score"===e.sortField?t("span",{staticClass:"sort-icon"},[e._v(" "+e._s("asc"===e.sortOrder?"↑":"↓")+" ")]):e._e()]),t("th",[e._v("操作")])])]),t("tbody",[e._l(e.filteredScores,(function(s){return t("tr",{key:s.id},[t("td",[e._v(e._s(s.courseName))]),t("td",[e._v(e._s(e.formatDateTime(s.time)))]),t("td",[e._v(e._s(s.className))]),t("td",[e._v(e._s(s.groupName||"个人"))]),t("td",[e._v(e._s(s.studentName))]),t("td",[t("span",{staticClass:"status-tag",class:e.getTaskStatus(s)},[e._v(" "+e._s(e.getTaskStatusText(s))+" ")])]),t("td",[e._v(e._s(s.duration))]),t("td",[e._v(e._s(e.showScore(s)))]),t("td",{staticClass:"actions"},["pending"===e.getTaskStatus(s)?t("button",{staticClass:"review-btn",on:{click:function(t){return e.startReview(s)}}},[e._v(" 点评 ")]):e._e()])])})),0===e.filteredScores.length?t("tr",[t("td",{staticClass:"no-data",attrs:{colspan:"8"}},[e._v("暂无待点评的成绩数据")])]):e._e()],2)])]),e.showReviewModal?t("div",{staticClass:"modal-backdrop",on:{click:e.closeReviewModal}}):e._e(),e.showReviewModal?t("div",{staticClass:"modal review-modal"},[t("div",{staticClass:"modal-header"},[t("h3",[e._v("教员点评")]),t("button",{staticClass:"modal-close",on:{click:e.closeReviewModal}},[e._v("×")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"detail-header"},[t("div",{staticClass:"detail-info"},[t("h4",[e._v(e._s(e.currentScore.courseName))]),t("div",{staticClass:"detail-meta"},[t("span",[e._v(e._s(e.currentScore.studentName))]),t("span",[e._v(e._s(e.currentScore.className))]),t("span",[e._v(e._s(e.currentScore.groupName||"个人"))]),t("span",[e._v("课程角色："+e._s(e.currentScore.courseRole||"本控操作员"))]),t("span",[e._v(e._s(e.formatDateTime(e.currentScore.time)))])])]),t("div",{staticClass:"detail-score"},[t("div",{staticClass:"score-input"},[t("label",[e._v("总分：")]),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.currentScore.score,expression:"currentScore.score",modifiers:{number:!0}}],staticClass:"score-number-input",attrs:{type:"number",min:"0",max:"100"},domProps:{value:e.currentScore.score},on:{input:[function(t){t.target.composing||e.$set(e.currentScore,"score",e._n(t.target.value))},e.updateScore],blur:function(t){return e.$forceUpdate()}}})])])]),t("div",{staticClass:"detail-section"},[t("h4",[e._v("任务节点")]),t("div",{staticClass:"task-nodes"},e._l(e.currentScore.taskNodes,(function(s,r){return t("div",{key:r,staticClass:"task-node"},[t("div",{staticClass:"node-header",on:{click:function(t){return e.toggleNode(r)}}},[t("div",{staticClass:"node-number"},[e._v(e._s(s.order))]),t("div",{staticClass:"node-title"},[e._v(e._s(s.name))]),t("div",{staticClass:"node-time"},[e._v(e._s(e.formatTime(s.timestamp)))]),t("div",{staticClass:"node-status",class:{completed:s.completed}},[e._v(" "+e._s(s.completed?"已完成":"未完成")+" ")]),t("div",{staticClass:"node-toggle"},[e._v(e._s(s.expanded?"收起":"展开"))])]),s.screenshot&&s.expanded?t("div",{staticClass:"node-screenshot"},[t("img",{attrs:{src:s.screenshot,alt:s.name}})]):e._e()])})),0)]),t("div",{staticClass:"detail-section"},[t("h4",[e._v("点评内容")]),t("div",{staticClass:"review-form"},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.currentScore.review,expression:"currentScore.review"}],staticClass:"review-textarea",attrs:{placeholder:"请输入点评内容...",rows:"4"},domProps:{value:e.currentScore.review},on:{input:[function(t){t.target.composing||e.$set(e.currentScore,"review",t.target.value)},e.updateReview]}}),e.reviewError?t("div",{staticClass:"form-error"},[e._v(e._s(e.reviewError))]):e._e()])])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"cancel-btn",on:{click:e.closeReviewModal}},[e._v("取消")]),t("button",{staticClass:"submit-btn",attrs:{disabled:!e.isFormValid()},on:{click:e.submitReview}},[e._v("提交点评")])])]):e._e()])},a=[],o=(s(22489),s(13579),s(95353)),i={name:"TeacherReview",data(){return{searchName:"",searchCourse:"",classFilter:"",timeFilter:"",sortField:"time",sortOrder:"desc",scores:[],filteredScores:[],showReviewModal:!1,reviewError:"",currentScore:{taskNodes:[]},classList:[{id:"class001",name:"新兵连一班"},{id:"class002",name:"新兵连二班"},{id:"class003",name:"特种作战班"},{id:"class004",name:"通信技术班"}]}},computed:{...(0,o.aH)({userInfo:e=>e.user.userInfo})},created(){this.loadScores()},methods:{loadScores(){const e=[{id:"score001",courseId:"ft001",courseName:"装甲车辆驾驶训练",classId:"class001",className:"新兵连一班",groupId:"",groupName:"",studentId:"student001",studentName:"张三",time:"2024-03-10T14:30:00",completionRate:100,duration:45,score:null,hasReview:!1,review:"",reviewerName:"",reviewTime:"",taskNodes:[{order:1,name:"开机",timestamp:"2024-03-10T14:30:10",completed:!0,screenshot:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},{order:2,name:"切换工作模式",timestamp:"2024-03-10T14:32:45",completed:!0,screenshot:"https://images.unsplash.com/photo-1464983953574-0892a716854b?auto=format&fit=crop&w=400&q=80"},{order:3,name:"生成高压",timestamp:"2024-03-10T14:35:20",completed:!0,screenshot:"https://images.unsplash.com/photo-1519125323398-675f0ddb6308?auto=format&fit=crop&w=400&q=80"},{order:4,name:"模拟行驶",timestamp:"2024-03-10T14:40:15",completed:!0,screenshot:"https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?auto=format&fit=crop&w=400&q=80"}]},{id:"score002",courseId:"ft002",courseName:"战场通信训练",classId:"class003",className:"特种作战班",groupId:"group001",groupName:"通信小组A",studentId:"student002",studentName:"李四",time:"2024-03-12T10:15:00",completionRate:85,duration:60,score:null,hasReview:!1,review:"",reviewerName:"",reviewTime:"",taskNodes:[{order:1,name:"设备检查",timestamp:"2024-03-12T10:15:30",completed:!0,screenshot:"https://images.unsplash.com/photo-1517694712202-14dd9538aa97?auto=format&fit=crop&w=400&q=80"},{order:2,name:"建立通信链路",timestamp:"2024-03-12T10:20:45",completed:!0,screenshot:"https://images.unsplash.com/photo-1465101046530-73398c7f28ca?auto=format&fit=crop&w=400&q=80"},{order:3,name:"信息加密传输",timestamp:"2024-03-12T10:30:20",completed:!0,screenshot:"https://images.unsplash.com/photo-1519125323398-675f0ddb6308?auto=format&fit=crop&w=400&q=80"},{order:4,name:"应对干扰处理",timestamp:"2024-03-12T10:45:15",completed:!0,screenshot:"https://images.unsplash.com/photo-1465101178521-c1a9136a3c5c?auto=format&fit=crop&w=400&q=80"}]},{id:"score003",courseId:"ft003",courseName:"战术协同训练",classId:"class004",className:"通信技术班",groupId:"group002",groupName:"战术协同组B",studentId:"student003",studentName:"王五",time:"2024-03-08T09:00:00",completionRate:95,duration:90,score:null,hasReview:!1,review:"",reviewerName:"",reviewTime:"",taskNodes:[{order:1,name:"任务部署",timestamp:"2024-03-08T09:00:30",completed:!0,screenshot:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},{order:2,name:"战术分析",timestamp:"2024-03-08T09:15:45",completed:!0,screenshot:"https://images.unsplash.com/photo-1464983953574-0892a716854b?auto=format&fit=crop&w=400&q=80"},{order:3,name:"协同行动",timestamp:"2024-03-08T09:30:20",completed:!0,screenshot:"https://images.unsplash.com/photo-1519125323398-675f0ddb6308?auto=format&fit=crop&w=400&q=80"},{order:4,name:"任务总结",timestamp:"2024-03-08T10:00:15",completed:!0,screenshot:"https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?auto=format&fit=crop&w=400&q=80"}]}];"admin"===this.userInfo.role?this.scores=e:"teacher"===this.userInfo.role&&(this.scores=e.filter((e=>["class001","class003"].includes(e.classId)))),this.filterScores()},filterScores(){let e=[...this.scores];if(e=e.filter((e=>"pending"===this.getTaskStatus(e))),this.searchName){const t=this.searchName.toLowerCase();e=e.filter((e=>e.studentName.toLowerCase().includes(t)))}if(this.searchCourse){const t=this.searchCourse.toLowerCase();e=e.filter((e=>e.courseName.toLowerCase().includes(t)))}if(this.classFilter&&(e=e.filter((e=>e.classId===this.classFilter))),this.timeFilter){const t=new Date,s=new Date(t.getFullYear(),t.getMonth(),t.getDate()),r=new Date(s);r.setDate(s.getDate()-s.getDay());const a=new Date(t.getFullYear(),t.getMonth(),1);e=e.filter((e=>{const t=new Date(e.time);return"today"===this.timeFilter?t>=s:"week"===this.timeFilter?t>=r:"month"!==this.timeFilter||t>=a}))}this.applySorting(e)},sortBy(e){this.sortField===e?this.sortOrder="asc"===this.sortOrder?"desc":"asc":(this.sortField=e,this.sortOrder="asc"),this.filterScores()},applySorting(e){e.sort(((e,t)=>{let s=0;if("courseName"===this.sortField)s=e.courseName.localeCompare(t.courseName);else if("time"===this.sortField)s=new Date(e.time)-new Date(t.time);else if("score"===this.sortField){const r=null===e.score?-1:e.score,a=null===t.score?-1:t.score;s=r-a}return"asc"===this.sortOrder?s:-s})),this.filteredScores=e},startReview(e){this.currentScore={...e},this.currentScore.taskNodes=this.currentScore.taskNodes.map((e=>({...e,expanded:!1}))),this.currentScore.score=this.currentScore.score||0,this.currentScore.review=this.currentScore.review||"",this.showReviewModal=!0,this.reviewError=""},async submitReview(){if(!this.currentScore.score||this.currentScore.score<0||this.currentScore.score>100)this.reviewError="请输入0-100之间的分数";else if(!this.currentScore.review||this.currentScore.review.trim().length<10)this.reviewError="点评内容不能少于10个字";else try{this.currentScore={...this.currentScore,hasReview:!0,reviewerName:this.userInfo.name,reviewTime:(new Date).toISOString()};const e=this.scores.findIndex((e=>e.id===this.currentScore.id));-1!==e&&(this.scores[e]={...this.currentScore},this.filterScores()),this.$message.success("点评提交成功"),this.closeReviewModal()}catch(e){console.error("点评提交失败:",e),this.$message.error("点评提交失败，请重试")}},updateScore(e){const t=parseInt(e.target.value);isNaN(t)||(this.currentScore.score=Math.min(100,Math.max(0,t))),this.reviewError=""},updateReview(e){this.currentScore.review=e.target.value,this.reviewError=""},getTaskStatus(e){return!e.taskNodes||e.taskNodes.some((e=>!e.completed))?"not-finished":e.hasReview?"reviewed":"pending"},getTaskStatusText(e){const t=this.getTaskStatus(e);return"not-finished"===t?"未完成":"pending"===t?"待点评":"reviewed"===t?"已点评":""},formatDateTime(e){const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`},formatTime(e){const t=new Date(e);return`${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`},toggleNode(e){this.$set(this.currentScore.taskNodes[e],"expanded",!this.currentScore.taskNodes[e].expanded)},closeReviewModal(){this.showReviewModal=!1,this.reviewError=""},isFormValid(){return this.currentScore.score>=0&&this.currentScore.score<=100&&this.currentScore.review&&this.currentScore.review.trim().length>=10},showScore(e){const t=this.getTaskStatus(e);return"reviewed"!==t?"-":e.score}}},c=i,n=s(81656),l=(0,n.A)(c,r,a,!1,null,"061afed8",null),d=l.exports}}]);